import{r as g,j as f,F as J,a as e,P as Q,t as Pe,H as Z,u as L,s as S,q as h,p as T,aT as $,$ as ve,C as _,L as t,m as Y,S as le,aw as he,N as W,aU as Ae,a2 as ee,aV as ce,aa as fe,x as Se,a1 as Oe,aW as ge,aX as pe,aY as Ee,aZ as Ce,E as z,I as de,b as ie,a_ as Te,a$ as be,b0 as Ie,b1 as Me,as as te,n as re,R as ae,b2 as ue,b3 as se,b4 as Ne,ac as ye,b5 as Le,b6 as Re,ab as He,b7 as _e,b8 as oe,A as me}from"./index-646d6ab8.js";const j=({src:o,showAdvanced:a})=>{const[l,O]=g.useState(null);return f(J,{children:[e("video",{src:o,crossOrigin:"anonymous",controls:!1,onMouseOver:p=>{a&&p.currentTarget.play()},onMouseOut:p=>{a&&p.currentTarget.pause()},muted:!0,loop:!0,onLoadedMetadata:p=>{var b,H;O(p.currentTarget.duration),((H=(b=Q.Settings.value)==null?void 0:b.sound)==null?void 0:H.volume)!==void 0&&(p.currentTarget.volume=Q.Settings.value.sound.volume)}}),l&&a&&e("div",{className:"video-duration",children:(p=>{const b=Math.floor(p/60),H=Pe(p-b*60,0);return`${b}:${H<10?"0"+H:H}`})(l)})]})},D=Z(null),K=[{title:t("APPS.PHOTOS.VIDEOS"),id:"videos",icon:e(Oe,{}),count:0},{title:t("APPS.PHOTOS.SELFIES"),id:"selfies",icon:e(ge,{}),count:0},{title:t("APPS.PHOTOS.SCREENSHOTS"),id:"screenshots",icon:e(pe,{}),count:0},{title:t("APPS.PHOTOS.IMPORTS"),id:"imports",icon:e(Ee,{}),count:0},{title:t("APPS.PHOTOS.DUPLICATES"),id:"duplicates",icon:e(Ce,{}),count:0}];function Ue(){const o=L(D),[a,l]=g.useState(!1),O=L(S.APPS.CAMERA.albums),C=L(S.APPS.CAMERA.mediaTypes);g.useEffect(()=>{var m,M;if(((m=S.APPS.CAMERA.albums.value)==null?void 0:m.length)>0&&((M=S.APPS.CAMERA.mediaTypes.value)==null?void 0:M.length)>0)return h("info","Album and mediatype cache exists, returning");T("Camera",{action:"getAlbums"},{albums:$.Albums,mediaTypes:$.MediaTypes}).then(s=>{if(!s)return h("error","No data received from server");let k=((C==null?void 0:C.length)>0?C:K).map(y=>{const B=s.mediaTypes[y.id+"Photos"]??0,x=s.mediaTypes[y.id+"Videos"]??0;return{...y,count:B+x,videoCount:x,photoCount:B}});S.APPS.CAMERA.albums.set(s.albums),S.APPS.CAMERA.mediaTypes.set(k)})},[o]);const p=()=>{let m="";_.PopUp.set({title:t("APPS.PHOTOS.NEW_ALBUM_POPUP.TITLE"),description:t("APPS.PHOTOS.NEW_ALBUM_POPUP.DESCRIPTION"),input:{placeholder:t("APPS.PHOTOS.NEW_ALBUM_POPUP.PLACEHOLDER"),maxCharacters:20,onChange:M=>{m=M}},buttons:[{title:t("APPS.PHOTOS.NEW_ALBUM_POPUP.CANCEL")},{title:t("APPS.PHOTOS.NEW_ALBUM_POPUP.PROCEED"),cb:()=>{T("Camera",{action:"createAlbum",title:m},!0).then(M=>{if(!M)return h("warning","Could not create album, id not returned");if(m.length<1)return h("warning","Input is empty, cannot create album");if(m.length>20)return h("warning","Input is too long, cannot create album");let s={title:m,id:M,cover:null,count:0,photoCount:0,videoCount:0};S.APPS.CAMERA.albums.set([...O,s])})}}]})},b=m=>{if(!m)return h("warning","No album id provided, cannot remove album");_.PopUp.set({title:t("APPS.PHOTOS.REMOVE_ALBUM.TITLE").format({name:m.title}),description:t("APPS.PHOTOS.REMOVE_ALBUM.DESCRIPTION").format({name:m.title}),buttons:[{title:t("APPS.PHOTOS.REMOVE_ALBUM.CANCEL")},{title:t("APPS.PHOTOS.REMOVE_ALBUM.PROCEED"),color:"red",cb:()=>{T("Camera",{action:"deleteAlbum",id:m.id},!0).then(M=>{if(!M)return h("error","Could not remove album, server returned false");S.APPS.CAMERA.albums.set(O.filter(s=>s.id!==m.id))})}}]})},H=ve(m=>{let M=m.target;for(;!M.classList.contains("album");)M=M.parentElement;let s=parseInt(M.getAttribute("data-id"));if(!s)return h("warning","Could not obtain album id from element");_.ContextMenu.set({buttons:[{title:t("APPS.PHOTOS.RENAME_ALBUM_POPUP.TITLE"),cb:()=>{let U="";_.PopUp.set({title:t("APPS.PHOTOS.RENAME_ALBUM_POPUP.TITLE"),description:t("APPS.PHOTOS.RENAME_ALBUM_POPUP.DESCRIPTION"),input:{placeholder:t("APPS.PHOTOS.RENAME_ALBUM_POPUP.PLACEHOLDER"),minCharacters:1,maxCharacters:20,onChange:k=>{U=k}},buttons:[{title:t("APPS.PHOTOS.RENAME_ALBUM_POPUP.CANCEL")},{title:t("APPS.PHOTOS.RENAME_ALBUM_POPUP.PROCEED"),cb:()=>{if(U.length<1)return h("warning","Input is empty, cannot rename album");h("warning","Renaming album",s,U),T("Camera",{action:"renameAlbum",id:s,title:U},!0).then(k=>{if(!k)return h("error","Could not rename album, server returned false");S.APPS.CAMERA.albums.set(O.map(y=>y.id===s?{...y,title:U}:y))})}}]})}},{title:t("APPS.PHOTOS.DELETE"),color:"red",cb:()=>b(O.find(U=>U.id===s))}]})});return e(Y.div,{...le("right",o?"inAlbum":"albums"),style:{height:"100%",paddingBottom:"9rem"},children:o?e(W,{children:e(De,{})}):f(J,{children:[f("div",{className:"albums-header",children:[f("div",{className:"top",children:[e("div",{className:"edit",onClick:()=>l(!a),children:a?t("APPS.PHOTOS.DONE"):t("APPS.PHOTOS.EDIT")}),e(he,{onClick:p})]}),e("div",{className:"title",children:t("APPS.PHOTOS.ALBUMS")})]}),f("div",{className:"albums-content",children:[e("div",{className:"subtitle",children:t("APPS.PHOTOS.MY_ALBUMS")}),e("div",{className:"albums-grid","data-edit":a,children:e(W,{children:O.map((m,M)=>f(Y.div,{animate:{scale:1},exit:{scale:.2},transition:{duration:.25,ease:"easeInOut"},className:"album","data-id":m.id,"data-removable":m.removable,...H,onClick:()=>{a||D.set(m)},children:[a&&m.removable!==!1&&e("div",{className:"remove",onClick:s=>{s.stopPropagation(),b(m)},children:e(Ae,{})}),f("div",{className:"cover",children:[ee(m.cover)?e(j,{src:m.cover,showAdvanced:!1}):e("img",{src:m.cover??"https://join.travelmanagers.com.au/wp-content/uploads/2017/09/default-placeholder-300x300.png"}),m.id==="favourites"&&e(ce,{})]}),f("div",{className:"text",children:[e("div",{className:"title",children:m.title}),e("div",{className:"count",children:fe(m.count)})]})]},M))})})]}),e("div",{className:"divider"}),f("div",{className:"media-types",children:[e("div",{className:"subtitle",children:t("APPS.PHOTOS.MEDIA_TYPES")}),e("div",{className:"media-types-items",children:C.map((m,M)=>f("div",{className:"item",onClick:()=>{if(a)return h("info","Edit mode is enabled, cannot open media type");D.set({...m,id:null,cover:null,type:m.id})},children:[f("div",{className:"type",children:[m.icon,m.title]}),f("div",{className:"action",children:[e("div",{className:"count",children:m.count}),e(Se,{})]})]},M))})]})]})})}const De=()=>{var x,q;const o=L(D),a=L(w),[l,O]=g.useState([]),[C,p]=g.useState([]),[b,H]=g.useState(!1),[m,M]=g.useState(!1),[s,U]=g.useState(!1),[k,y]=g.useState(0);g.useEffect(()=>{if(!z("Photos"))return;let v=o.id==="favourites"?$.Photos.filter(P=>P.favourite):o.id==="recents"?$.Photos:o.type==="videos"?$.Photos.filter(P=>P.isVideo):o.type?$.Photos.filter(P=>P.type===o.type):$.Photos.filter(P=>P.album===o.id);T("Camera",{action:"getImages",filter:{album:o.id,type:o.type}},v).then(P=>{if(!P)return h("warning","No data was returned from getImages event");p(P.reverse()),H(P.length===0)})},[]);const B=v=>{if(m||s)return;let P=document.querySelector("#last");if(!P)return;if(C.length<32)return h("warning","Not enough photos to fetch more");if(!se(P)){const n=document.querySelector(".library-content"),i=n.scrollHeight;U(!0),T("Camera",{action:"getImages",page:k+1,filter:{album:o.id,type:o.type}},null).then(d=>{d&&d.length>0?(n.style.transform=`translateY(${i}px)`,p(E=>[...d.reverse(),...E]),U(!1),requestAnimationFrame(()=>{n.style.transition="transform 0ms",n.style.transform="translateY(0)"}),d.length<32&&M(!0)):M(!0)}),y(d=>d+1)}};return f(Y.div,{initial:{opacity:0,x:35},animate:{opacity:1,x:0},exit:{opacity:0,x:35},transition:{duration:.25,ease:"easeInOut"},className:"library",children:[e("div",{className:"library-header album",children:f("div",{className:"top",children:[e("div",{className:"back",children:e(de,{onClick:()=>{D.set(null),w.set(!1)}})}),f("div",{className:"info",children:[e("div",{className:"title",children:o.title}),f("div",{className:"details",children:[t("APPS.PHOTOS.PHOTO_COUNT").format({amount:o.photoCount??0}),e("br",{}),t("APPS.PHOTOS.VIDEO_COUNT").format({amount:o.videoCount??0})]})]}),f("div",{className:"actions",style:{color:C.length<15?"var(--phone-color-blue)":"var(--phone-text-primary)"},children:[e("div",{className:"button",onClick:()=>w.set(!a),children:a?t("APPS.PHOTOS.DONE"):t("APPS.PHOTOS.SELECT")}),(((q=(x=ie.value)==null?void 0:x.AllowExternal)==null?void 0:q.Gallery)||o.id!=="recents"&&o.id!=="favourites")&&e("div",{className:"button round",onClick:()=>{var u,n;let v=o.id!=="recents"&&o.id!=="favourites",P=((n=(u=ie.value)==null?void 0:u.AllowExternal)==null?void 0:n.Gallery)&&o.id!=="favourites";if(!v&&!P)return h("warning","Cannot edit or import images in this album");_.ContextMenu.set({buttons:[P&&{title:t("APPS.PHOTOS.IMPORT_IMAGE_POPUP.TITLE"),cb:()=>{let i="";_.PopUp.set({title:t("APPS.PHOTOS.IMPORT_IMAGE_POPUP.TITLE"),description:t("APPS.PHOTOS.IMPORT_IMAGE_POPUP.DESCRIPTION"),input:{placeholder:t("APPS.PHOTOS.IMPORT_IMAGE_POPUP.PLACEHOLDER"),onChange:d=>{i=d}},buttons:[{title:t("APPS.PHOTOS.IMPORT_IMAGE_POPUP.CANCEL")},{title:t("APPS.PHOTOS.IMPORT_IMAGE_POPUP.PROCEED"),cb:()=>{if(i.includes("data:image"))return h("warning","Data URL not supported");if(!Te(i)){setTimeout(()=>{_.PopUp.set({title:t("COMPONENTS.GALLERY.EXTERNAL_URL"),description:t("COMPONENTS.GALLERY.EXTERNAL_URL_BLACKLISTED"),buttons:[{title:"OK"}]}),h("warning","External URL is blacklisted")},500);return}be(i,d=>{if(!d)return h("error","Image does not exist");Ie(i,null,"import",!0).then(E=>{if(!E)return h("error","Could not save to gallery, server returned false");let I=ee(i);p([{id:E,src:i,timestamp:Date.now(),type:"import",isVideo:I},...C]),o.id!=="recents"&&o.id!=="favourites"?T("Camera",{action:"addToAlbum",album:o.id,ids:[E]}).then(N=>{if(!N)return h("error","Could not add to album, server returned false");let c=o.photoCount+1,r=I?o.videoCount+1:o.videoCount;D.set({...o,photoCount:c,videoCount:r,cover:i})}):o.id==="favourites"&&T("Camera",{action:"toggleFavourites",ids:[E],favourite:!0}).then(N=>{if(!N)return h("error","Could not add to favourites, server returned false");let c=o.photoCount+1,r=I?o.videoCount+1:o.videoCount;D.set({...o,photoCount:c,videoCount:r,cover:i})}),T("Camera",{action:"getAlbums"}).then(N=>{if(!N)return h("error","No data received from server");let c=K.map(r=>{const A=N.mediaTypes[r.id+"Photos"]??0,R=N.mediaTypes[r.id+"Videos"]??0;return{...r,count:A+R,photoCount:A,videoCount:R}});S.APPS.CAMERA.albums.set(N.albums),S.APPS.CAMERA.mediaTypes.set(c)})})})}}]})}},v&&{title:t("APPS.PHOTOS.RENAME_ALBUM_POPUP.TITLE"),cb:()=>{let i="";_.PopUp.set({title:t("APPS.PHOTOS.RENAME_ALBUM_POPUP.TITLE"),description:t("APPS.PHOTOS.RENAME_ALBUM_POPUP.DESCRIPTION"),input:{placeholder:t("APPS.PHOTOS.RENAME_ALBUM_POPUP.PLACEHOLDER"),minCharacters:1,maxCharacters:20,onChange:d=>{i=d}},buttons:[{title:t("APPS.PHOTOS.RENAME_ALBUM_POPUP.CANCEL")},{title:t("APPS.PHOTOS.RENAME_ALBUM_POPUP.PROCEED"),cb:()=>{if(i.length<1)return h("warning","Input is empty, cannot rename album");h("info","Renaming album",o.id,i),T("Camera",{action:"renameAlbum",id:o.id,title:i},!0).then(d=>{if(!d)return h("error","Could not rename album, server returned false");D.set({...o,title:i}),S.APPS.CAMERA.albums.set(S.APPS.CAMERA.albums.value.map(E=>E.id===o.id?{...E,title:i}:E))})}}]})}},v&&{title:t("APPS.PHOTOS.DELETE"),color:"red",cb:()=>{_.PopUp.set({title:t("APPS.PHOTOS.REMOVE_ALBUM.TITLE").format({name:o.title}),description:t("APPS.PHOTOS.REMOVE_ALBUM.DESCRIPTION").format({name:o.title}),buttons:[{title:t("APPS.PHOTOS.REMOVE_ALBUM.CANCEL")},{title:t("APPS.PHOTOS.REMOVE_ALBUM.PROCEED"),color:"red",cb:()=>{T("Camera",{action:"deleteAlbum",id:o.id},!0).then(i=>{if(!i)return h("error","Could not remove album, server returned false");S.APPS.CAMERA.albums.set(S.APPS.CAMERA.albums.value.filter(d=>d.id!==o.id)),D.set(null)})}}]})}}]})},children:e(Me,{})})]})]})}),f("div",{className:"library-content",style:{maxHeight:"40rem"},onScroll:B,children:[b&&f("div",{className:"no-photos",children:[e("div",{className:"title",children:t("APPS.PHOTOS.NO_PHOTOS")}),e("div",{className:"description",children:t("APPS.PHOTOS.NO_PHOTOS_INSTRUCTIONS")})]}),e("div",{className:"library-grid",children:C.map((v,P)=>f("div",{id:P===0?"last":"",className:"grid-item",onClick:()=>{if(a){const n=l.find(i=>i.id===v.id);O(n?l.filter(i=>i.id!==v.id):[...l,v])}else V.set({activeImage:v,images:C})},children:[v.isVideo?e(j,{src:v.src,showAdvanced:!a}):e("div",{className:"img",style:{backgroundImage:`url(${v.src})`}}),e("div",{className:"checkbox",children:a&&(l.find(n=>n.id===v.id)?e(te,{checked:!0}):e(te,{checked:!1}))})]},P))})]}),a&&f("div",{className:"select-footer",children:[e("div",{className:"icons","data-disabled":l.length===0,children:e(re,{})}),e("div",{className:"title",children:l.length===0?t("APPS.PHOTOS.SELECT_ITEMS"):t("APPS.PHOTOS.SELECTED_COUNT").format({count:l.length})}),f("div",{className:"icons","data-disabled":l.length===0,children:[e(ae,{onClick:()=>{if(l.length===0)return;let v=o.id!=="recents"&&o.id!=="favourites";_.ContextMenu.set({title:v&&t("APPS.PHOTOS.DELETE_CONTEXT_TITLE").format({type:l.length>1?t("APPS.PHOTOS.THESE_PHOTOS"):t("APPS.PHOTOS.THIS_PHOTO")}),buttons:[v&&{title:t("APPS.PHOTOS.REMOVE_FROM_ALBUM"),cb:()=>{T("Camera",{action:"removeFromAlbum",album:o.id,ids:l.map(P=>P.id)},!0).then(P=>{if(!P)return h("error","Could not remove from album, server returned false");let u=o.photoCount-l.filter(i=>!i.isVideo).length,n=o.videoCount-l.filter(i=>i.isVideo).length;S.APPS.CAMERA.albums.set(S.APPS.CAMERA.albums.value.map(i=>{if(i.id===o.id)return{...i,count:i.count-l.length,photoCount:u,videoCount:n}})),D.set({...o,photoCount:u,videoCount:n}),p(C.filter(i=>!l.find(d=>i.id===d.id))),O([]),w.set(!1)})}},{title:t("APPS.PHOTOS.DELETE"),color:"red",cb:()=>{T("Camera",{action:"deleteFromGallery",ids:l.map(P=>P.id)},!0).then(P=>{if(!P)return h("error","Could not delete from gallery, server returned false");let u=0;l.forEach(d=>{u+=d.size}),window.postMessage({action:"updateStorage",add:!1,size:u});let n=o.photoCount-l.filter(d=>!d.isVideo).length,i=o.videoCount-l.filter(d=>d.isVideo).length;T("Camera",{action:"getAlbums"}).then(d=>{if(!d)return h("error","No data received from server");let E=K.map(I=>{const N=d.mediaTypes[I.id+"Photos"]??0,c=d.mediaTypes[I.id+"Videos"]??0;return{...I,count:N+c,photoCount:N,videoCount:c}});S.APPS.CAMERA.albums.set(d.albums),S.APPS.CAMERA.mediaTypes.set(E)}),D.set({...o,photoCount:n,videoCount:i}),p(C.filter(d=>!l.find(E=>d.id===E.id))),O([]),w.set(!1)})}}]})}}),e(ue,{onClick:()=>{if(l.length===0)return;let v=l.find(P=>!P.favourite);_.ContextMenu.set({buttons:[{title:t("APPS.PHOTOS.ADD_TO_ALBUM"),cb:()=>{X.set({images:l,onSelect:P=>{T("Camera",{action:"addToAlbum",album:P.id,ids:l.map(u=>u.id)},!0).then(u=>{if(!u)return h("error","Could not add to album, server returned false");O([]),w.set(!1),S.APPS.CAMERA.albums.set(S.APPS.CAMERA.albums.value.map(n=>n.id===P.id?{...n,count:n.count+l.length,photoCount:n.photoCount+l.filter(i=>!i.isVideo).length,videoCount:n.videoCount+l.filter(i=>i.isVideo).length,cover:l[l.length-1].src}:n))})}})}},{title:v?t("APPS.PHOTOS.ADD_TO_FAVOURITES"):t("APPS.PHOTOS.REMOVE_FROM_FAVOURITES"),cb:()=>{T("Camera",{action:"toggleFavourites",ids:l.map(P=>P.id),favourite:!!v},!0).then(P=>{if(!P)return h("error","Could not add to favourites, server returned false");O([]),w.set(!1),S.APPS.CAMERA.albums.set(S.APPS.CAMERA.albums.value.map(u=>u.id==="favourites"?{...u,count:u.count+l.length,photoCount:u.photoCount+l.filter(n=>!n.isVideo).length,videoCount:u.videoCount+l.filter(n=>n.isVideo).length,cover:l[l.length-1].src}:u))})}}]})}})]})]})]})};t("APPS.PHOTOS.YEARS"),t("APPS.PHOTOS.MONTHS"),t("APPS.PHOTOS.DAYS"),t("APPS.PHOTOS.ALL_PHOTOS");function Ve(){const o=L(w),[a,l]=g.useState([]),[O,C]=g.useState([]),[p,b]=g.useState(!1);g.useState("all");const[H,m]=g.useState(null),[M,s]=g.useState(!1),[U,k]=g.useState(!1),[y,B]=g.useState(0),x=()=>{var R,F;let u=[],n=document.querySelectorAll(".grid-item");if(n.length===0||(n.forEach(G=>{!se(G)&&u.push(G)}),u.length===0))return m(null);let i=u[0],d=parseInt(i==null?void 0:i.getAttribute("data-id"));if(!d)return;let E=(R=O.find(G=>G.id===d))==null?void 0:R.timestamp,I=u[u.length-1],N=parseInt(I.getAttribute("data-id")),c;if(N&&(c=(F=O.find(G=>G.id===N))==null?void 0:F.timestamp),!E)return;let r=q(E),A=q(c);if(r===A||!c)return m(r);m(`${r} - ${A}`)},q=u=>{let n=new Date(u/1e3),i=n.toLocaleString("default",{month:"short"}),d=n.getDate(),E=n.getFullYear();return`${d} ${i} ${E}`};g.useEffect(()=>{z("Photos")&&T("Camera",{action:"getImages"},$.Photos.sort((u,n)=>n.timestamp-u.timestamp).reverse()).then(u=>{if(!u)return h("warning","No data was returned from getImages event");C(u.reverse()),b(u.length===0)})},[]);const v=u=>{if(x(),M||U)return;let n=document.querySelector("#last");if(!n)return;if(!se(n)){const d=document.querySelector(".library-content"),E=d.scrollHeight;k(!0),T("Camera",{action:"getImages",page:y+1},null).then(I=>{I&&I.length>0?(d.style.transform=`translateY(${E}px)`,C(N=>[...I.reverse(),...N]),k(!1),requestAnimationFrame(()=>{d.style.transition="transform 0ms",d.style.transform="translateY(0)"}),I.length<32&&s(!0)):s(!0)}),B(I=>I+1)}},P=u=>u.reduce((n,i)=>{const d=ye(i.timestamp);return n[d]||(n[d]=[]),n[d].push(i),n},{});return f(Y.div,{...le("left","library"),style:{height:"100%"},children:[e("div",{className:"library-header",children:f("div",{className:"top",children:[e("div",{}),e("div",{className:"actions",children:e("div",{className:"button",onClick:()=>w.set(!o),children:o?t("APPS.PHOTOS.DONE"):t("APPS.PHOTOS.SELECT")})})]})}),e("div",{className:"library-content",style:{marginTop:"4rem",maxHeight:48.5-4+"rem"},"data-offset":O.length<15,onScroll:v,children:(()=>{let u=P(O);return Object.keys(u).map(n=>f("div",{className:"date-group",children:[e("div",{className:"date",children:n}),e("div",{className:"library-grid","data-zoomlevel":Fe[1].toString(),children:u[n].map((i,d)=>f("div",{id:d===0?"last":"",className:"grid-item","data-id":i.id,onClick:()=>{if(o){const I=a.find(N=>N.id===i.id);l(I?a.filter(N=>N.id!==i.id):[...a,i])}else V.set({activeImage:i,images:O})},children:[i.isVideo?e(j,{src:i.src,showAdvanced:!o}):e("div",{className:"img",style:{backgroundImage:`url(${i.src})`}}),e("div",{className:"checkbox",children:o&&(a.find(I=>I.id===i.id)?e(te,{checked:!0}):e(te,{checked:!1}))})]},i.id))})]},n))})()}),o&&f("div",{className:"select-footer",children:[e("div",{className:"icons","data-disabled":a.length===0,children:e(re,{})}),e("div",{className:"title",children:a.length===0?t("APPS.PHOTOS.SELECT_ITEMS"):t("APPS.PHOTOS.SELECTED_COUNT").format({count:a.length})}),f("div",{className:"icons","data-disabled":a.length===0,children:[e(ae,{onClick:()=>{a.length!==0&&_.ContextMenu.set({buttons:[{title:t("APPS.PHOTOS.DELETE"),color:"red",cb:()=>{T("Camera",{action:"deleteFromGallery",ids:a.map(u=>u.id)},!0).then(()=>{C(O.filter(n=>!a.find(i=>n.src===i.src))),l([]);let u=0;a.forEach(n=>{u+=n.size}),window.postMessage({action:"updateStorage",add:!1,size:u}),T("Camera",{action:"getAlbums"}).then(n=>{if(!n)return h("error","No data received from server");let i=K.map(d=>{const E=n.mediaTypes[d.id+"Photos"]??0,I=n.mediaTypes[d.id+"Videos"]??0;return{...d,count:E+I,photoCount:E,videoCount:I}});S.APPS.CAMERA.albums.set(n.albums),S.APPS.CAMERA.mediaTypes.set(i)})})}}]})}}),e(Ne,{onClick:()=>{a.length!==0&&_.ContextMenu.set({buttons:[{title:t("APPS.PHOTOS.ADD_TO_ALBUM"),cb:()=>{X.set({images:a,onSelect:u=>{T("Camera",{action:"addToAlbum",album:u.id,ids:a.map(n=>n.id)},!0).then(n=>{if(!n)return h("error","Could not add to album, server returned false");l([]),w.set(!1),S.APPS.CAMERA.albums.set(S.APPS.CAMERA.albums.value.map(i=>i.id===u.id?{...i,count:i.count+a.length,photoCount:i.photoCount+a.filter(d=>!d.isVideo).length,videoCount:i.videoCount+a.filter(d=>d.isVideo).length,cover:a[a.length-1].src}:i))})}})}},{title:t("APPS.PHOTOS.ADD_TO_FAVOURITES"),cb:()=>{T("Camera",{action:"toggleFavourites",ids:a.map(u=>u.id),favourite:!0},!0).then(u=>{if(!u)return h("error","Could not add to favourites, server returned false");l([]),w.set(!1),S.APPS.CAMERA.albums.set(S.APPS.CAMERA.albums.value.map(n=>n.id==="favourites"?{...n,count:n.count+a.length,photoCount:n.photoCount+a.filter(i=>!i.isVideo).length,videoCount:n.videoCount+a.filter(i=>i.isVideo).length,cover:a[a.length-1].src}:n))})}}]})}})]})]})]})}function we(){var O,C,p;const o=L(X),a=L(S.APPS.CAMERA.albums);let l=(O=o==null?void 0:o.images)==null?void 0:O[(o==null?void 0:o.images.length)-1];return f(Y.div,{initial:{opacity:0,scale:.9,y:250},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:250},className:"addtoalbum-container",children:[f("div",{className:"addtoalbum-header",children:[e("div",{}),e("div",{className:"title",children:t("APPS.PHOTOS.ADD_TO_ALBUM")}),e("div",{className:"cancel",onClick:()=>X.reset(),children:t("APPS.PHOTOS.CANCEL")})]}),f("div",{className:"addtoalbum-content",children:[f("div",{className:"preview",children:[ee(l==null?void 0:l.src)?e(j,{src:l==null?void 0:l.src,showAdvanced:!1}):e("img",{src:l==null?void 0:l.src}),e("div",{className:"title",children:t("APPS.PHOTOS.SELECTED_COUNT").format({count:(C=o==null?void 0:o.images)==null?void 0:C.length})})]}),e("div",{className:"albums",children:(p=a==null?void 0:a.filter(b=>b.id!=="favourites"&&b.id!=="recents"))==null?void 0:p.map((b,H)=>f("div",{className:"album",onClick:()=>{o.onSelect(b),X.reset()},children:[e("div",{className:"cover",children:ee(b.cover)?e(j,{src:b.cover,showAdvanced:!1}):e("img",{src:b.cover??"https://join.travelmanagers.com.au/wp-content/uploads/2017/09/default-placeholder-300x300.png"})}),e("div",{className:"title",children:b.title}),e("div",{className:"count",children:b.count})]},H))})]})]})}function ke(){const o=L(ne),[a,l]=g.useState([{icon:e(Le,{}),title:t("APPS.PHOTOS.GALLERY"),value:"library"},{icon:e(Re,{}),title:t("APPS.PHOTOS.ALBUMS"),value:"albums"}]);return e("div",{className:"photos-footer",children:a.map((O,C)=>f("div",{className:"item","data-active":o===O.value,onClick:()=>{ne.set(O.value),O.value==="albums"&&o==="albums"&&(D!=null&&D.value)&&D.reset()},children:[O.icon,O.title]},C))})}const Be=()=>{var n,i,d,E,I,N;const o=L(ie),a=L(Q.Settings),l=L(me),[O,C]=g.useState(!0),p=g.useRef(!1),[b,H]=g.useState(0),m=g.useRef(null),M=g.useRef(null),s=L(V),[U,k]=g.useState(new Date(((i=(n=V==null?void 0:V.value)==null?void 0:n.activeImage)==null?void 0:i.timestamp)??0)),[y,B]=g.useState(((d=s==null?void 0:s.activeImage)==null?void 0:d.favourite)??!1),[x,q]=g.useState([]);let v=(s==null?void 0:s.images)??[];g.useEffect(()=>{if(z("Photos"))return()=>{var c;if((c=s.activeImage)!=null&&c.isVideo){const r=document.getElementById(s.activeImage.id);if(!r)return;r.pause(),r.currentTime=0}}},[l==null?void 0:l.active]),g.useEffect(()=>{var c;if(!(s!=null&&s.activeImage))return h("warning","No active image when changing volume");if(s.activeImage.isVideo){const r=document.getElementById(s.activeImage.id);if(!r)return;r.volume=((c=a==null?void 0:a.sound)==null?void 0:c.volume)!==void 0?a.sound.volume:.5}},[(E=a==null?void 0:a.sound)==null?void 0:E.volume]),g.useEffect(()=>{var r;if(!s)return;let c=v.findIndex(A=>A.id===s.activeImage.id);if(H(c),B(s.activeImage.favourite),s.activeImage.isVideo){const A=document.getElementById(s.activeImage.id);if(!A)return h("warning","Video Element not found (Carousel effect)");A.play().catch(()=>h("warning","Could not play video, user interaction required")),A.volume=a.sound.volume}if(v.length>0){let A=[];c===0?A=v.slice(0,12):c===v.length-1?A=v.slice(v.length-12,v.length):c<6?A=v.slice(0,12):c>v.length-6?A=v.slice(v.length-12,v.length):A=v.slice(c-6,c+6),k(new Date((r=v==null?void 0:v[c])==null?void 0:r.timestamp)),q(A)}},[s==null?void 0:s.activeImage]);const P={pos:{startLeft:0,startX:0},onMouseDown:c=>{z("Photos")&&(P.pos={startLeft:m.current.scrollLeft,startX:c.clientX},m.current.style.userSelect="none",document.addEventListener("mouseup",P.onMouseUp),document.addEventListener("mousemove",P.onMove))},onMove:c=>{if(!m.current)return;const r=(c.clientX-P.pos.startX)/oe();m.current.scrollLeft=P.pos.startLeft-r;const A=m.current.getBoundingClientRect();(A.left*oe()-5>c.clientX||c.clientX>A.right*oe()-5)&&P.onMouseUp(),p.current=!0},onMouseUp:()=>{if(!m.current)return;m.current.style.removeProperty("user-select"),document.removeEventListener("mouseup",P.onMouseUp),document.removeEventListener("mousemove",P.onMove);const c=m.current.clientWidth;let r=b;const A=m.current.scrollLeft-P.pos.startLeft;if(A>c/2&&r<v.length?r++:A<-c/2&&r>0&&r--,s.activeImage.id!==v[r].id&&s.activeImage.isVideo){const F=document.getElementById(s.activeImage.id);F&&(F.pause(),F.currentTime=0)}V.set({activeImage:v[r],images:v});let R=document.getElementById(v[r].id);if(!R)return h("error","Could not find element to scroll into view");R.scrollIntoView({behavior:"smooth",block:"center"}),setTimeout(()=>{p.current=!1},100)}},u=c=>{s.activeImage.isVideo&&document.getElementById(s.activeImage.id).pause(),V.set({activeImage:c,images:v});let r=document.getElementById(c.id);if(!r)return h("error","Could not find element to scroll into view");r.scrollIntoView({behavior:"smooth",block:"center"})};return f(Y.div,{initial:{opacity:0,scale:.25},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.25},transition:{duration:.2,ease:"easeInOut"},className:"activephoto-container",children:[e(W,{children:O&&f(Y.div,{className:"photo-top",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2,ease:"easeInOut"},children:[e("div",{className:"back",onClick:()=>{_.Share.reset(),V.reset()},children:e(de,{})}),e("div",{className:"date",children:((I=s==null?void 0:s.activeImage)==null?void 0:I.timestamp)&&f(J,{children:[e("span",{children:U.toLocaleString([],{day:"2-digit",month:"long"})}),e("span",{children:U.toLocaleTimeString(o.DateLocale,{hour:"numeric",minute:"numeric",hour12:a.time.twelveHourClock})})]})}),e("div",{children:((N=s==null?void 0:s.activeImage)==null?void 0:N.id)&&e(ue,{onClick:()=>{_.ContextMenu.set({buttons:[{title:t("APPS.PHOTOS.ADD_TO_ALBUM"),cb:()=>{X.set({images:[s.activeImage],onSelect:c=>{T("Camera",{action:"addToAlbum",album:c.id,ids:[s.activeImage.id]},!0).then(r=>{if(!r)return h("error","Could not add to album, server returned false");S.APPS.CAMERA.albums.set(S.APPS.CAMERA.albums.value.map(A=>A.id===c.id?{...A,count:A.count+1,photoCount:s.activeImage.isVideo?A.photoCount:A.photoCount+1,videoCount:s.activeImage.isVideo?A.videoCount+1:A.videoCount,cover:s.activeImage.src}:A))})}})}},{title:y?t("APPS.PHOTOS.REMOVE_FROM_FAVOURITES"):t("APPS.PHOTOS.ADD_TO_FAVOURITES"),cb:()=>{T("Camera",{action:"toggleFavourites",ids:[s.activeImage.id],favourite:!y},!0).then(c=>{if(!c)return h("error","Could not add to favourites, server returned false");S.APPS.CAMERA.albums.set(S.APPS.CAMERA.albums.value.map(r=>r.id==="favourites"?{...r,count:r.count+1,photoCount:s.activeImage.isVideo?r.photoCount:r.photoCount+1,videoCount:s.activeImage.isVideo?r.videoCount+1:r.videoCount,cover:s.activeImage.src}:r))})}}]})}})})]})}),e("div",{className:"image-overflow",ref:m,onMouseDown:P.onMouseDown,style:{backgroundColor:O?"var(--phone-color-primary)":"rgba(0, 0, 0)"},onClick:()=>{p.current||C(!O)},children:v==null?void 0:v.map((c,r)=>{const A=c.id===s.activeImage.id;return c.isVideo?e("video",{id:c.id,src:c.src,className:A?"active":null,crossOrigin:"anonymous",loop:!0,onLoadedMetadata:R=>{z("Photos")&&A&&(R.target.scrollIntoView({block:"center"}),R.target.play().catch(()=>h("warning","Could not play video, user interaction required")))}},r):e(He,{id:c.id,src:c.src,className:A?"active":null,ignoreStreamerMode:!0,onLoad:R=>{z("Photos")&&A&&R.target.scrollIntoView({block:"center"})}},r)})}),e(W,{children:O&&f(Y.div,{className:"photo-bottom-wrapper",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2,ease:"easeInOut"},children:[e("div",{className:"photo-carousel",ref:M,children:x.map((c,r)=>{let A=c.id===(s==null?void 0:s.activeImage.id);return c.isVideo?e("video",{src:c.src,"data-active":A,"data-carousel":r,controls:!1,muted:!0,onClick:R=>u(c)},r):e("img",{src:c.src,"data-id":c.id,"data-active":A,"data-carousel":r,onClick:R=>u(c)},r)})}),f("div",{className:"photo-bottom",children:[e(re,{onClick:()=>{_.Share.set({type:"image",data:{src:s.activeImage.src,isVideo:s.activeImage.isVideo}})}}),(s==null?void 0:s.activeImage.id)&&f(J,{children:[e("div",{onClick:()=>{T("Camera",{action:"toggleFavourites",ids:[s.activeImage.id],favourite:!y},!0).then(c=>{if(!c)return h("warning","Failed to toggle favourite, server returned success false");B(!y),S.APPS.CAMERA.albums.set(S.APPS.CAMERA.albums.value.map(r=>r.id==="favourites"?{...r,count:y?r.count-1:r.count+1,photoCount:s.activeImage.isVideo?r.photoCount:y?r.photoCount-1:r.photoCount+1,videoCount:s.activeImage.isVideo?y?r.videoCount-1:r.videoCount+1:r.videoCount,cover:s.activeImage.src}:r))})},children:y?e(ce,{}):e(_e,{})}),e(ae,{onClick:()=>{_.PopUp.set({title:t("APPS.PHOTOS.DELETE_IMAGE_POPUP.TITLE"),description:t("APPS.PHOTOS.DELETE_IMAGE_POPUP.DESCRIPTION"),buttons:[{title:t("APPS.PHOTOS.DELETE_IMAGE_POPUP.CANCEL")},{title:t("APPS.PHOTOS.DELETE_IMAGE_POPUP.PROCEED"),color:"red",cb:()=>{T("Camera",{action:"deleteFromGallery",ids:[s.activeImage.id]},!0).then(c=>{if(!c)return h("error","Could not delete from gallery, server returned false");V.reset(),T("Camera",{action:"getAlbums"}).then(r=>{if(!r)return h("error","No data received from server");let A=K.map(R=>{const F=r.mediaTypes[R.id+"Photos"]??0,G=r.mediaTypes[R.id+"Videos"]??0;return{...R,count:F+G,photoCount:F,videoCount:G}});S.APPS.CAMERA.albums.set(r.albums),S.APPS.CAMERA.mediaTypes.set(A)})})}}]})}})]})]})]})})]})};const ne=Z("albums"),w=Z(!1),V=Z(null),X=Z(null),xe={library:e(Ve,{}),albums:e(Ue,{})},Fe=[2,3,4,5];function Ye(){var H;const o=L(ne),a=L(V),l=L(D),O=L(w),C=L(X),p=(H=L(me))==null?void 0:H.active,b=L(Q.PhoneNumber);return g.useEffect(()=>{V.reset(),w.reset(),X.reset()},[b]),g.useEffect(()=>{p!=null&&p.data&&V.set({activeImage:{src:p.data.photo},images:[{src:p.data.photo}]})},[p]),f("div",{className:"photos-container",children:[e("div",{className:"photos-content","data-scroll":o==="albums"&&!l,style:{pointerEvents:a?"none":"all"},children:xe[o]}),!O&&e(ke,{}),e(W,{children:a&&e(Be,{})}),e(W,{children:C&&e(we,{})})]})}export{V as ActiveImage,X as AlbumPickerComponent,w as SelectMode,ne as View,Ye as default,Fe as zoomLevels};
