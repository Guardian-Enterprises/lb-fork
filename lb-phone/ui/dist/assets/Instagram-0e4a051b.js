import{H as _e,r,u as Q,ct as Me,q as L,bb as $e,p as I,bc as he,_ as J,C as U,L as n,j as t,a as e,a3 as fe,bP as qe,N as Ne,cu as De,d as re,F as Y,m as Se,b as me,aV as Ee,b7 as ye,P as oe,a2 as ce,cv as ze,R as Ye,a7 as Ae,K as Ke,E as de,b8 as Pe,T as je,A as Ce,J as le,cw as Ve,cx as Fe,s as te,x as Ue,I as pe,w as Te,a9 as Re,aj as ue,am as Xe,an as Je,aE as Qe,cy as Ze,t as et,ab as Ge,ac as be,aQ as tt,cd as at,bZ as st,ck as nt,c3 as it,cl as rt,af as ct,cz as lt,bf as ot}from"./index-646d6ab8.js";import{S as dt}from"./Switch-65eebfb4.js";import{T as xe}from"./Textarea-a0d39959.js";import{formatNumber as mt}from"./Tiktok-66f361d6.js";import"./Slider-a7b623ee.js";const ie=_e({host:"",participants:[],viewers:0});function ut(){var W,se,Z,ne;const{View:i,Account:m,Func:S}=r.useContext(q),l=Q(me),[A,P]=i,[d]=m,c=Q(ie),[f,v]=r.useState(!1),[o,a]=r.useState(!1),[s,G]=r.useState(null),[b,F]=r.useState(""),p=r.useRef(null),y=r.useRef(null),h=r.useRef(null),[N,w]=r.useState(null),[V,E]=r.useState(null),[u,O]=r.useState(null),[D,R]=r.useState([]),[_,H]=r.useState([]),[z,ee]=r.useState([]);r.useEffect(()=>{p.current.scrollTop=p.current.scrollHeight},[z]),r.useEffect(()=>{const T=l.rtc?new Me({config:l.rtc}):new Me;return T.on("open",g=>{w({peer:T,id:g})}),T.on("call",g=>{g.on("close",()=>{H(M=>M.filter(x=>x.connectionId!==g.connectionId))}),H(M=>[...M,g])}),L("info","Created peer"),()=>{try{for(let g of _)g.close()}catch{L("error","Failed to close calls")}try{T.destroy()}catch{L("error","Failed to destroy peer")}}},[]),r.useEffect(()=>{if(!u||h!=null&&h.current||!N)return;L("info","Creating game render");let T=new $e(u);h.current=T,T.resizeByAspect(3/4);const g=window.innerWidth;g>1280&&T.setQuality(1280/g);let M;if(V||f){L("info","Host is true, creating call"),f?I("Instagram",{action:"setLive",username:d.username,verified:d.verified,id:N.id}):V&&I("Instagram",{action:"joinLive",username:V,streamId:N.id}).then(B=>{if(E(null),!B)return L("error","Failed to join live");a(!0)});const x=u.captureStream(24);M=B=>{L("info","Answering call",B),B.answer(x)},N.peer.on("call",M)}return()=>{M&&N.peer.off("call",M),h.current&&h.current.destroy(),h.current=null}},[u,N]);const ae=T=>{T.forEach(g=>{if(g.username===d.username)return L("info","Skipping self");L("info","Adding participant",g);const M=document.createElement("canvas"),x=M.captureStream(0),B=N.peer.call(g.id,x);H(X=>[...X,B]),B.on("close",M.remove),B.on("error",M.remove),B.on("stream",X=>{I("Instagram",{action:"addCall",id:B.connectionId,username:g.username}),R(ge=>[...ge,{stream:X,username:g.username}])})})},$=T=>{T.forEach(g=>{L("info","Removing participant",g),g.username===d.username&&a(!1),R(M=>M.filter(x=>x.username!==g.username))})};r.useEffect(()=>{const T=c.participants;if(!T||!N)return L("warning","No participants");const g=T.filter(x=>!D.find(B=>B.username===x.username));g.length&&ae(g),L("info","Added",g);const M=D.filter(x=>!T.find(B=>B.username===x.username));M.length&&$(M),L("info","Removed",M)},[c.participants,N]),r.useEffect(()=>{const T=d.username===(c==null?void 0:c.host);return v(T),he.ShouldClose.set(!1),T&&R(g=>[...g,{username:c.host}]),()=>{he.ShouldClose.set(!0)}},[]);const j=()=>{U.PopUp.set({title:f?n("APPS.INSTAGRAM.END_LIVE_POPUP.TITLE"):n("APPS.INSTAGRAM.LEAVE_LIVE_POPUP.TITLE"),description:n("APPS.INSTAGRAM.END_LIVE_POPUP.DESCRIPTION").format({action:(f?n("APPS.INSTAGRAM.END_LIVE_POPUP.END"):n("APPS.INSTAGRAM.END_LIVE_POPUP.LEAVE")).toLowerCase()}),buttons:[{title:n("APPS.INSTAGRAM.END_LIVE_POPUP.CANCEL")},{title:f?n("APPS.INSTAGRAM.END_LIVE_POPUP.END"):n("APPS.INSTAGRAM.END_LIVE_POPUP.LEAVE"),color:"red",cb:()=>{k(f)}}]})},C=()=>{I("Instagram",{action:"sendLiveMessage",data:{user:{username:d.username,avatar:d.avatar,verified:d.verified},live:c.host,content:b}}),F("")},k=(T,g)=>{if(f)I("Instagram",{action:"endLive"}).then(()=>{P("feed")});else if(o&&I("Instagram",{action:"endLive"}).then(()=>{P("feed")}),I("Instagram",{action:"stopViewing",username:c.host}),T)he.ShouldClose.set(!0),ie.patch({ended:!0});else{if(g===!1)return;P("feed")}};return J("instagram:addMessage",T=>{T.live===c.host&&ee(g=>[...g,T])}),J("instagram:updateViewers",T=>{T.username===(c==null?void 0:c.host)&&ie.patch({viewers:T.viewers})}),J("instagram:setLive",T=>{ie.set(T)}),J("instagram:liveEnded",T=>{T===(c==null?void 0:c.host)&&k(!0)}),J("instagram:stopLive",()=>P("feed")),J("instagram:endCall",T=>{const g=_.find(M=>M.connectionId===T);g&&(g.close(),H(M=>M.filter(x=>x.connectionId!==T)))}),J("instagram:invitedLive",T=>{T===(c==null?void 0:c.host)&&U.PopUp.set({title:n("APPS.INSTAGRAM.INVITE_LIVE_POPUP.TITLE"),description:n("APPS.INSTAGRAM.INVITE_LIVE_POPUP.DESCRIPTION").format({username:T}),buttons:[{title:n("APPS.INSTAGRAM.INVITE_LIVE_POPUP.NO")},{title:n("APPS.INSTAGRAM.INVITE_LIVE_POPUP.YES"),cb:()=>{E(T),R(g=>[...g,{username:d.username}])}}]})}),J("instagram:joinedLive",T=>{T.host===(c==null?void 0:c.host)&&ie.patch({participants:[...c.participants,T]})}),J("instagram:leftLive",T=>{T.host===(c==null?void 0:c.host)&&(L("info","left live",T),ie.patch({participants:c.participants.filter(g=>g.username!==T.participant)}))}),t("div",{className:"instagram-live-container",children:[e("div",{className:"instagram-streams","data-streams":D.length.toString(),children:D.map((T,g)=>T.username===d.username?t("div",{className:"instagram-stream",children:[e("canvas",{ref:M=>{L("info","setting canvas ref",M),O(M)}}),!f&&e(fe,{onClick:()=>{U.PopUp.set({title:n("APPS.INSTAGRAM.LEAVE_LIVE_POPUP.TITLE"),description:n("APPS.INSTAGRAM.LEAVE_LIVE_POPUP.DESCRIPTION"),buttons:[{title:n("APPS.INSTAGRAM.REMOVE_LIVE_POPUP.CANCEL")},{title:n("APPS.INSTAGRAM.LEAVE_LIVE_POPUP.LEAVE"),color:"red",cb:()=>{I("Instagram",{action:"endLive"}),a(!1)}}]})}})]}):e(ft,{host:f,stream:T.stream,username:T.username},`stream-${g}`))}),c.ended&&t("div",{className:"instagram-stream-ended",children:[e(qe,{onClick:()=>P("feed")}),e("div",{className:"title",children:n("APPS.INSTAGRAM.LIVE_ENDED")})]}),e(Ne,{children:s&&e(ht,{username:c.host,type:s,host:s==="participants"?f||o:f,endLive:k,close:()=>G(null)})}),t("div",{className:"instagram-live",children:[t("div",{className:"live-header",children:[t("div",{className:"profile",onClick:()=>{D.length>1?G("participants"):!f&&!o&&(k(),S.fetchAndSetProfile(c.host))},children:[e("div",{className:"profile-picture",style:{backgroundImage:`url(${S.getAvatar((se=(W=c==null?void 0:c.participants)==null?void 0:W[0])==null?void 0:se.avatar)})`}}),t("div",{className:"name",children:[e(vt,{usernames:c.participants.map(T=>T.username)}),((ne=(Z=c==null?void 0:c.participants)==null?void 0:Z[0])==null?void 0:ne.verified)&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})}),e(De,{})]})]}),t("div",{className:"stats",children:[e("div",{className:"live",children:n("APPS.INSTAGRAM.LIVE")}),t("div",{className:"viewers",onClick:()=>G("viewers"),children:[e("i",{className:"fas fa-eye"}),c.viewers]}),e("i",{className:"far fa-times x",onClick:()=>{f||o?j():k(!1)}})]})]}),t("div",{className:"comment-section",children:[e("div",{className:"comment-feed",ref:p,children:z.map((T,g)=>{let M=S.getAvatar(T.user.avatar);return t("div",{className:"comment",children:[e("img",{src:M}),t("div",{className:"info",children:[t("div",{className:"name",children:[T.user.username,T.user.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),e("div",{className:"comment-text",children:T.content})]})]},g)})}),t("div",{className:"comment-input",children:[e(re,{type:"text",ref:y,placeholder:n("APPS.INSTAGRAM.COMMENT_PLACEHOLDER"),onChange:T=>F(T.target.value),onKeyDown:T=>{T.key==="Enter"&&b.replace(/ /g,"").length>0&&(C(),y.current.value="")}}),e("i",{className:"far fa-paper-plane",onClick:()=>{b.replace(/ /g,"").length>0&&(C(),y.current.value="")}}),(f||o)&&e("i",{className:"fas fa-repeat",onClick:()=>{I("Instagram",{action:"flipCamera"})}})]})]})]})]})}const ft=i=>{const m=r.useRef(null);return r.useEffect(()=>{if(!(m!=null&&m.current))return L("warning","No video ref");m.current.srcObject=i.stream,m.current.play().catch(()=>L("error","Failed to play video stream"))},[i==null?void 0:i.stream]),t("div",{className:"instagram-stream",children:[i.host&&e(fe,{onClick:()=>{U.PopUp.set({title:n("APPS.INSTAGRAM.REMOVE_LIVE_POPUP.TITLE").format({username:i.username}),description:n("APPS.INSTAGRAM.REMOVE_LIVE_POPUP.DESCRIPTION").format({username:i.username}),buttons:[{title:n("APPS.INSTAGRAM.REMOVE_LIVE_POPUP.CANCEL")},{title:n("APPS.INSTAGRAM.REMOVE_LIVE_POPUP.REMOVE"),color:"red",cb:()=>{I("Instagram",{action:"removeLive",username:i.username}).then(()=>{})}}]})}}),e("video",{autoPlay:!0,ref:m})]})},vt=i=>{let m=i.usernames.map((S,l)=>S).join(", ");return m.length>9&&(m=m.substring(0,9)+"..",m[m.length-3]===","&&(m=m.substring(0,m.length-3)+"..")),e(Y,{children:m})},ht=i=>{const[m,S]=r.useState([]);return r.useEffect(()=>{var l;if(i.type==="participants"){S((l=ie.value)==null?void 0:l.participants);return}I("Instagram",{action:"getLiveViewers",username:i.username}).then(A=>{A&&S(A)})},[]),t(Se.div,{className:"story-modal","data-type":"live",initial:{y:600},animate:{y:0},exit:{y:600},transition:{duration:.35,ease:"easeInOut"},children:[t("div",{className:"story-modal-header",children:[e("div",{className:"close-border",onClick:()=>i.close()}),e("div",{className:"title",children:i.type==="viewers"?n("APPS.INSTAGRAM.WHOS_WATCHING"):n("APPS.INSTAGRAM.IN_THIS_ROOM")})]}),e("div",{className:"story-modal-content",children:e("div",{className:"viewers",children:m.map((l,A)=>e(gt,{type:i.type,user:l,host:i.host,endLive:i.endLive},A))})})]})},gt=({user:i,host:m,type:S,endLive:l})=>{var f;const A=(f=Q(ie))==null?void 0:f.participants,{Func:P}=r.useContext(q),[d,c]=r.useState(!1);return t("div",{className:"item",children:[t("div",{className:"user",onClick:()=>{m||(l(!1,!1),P.fetchAndSetProfile(i.username))},children:[e("div",{className:"profile-picture",children:e("img",{src:P.getAvatar(i.avatar)})}),t("div",{className:"user-details",children:[t("div",{className:"username",children:[i.username,i.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),e("div",{className:"name",children:i.name})]})]}),m&&S==="viewers"&&(A.find(v=>v.username===i.username)?e("div",{className:"remove",onClick:v=>{v.stopPropagation(),U.PopUp.set({title:n("APPS.INSTAGRAM.REMOVE_LIVE_POPUP.TITLE").format({username:i.username}),description:n("APPS.INSTAGRAM.REMOVE_LIVE_POPUP.DESCRIPTION").format({username:i.username}),buttons:[{title:n("APPS.INSTAGRAM.REMOVE_LIVE_POPUP.CANCEL")},{title:n("APPS.INSTAGRAM.REMOVE_LIVE_POPUP.REMOVE"),color:"red",cb:()=>{I("Instagram",{action:"removeLive",username:i.username}).then(()=>{})}}]})},children:n("APPS.INSTAGRAM.REMOVE")}):e("div",{className:"invite",onClick:v=>{v.stopPropagation(),!d&&I("Instagram",{action:"inviteLive",username:i.username},()=>{c(!0)})},children:d?n("APPS.INSTAGRAM.INVITED"):n("APPS.INSTAGRAM.INVITE")}))]})};function He(i){const m=Q(oe.Settings);return e(Y,{children:i.liked?e(Ee,{onClick:i.onClick,color:"#ed4956"}):e(ye,{onClick:i.onClick,color:m.display.theme==="dark"?"#ffffff":"#262626"})})}function We(i){const{Account:m,View:S,Func:l,UserPanel:A}=r.useContext(q),[P]=m,[d,c]=S,[f,v]=A,[o,a]=r.useState(i.data),s=r.useRef(null),[G,b]=r.useState(0),[F,p]=r.useState(!1),y=Q(je),h=Q(Ce),N={pos:{startLeft:0,startX:0},onMouseDown:E=>{de("Instagram")&&(N.pos={startLeft:s.current.scrollLeft,startX:E.clientX},s.current.style.userSelect="none",document.addEventListener("mouseup",N.onMouseUp),document.addEventListener("mousemove",N.onMove))},onMove:E=>{const u=(E.clientX-N.pos.startX)/Pe();s.current.scrollLeft=N.pos.startLeft-u;const O=s.current.getBoundingClientRect();(O.left*Pe()-5>E.clientX||E.clientX>O.right*Pe()-5)&&N.onMouseUp()},onMouseUp:()=>{s.current.style.removeProperty("user-select"),document.removeEventListener("mouseup",N.onMouseUp),document.removeEventListener("mousemove",N.onMove);const E=JSON.parse(o.media),u=s.current.clientWidth;let O=G;const D=s.current.scrollLeft-N.pos.startLeft;D>u/2&&O<E.length-1?O++:D<-u/2&&O>0&&O--,w(O)}},w=E=>{s.current.scrollTo({left:E*s.current.offsetWidth,behavior:"smooth"}),b(E)};J("instagram:updatePostData",E=>{if(!E||E.postId!==o.id)return L("warning","instagram:updatePostData","Post ID's do not match");a(u=>({...u,[E.data]:E.increment?u[E.data]+1:u[E.data]-1}))});const V=E=>{if(E.detail===2){if(!o.id)return;o.liked||I("Instagram",{action:"toggleLike",data:{postId:o.id,toggle:!o.liked,isComment:!1}},!o.liked).then(u=>{a(O=>({...O,liked:u})),p(!0),setTimeout(()=>p(!1),1e3)})}};return t("div",{className:"post",id:i.last?"last":"","data-id":o.id,"data-active":i.active,children:[t("div",{className:"post-header",children:[e("img",{className:"profile-picture",onClick:()=>l.fetchAndSetProfile(o.username),src:l.getAvatar(o.avatar)}),t("div",{className:"post-info",children:[t("div",{className:"name",onClick:()=>l.fetchAndSetProfile(o.username),children:[o.username,o.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),o.location&&e("div",{className:"location",children:o.location})]})]}),t("div",{className:"post-body",children:[F&&e("div",{className:"popup-heart","data-visible":F,children:e(Ee,{})}),e("div",{className:"image-container",ref:s,onMouseDown:N.onMouseDown,children:JSON.parse(o.media).map((E,u)=>{var O;return e("div",{className:"image",onClick:V,children:ce(E)?e(Pt,{attachment:E,active:i.active&&!(y!=null&&y.visible)&&((O=h==null?void 0:h.active)==null?void 0:O.name)==="Instagram"}):e("img",{src:E})},u)})}),t("div",{className:"actions",children:[t("div",{className:"like-comment",children:[e(He,{liked:o.liked,onClick:()=>{o.id&&I("Instagram",{action:"toggleLike",data:{postId:o.id,toggle:!o.liked,isComment:!1}},!o.liked).then(E=>{a(u=>({...u,liked:E}))})}}),e(ze,{onClick:()=>l.fetchAndSetComments({id:o.id,username:o.username,avatar:o.avatar,verified:o.verified,caption:o.caption,timestamp:o.timestamp})}),(o.username===P.username||P.isAdmin)&&e(Ye,{onClick:()=>{U.PopUp.set({title:n("APPS.INSTAGRAM.DELETE_POST_POPUP.TITLE"),description:n("APPS.INSTAGRAM.DELETE_POST_POPUP.DESCRIPTION"),buttons:[{title:n("APPS.INSTAGRAM.DELETE_POST_POPUP.CANCEL")},{title:n("APPS.INSTAGRAM.DELETE_POST_POPUP.PROCEED"),color:"red",cb:()=>{I("Instagram",{action:"deletePost",id:o.id},!0).then(E=>{if(!E)return L("error","Instagram","Failed to delete post");c("feed")})}}]})}})]}),JSON.parse(o.media).length>1&&e("div",{className:"scroll-dots",children:JSON.parse(o.media).map((E,u)=>e("div",{className:`dot ${G==u?"active":""}`,onClick:()=>w(u)},u))})]}),t("div",{className:"liked-by",onClick:()=>{v({display:!0,data:{title:n("APPS.INSTAGRAM.LIKED_BY"),postId:o.id,cb:()=>{c("feed")}}})},children:[o.like_count," ",n("APPS.INSTAGRAM.LIKES")]}),t("div",{className:"caption",children:[e("span",{className:"user",onClick:E=>{E.stopPropagation(),l.fetchAndSetProfile(o.username)},children:o.username}),Ae(o.caption)," "]}),e("div",{className:"comments",onClick:E=>{E.stopPropagation(),l.fetchAndSetComments({id:o.id,username:o.username,avatar:o.avatar,verified:o.verified,caption:o.caption,timestamp:o.timestamp})},children:o.comment_count>0?n("APPS.INSTAGRAM.VIEW_ALL_COMMENTS").format({count:o.comment_count}):n("APPS.INSTAGRAM.FIRST_COMMENT")}),e("div",{className:"date",children:Ke(o.timestamp)})]})]})}const Pt=i=>{var P;const[m,S]=r.useState(i.active),l=Q(oe.Settings),A=r.useRef(null);return r.useEffect(()=>{var d,c,f,v;S(i.active),!(!A.current||((d=l==null?void 0:l.sound)==null?void 0:d.volume)===void 0)&&i.active&&(A.current.volume=((c=l==null?void 0:l.sound)==null?void 0:c.volume)!==void 0?l.sound.volume:.5,A.current.currentTime=0,i.active?(f=A.current)==null||f.play().catch(o=>{}):(v=A.current)==null||v.pause().catch(o=>{}))},[i.active]),r.useEffect(()=>{var d,c;!A.current||((d=l==null?void 0:l.sound)==null?void 0:d.volume)===void 0||i.active&&(A.current.volume=((c=l==null?void 0:l.sound)==null?void 0:c.volume)!==void 0?l.sound.volume:.5)},[(P=l==null?void 0:l.sound)==null?void 0:P.volume]),e("video",{ref:A,src:i.attachment,autoPlay:!0,loop:!0,muted:!i.active,onLoadedMetadata:d=>{var c;i.active&&(d.currentTarget.volume=((c=l==null?void 0:l.sound)==null?void 0:c.volume)!==void 0?l.sound.volume:.5)}})},K={account:{username:"lb",name:"LB",avatar:"https://docs.lbscripts.com/images/icons/icon.png",bio:`Official LB account
https://lbphone.com`,verified:!0},accounts:{lb:{username:"lb",name:"LB",avatar:"https://docs.lbscripts.com/images/icons/icon.png",bio:`Official LB account
https://lbphone.com`,verified:!0,following:2,followers:13,posts:2,followingList:["loaf","breze"],followerList:["loaf","breze"]},breze:{username:"breze",name:"Breze",bio:`Hey, its breze 
https://lbphone.com`,verified:!0,following:2,followers:1,posts:2,followingList:["lb","loaf"],followerList:["lb","loaf"]},loaf:{username:"loaf",name:"Loaf Scripts",bio:`Loaf Scritps official account 
https://lbphone.com`,verified:!0,following:2,followers:1,posts:2,followingList:["lb","breze"],followerList:["lb","breze"]}},posts:[{id:"1",username:"breze",name:"Breze",verified:!0,caption:"sunsets are the best",media:'["https://r2.fivemanage.com/images/GRBUI6C4orbD.webp", "https://r2.fivemanage.com/images/rafgjPwSYnn2.png"]',location:"Sandy Shores",like_count:2,comment_count:0,timestamp:Date.now()-1e3*60*60*24*1},{id:"2",username:"lb",name:"LB",verified:!0,caption:"dump",media:'["https://r2.fivemanage.com/images/upTPndukc2PD.webp", "https://r2.fivemanage.com/images/X4pfDFiSFvhi.webp"]',location:"Los Santos",like_count:8,comment_count:2,timestamp:Date.now()-1e3*60*60*24*2}],stories:[{id:"1",username:"lb",avatar:"https://docs.lbscripts.com/images/icons/icon.png",verified:!0,seen:0,media:[{id:"2",image:"https://r2.fivemanage.com/images/oRKcdeTA8oBy.png",timestamp:Date.now()-1e3*60*60*4,seen:!1,views:2,viewers:[{username:"Breze"},{username:"Loaf"}]}]},{id:"2",username:"breze",verified:!0,seen:0,media:[{id:"1",image:"https://r2.fivemanage.com/images/otBLdXG7WFeu.webp",timestamp:Date.now()-1e3*60*60*2,seen:!1},{id:"2",image:"https://r2.fivemanage.com/images/ZsmnyJOA2rc5.png",timestamp:Date.now()-1e3*60*60*3,seen:!1}]},{id:"3",username:"loaf",verified:!0,seen:1,media:[{id:"1",image:"https://r2.fivemanage.com/images/X4pfDFiSFvhi.webp",timestamp:Date.now()-1e3*60*60*3,seen:!0},{id:"2",image:"https://r2.fivemanage.com/images/upTPndukc2PD.webp",timestamp:Date.now()-1e3*60*60*4,seen:!0}]}],comments:[{postId:"2",user:{username:"breze",verified:!0},comment:{id:"1",content:"nice",timestamp:Date.now()-1e3*60*60*24,likes:0}},{postId:"2",user:{username:"loaf",verified:!0},comment:{id:"2",content:"haha, nice picture",timestamp:Date.now()-1e3*60*60*22,likes:1,liked:!0}}],messages:[{id:"1",username:"breze",name:"Breze",verified:!0,content:"hey",messages:[{id:"1",sender:"breze",content:"hey",timestamp:Date.now()-1e3*60*60*4}],timestamp:Date.now()-1e3*60*60*4},{id:"2",username:"loaf",name:"Loaf Scripts",verified:!1,content:"yoo, your last post was fire",messages:[{id:"3",sender:"loaf",content:"yoo, your last post was fire",timestamp:Date.now()-1e3*60*60*8}],timestamp:Date.now()-1e3*60*60*8}],notifications:[{type:"like_photo",username:"loaf",name:"Loaf Scripts",postId:"1",photo:"https://r2.fivemanage.com/images/upTPndukc2PD.webp",timestamp:Date.now()-1e3*60*60*2},{type:"follow",username:"loaf",name:"Loaf Scripts",isFollowing:!0,timestamp:Date.now()-1e3*60*60*24*3}]};function At(){const{Account:i,View:m,Func:S,Stories:l}=r.useContext(q),[A,P]=m,[d]=i,[c,f]=r.useState([]),[v,o]=r.useState([]),[a,s]=l,[G,b]=r.useState(null);r.useEffect(()=>{de("Instagram")&&I("Instagram",{action:"getPosts",filters:{following:!0},page:0},K.posts).then(h=>{if(!h)return L("error","Failed to fetch posts");f(h)})},[]),r.useEffect(()=>{de("Instagram")&&A==="feed"&&(I("Instagram",{action:"getLives"}).then(h=>{h&&o(h)}),I("Instagram",{action:"getStories"},K.stories).then(h=>{if(!h)return L("warning","Failed to fetch stories");s([...h.sort((N,w)=>{if(N.seen===w.seen)return 0;if(N.seen===1)return 1;if(w.seen===1)return-1})])}))},[A]),new IntersectionObserver(F,{rootMargin:"20px",threshold:.5});function F(h){h.forEach(N=>{if(N.isIntersecting){let V=N.target.getAttribute("data-id");b(V)}})}const{handleScroll:p}=le({fetchData:h=>I("Instagram",{action:"getPosts",filters:{following:!0},page:h}),onDataFetched:h=>f([...c,...h]),perPage:25});r.useEffect(()=>{const h=document.querySelector(".stories");return h==null||h.addEventListener("wheel",N=>{N.preventDefault(),h.scrollLeft+=N.deltaY}),()=>{h==null||h.removeEventListener("wheel",N=>{N.preventDefault(),h.scrollLeft+=N.deltaY})}},[]),J("instagram:updateLives",h=>{h&&o(h)});const y=()=>{U.PopUp.set({title:n("APPS.INSTAGRAM.GO_LIVE_POPUP.TITLE"),description:n("APPS.INSTAGRAM.GO_LIVE_POPUP.DESCRIPTION"),buttons:[{title:n("APPS.INSTAGRAM.GO_LIVE_POPUP.CANCEL")},{title:n("APPS.INSTAGRAM.GO_LIVE_POPUP.PROCEED"),color:"red",cb:()=>{I("Instagram",{action:"goLive",user:{username:d.username,avatar:S.getAvatar(d==null?void 0:d.avatar),verified:d.verified}}).then(h=>{if(!h)return L("error","Failed to go live");ie.set({host:d.username,participants:[{username:d.username,name:d.username,avatar:S.getAvatar(d==null?void 0:d.avatar),verified:d.verified}],viewers:0}),P("live")})}}]})};return t(Y,{children:[t("div",{className:"instagram-header feed-header",children:[t("div",{className:"name",children:[d.username,d.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),e(Ve,{onClick:()=>P("dmList")})]}),t("div",{className:"feed",onScroll:p,children:[e("div",{className:"stories-wrapper",children:t("div",{className:"stories",children:[t("div",{className:"story self",onClick:()=>{U.ContextMenu.set({buttons:[{title:n("APPS.INSTAGRAM.GO_LIVE"),cb:()=>y()},{title:n("APPS.INSTAGRAM.CREATE_STORY"),cb:()=>{var h,N,w;U.Gallery.set({includeVideos:!0,allowExternal:(w=(N=(h=me)==null?void 0:h.value)==null?void 0:N.AllowExternal)==null?void 0:w.InstaPic,onSelect:V=>{I("Instagram",{action:"addToStory",media:V.src},Math.random().toString(36).substring(7)).then(E=>{if(!E)return L("error","Failed to add story");s([{username:d.username,avatar:d.avatar,verified:d.verified,seen:0,id:E},...a.filter(u=>u.username!==d.username)])})}})}}]})},children:[e("div",{className:"profile-picture",style:{backgroundImage:`url(${S.getAvatar(d==null?void 0:d.avatar)})`},children:e("div",{className:"plus",children:e("i",{className:"far fa-plus"})})}),e("div",{className:"name",children:n("APPS.INSTAGRAM.YOUR_STORY")})]}),Object.keys(v).map(h=>{var N;return t("div",{className:"story",onClick:()=>{var w;I("Instagram",{action:"viewLive",username:((w=v[h])==null?void 0:w.participant)??h}).then(V=>{var O,D,R,_;if(!V)return L("error","Failed to view live, perhaps it ended?");let E=(O=v[h])!=null&&O.participant?v[(D=v[h])==null?void 0:D.participant]:v[h],u=(E==null?void 0:E.participants)??[];u.unshift({username:((R=v[h])==null?void 0:R.participant)??h,name:E.name,avatar:E.avatar,verified:E.verified,id:E.id}),ie.set({host:((_=v[h])==null?void 0:_.participant)??h,participants:u,viewers:V}),P("live")})},children:[e("div",{className:"profile-picture",style:{backgroundImage:`url(${S.getAvatar((N=v[h])==null?void 0:N.avatar)})`},children:e("img",{className:"circle live",src:"./assets/img/icons/instagram/LiveCircle.svg"})}),e("div",{className:"name",children:h})]},h)}),a.map(h=>t("div",{className:"story",onClick:N=>{let[w,V]=Fe(N);S.fetchAndSetStory(h,null,{x:w,y:V})},children:[e("div",{className:"profile-picture",style:{backgroundImage:`url(${S.getAvatar(h==null?void 0:h.avatar)})`},children:e("img",{className:"circle","data-seen":h.seen===1,src:"./assets/img/icons/instagram/StoryCircle.svg"})}),e("div",{className:"name",children:h.username})]},h.username))]})}),c.length===0&&e("div",{className:"no-posts",children:n("APPS.INSTAGRAM.EMPTY_FEED")}),c.map(h=>e(We,{data:h,active:G===h.id},h.id))]})]})}function ke(){const{View:i,Account:m,LoggedIn:S}=r.useContext(q),l=Q(oe.Settings),[A,P]=r.useState(""),[d,c]=r.useState(""),[f,v]=r.useState(""),[o,a]=i,[s,G]=m,[b,F]=S,[p,y]=r.useState("login"),h=()=>{I("Instagram",{action:"logIn",username:d,password:f},{success:!!K.accounts[d],account:K.accounts[d]}).then(w=>{if(w.success&&w.account)I("isAdmin",null,!1).then(V=>{te.APPS.INSTAGRAM.account.set(w.account),G({...w.account,isAdmin:V}),a("feed"),F(!0)});else{if(w.error)return U.PopUp.set({title:n("APPS.INSTAGRAM.ERROR"),description:n(`APPS.INSTAGRAM.${w.error}`),buttons:[{title:n("APPS.INSTAGRAM.OK")}]});L("error","Instagram LogIn Error",w.error)}})},N=()=>{let w=d.toLowerCase().replace(/\s/g,""),V=w.match(me.value.UsernameFilter);if(!V||(V==null?void 0:V[0])!==w||w.length<3||w.length>15){L("warning","Username did not match regex"),U.PopUp.set({title:n("APPS.INSTAGRAM.ERROR"),description:n("APPS.INSTAGRAM.USERNAME_NOT_ALLOWED"),buttons:[{title:n("APPS.INSTAGRAM.OK")}]});return}I("Instagram",{action:"createAccount",name:A,username:w,password:f},{success:!K.accounts[w]}).then(E=>{if(E.success)I("isAdmin").then(u=>{let O={name:A,username:w,posts:0,followers:0,following:0};te.APPS.INSTAGRAM.account.set(O),G({...O,isAdmin:u}),a("feed"),F(!0)});else{if(E.error)return U.PopUp.set({title:n("APPS.INSTAGRAM.ERROR"),description:n(`APPS.INSTAGRAM.${E.error}`),buttons:[{title:n("APPS.INSTAGRAM.OK")}]});L("error","couldn't create account",E)}})};return r.useEffect(()=>{P(""),c(""),v("")},[p]),e("div",{className:"log-in",children:t(Y,{children:[e("div",{className:"wrapper",children:p==="login"?t(Y,{children:[e("img",{src:"./assets/img/icons/instagram/logo.png","data-theme":l.display.theme}),t("div",{className:"form",children:[e(re,{placeholder:n("APPS.INSTAGRAM.USERNAME_PLACEHOLDER"),type:"text",className:"username",onChange:w=>c(w.target.value.replace(/\s/g,"")),maxLength:15},1),e(re,{placeholder:n("APPS.INSTAGRAM.PASSWORD_PLACEHOLDER"),type:"password",onChange:w=>v(w.target.value),maxLength:50},3),e("div",{className:"button",onClick:h,children:n("APPS.INSTAGRAM.LOG_IN")})]})]}):t(Y,{children:[e("img",{src:"./assets/img/icons/instagram/logo.png","data-theme":l.display.theme}),t("div",{className:"form",children:[e(re,{placeholder:n("APPS.INSTAGRAM.NAME_PLACEHOLDER"),type:"text",onChange:w=>P(w.target.value),maxLength:20},2),e(re,{placeholder:n("APPS.INSTAGRAM.USERNAME_PLACEHOLDER"),type:"text",className:"username",onChange:w=>c(w.target.value.replace(/\s/g,"")),maxLength:15},4),e(re,{placeholder:n("APPS.INSTAGRAM.PASSWORD_PLACEHOLDER"),type:"password",onChange:w=>v(w.target.value),maxLength:50}),e("div",{className:"button",onClick:N,children:n("APPS.INSTAGRAM.CREATE_ACCOUNT")})]})]})}),e("div",{className:"footer",children:p==="login"?t(Y,{children:[n("APPS.INSTAGRAM.NOT_HAVE_ACCOUNT")," ",e("span",{onClick:()=>y("createAccount"),children:n("APPS.INSTAGRAM.CREATE_ACCOUNT")})]}):t(Y,{children:[n("APPS.INSTAGRAM.HAVE_ACCOUNT")," ",e("span",{onClick:()=>y("login"),children:n("APPS.INSTAGRAM.LOG_IN")})]})})]})})}const Ie=_e(!1);function Nt(){var d,c,f,v,o;const{Func:i}=r.useContext(q),m=Q(Ce),[S,l]=r.useState(null),A=Q(Ie);r.useEffect(()=>{de("Instagram")&&I("Instagram",{action:"getNotifications"},K.notifications).then(a=>{if(!a)return L("warning","Failed to fetch notifications, or no results?");l(a)})},[m==null?void 0:m.active]);const{handleScroll:P}=le({fetchData:a=>I("Instagram",{action:"getNotifications",page:a}),onDataFetched:a=>l(s=>({...s,notifications:[...s.notifications,...a]})),perPage:25});return t("div",{className:"notifications-container",children:[e(Ne,{children:A&&e(St,{})}),e("div",{className:"notifications-header",children:n("APPS.INSTAGRAM.ACTIVITY")}),t("div",{className:"notifications-body",onScroll:P,children:[((d=S==null?void 0:S.requests)==null?void 0:d.total)>0&&t("div",{className:"follow-requests",onClick:()=>Ie.set(!0),children:[t("div",{className:"item-data",children:[e("div",{className:"profile-pictures","data-multiple":S.requests.total>1,children:S.requests.recent.map((a,s)=>e("img",{src:i.getAvatar(a.avatar)},s))}),t("div",{className:"item-body",children:[e("div",{className:"title",children:n("APPS.INSTAGRAM.FOLLOW_REQUESTS")}),e("div",{className:"subtitle",children:S.requests.total>1?n("APPS.INSTAGRAM.ANDOTHERS").format({username:(c=S.requests.recent[0])==null?void 0:c.username,amount:((f=S.requests)==null?void 0:f.total)-1}):(v=S.requests.recent[0])==null?void 0:v.username})]})]}),t("div",{className:"actions",children:[e("div",{className:"blue-dot"}),e(Ue,{})]})]}),(o=S==null?void 0:S.notifications)==null?void 0:o.map((a,s)=>{let G=s===S.notifications.length-1?"last":"";return e(pt,{notification:a,last:G},s)})]})]})}const St=()=>{const{Func:i}=r.useContext(q),[m,S]=r.useState(""),[l,A]=r.useState([]),P=[{class:"follow",label:n("APPS.INSTAGRAM.CONFIRM"),action:!0},{class:"following",label:n("APPS.INSTAGRAM.DELETE"),action:!1}];r.useEffect(()=>{I("Instagram",{action:"getFollowRequests",page:0},[]).then(c=>{if(!c)return L("warning","Failed to fetch follow requests");L("info","Fetched follow requests",c),A(c)})},[]);const{handleScroll:d}=le({fetchData:c=>I("Instagram",{action:"getFollowRequests",page:c}),onDataFetched:c=>A(c),perPage:15});return t(Se.div,{initial:{opacity:.5,x:150},animate:{opacity:1,x:0},exit:{opacity:.5,x:150},transition:{duration:.2,ease:"easeInOut"},className:"requests-container",children:[t("div",{className:"requests-header",children:[e("div",{className:"icon",children:e(pe,{onClick:()=>Ie.set(!1)})}),e("div",{className:"title",children:n("APPS.INSTAGRAM.FOLLOW_REQUESTS")}),e("span",{})]}),t("div",{className:"requests-body",children:[e(Te,{placeholder:n("SEARCH"),onChange:c=>S(c.target.value)}),e("div",{className:"items",onScroll:d,children:l.filter(c=>c.username.toLowerCase().includes(m.toLowerCase())||c.name.toLowerCase().includes(m.toLowerCase())).map((c,f)=>t("div",{className:"item",children:[t("div",{className:"user",onClick:()=>i.fetchAndSetProfile(c.username),children:[e("img",{className:"avatar",src:i.getAvatar(c.avatar)}),t("div",{className:"user-info",children:[t("div",{className:"username",children:[c.username,c.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),e("div",{className:"name",children:c.name})]})]}),e("div",{className:"buttons",children:P.map((v,o)=>e("div",{className:Re("button",v.class),onClick:a=>{a.stopPropagation(),I("Instagram",{action:"handleFollowRequest",username:c.username,accept:v.action},!0).then(s=>{if(!s)return L("warning","Failed to handle follow request");A(G=>G.filter(b=>b.username!==c.username))})},children:v.label},o))})]},f))})]})]})},pt=({notification:i,last:m})=>{const{Account:S,Func:l}=r.useContext(q),[A]=S,[P,d]=r.useState(i.isFollowing);switch(i.type){case"like_photo":return t("div",{className:"notification-item",id:m,onClick:()=>l.fetchAndSetPost(i.postId),children:[t("div",{className:"notification-body",children:[e("img",{className:"avatar",src:l.getAvatar(i.avatar),onClick:f=>{f.stopPropagation(),l.fetchAndSetProfile(i.username)}}),t("div",{className:"content",children:[e("span",{children:i.username})," ",n("APPS.INSTAGRAM.LIKED_PHOTO"),e("span",{className:"date",children:ue(i.timestamp)})]})]}),ce(i.photo)?e("video",{className:"post-preview",src:i.photo,muted:!0,controls:!1}):e("img",{className:"post-preview",src:i.photo})]});case"like_comment":return e("div",{className:"notification-item",id:m,onClick:()=>l.fetchAndSetPost(i.postId,!0),children:t("div",{className:"notification-body",children:[e("img",{className:"avatar",src:l.getAvatar(i.avatar),onClick:f=>{f.stopPropagation(),l.fetchAndSetProfile(i.username)}}),t("div",{className:"content",children:[e("span",{children:i.username})," ",n("APPS.INSTAGRAM.LIKED_COMMENT").format({comment:i.comment}),e("span",{className:"date",children:ue(i.timestamp)})]})]})});case"comment":return t("div",{className:"notification-item",id:m,onClick:()=>l.fetchAndSetPost(i.postId,!0),children:[t("div",{className:"notification-body",children:[e("img",{className:"avatar",src:l.getAvatar(i.avatar),onClick:f=>{f.stopPropagation(),l.fetchAndSetProfile(i.username)}}),t("div",{className:"content",children:[e("span",{children:i.username})," ",n("APPS.INSTAGRAM.COMMENTED").format({comment:i.comment}),e("span",{className:"date",children:ue(i.timestamp)})]})]}),ce(i.photo)?e("video",{className:"post-preview",src:i.photo,muted:!0,controls:!1}):e("img",{className:"post-preview",src:i.photo})]});case"follow":return t("div",{className:"notification-item",id:m,onClick:()=>l.fetchAndSetProfile(i.username),children:[t("div",{className:"notification-body",children:[e("img",{className:"avatar",src:l.getAvatar(i.avatar),onClick:()=>l.fetchAndSetProfile(i.username)}),t("div",{className:"content",children:[e("span",{children:i.username})," ",n("APPS.INSTAGRAM.FOLLOWED"),e("span",{className:"date",children:ue(i.timestamp)})]})]}),e("div",{className:`button ${P?"following":"follow"}`,onClick:f=>{f.stopPropagation(),A.username!==i.username&&(P?U.PopUp.set({title:n("APPS.INSTAGRAM.UNFOLLOW_POPUP.TITLE"),description:n("APPS.INSTAGRAM.UNFOLLOW_POPUP.DESCRIPTION").format({name:i.username}),buttons:[{title:n("APPS.INSTAGRAM.UNFOLLOW_POPUP.CANCEL")},{title:n("APPS.INSTAGRAM.UNFOLLOW_POPUP.PROCEED"),color:"red",cb:()=>{I("Instagram",{action:"toggleFollow",data:{username:i.username,following:!P}},!0).then(()=>{d(v=>!v)})}}]}):I("Instagram",{action:"toggleFollow",data:{username:i.username,following:!P}},!0).then(()=>{d(v=>!v)}))},children:P?n("APPS.INSTAGRAM.FOLLOWING"):n("APPS.INSTAGRAM.FOLLOW")})]})}};function It(){var k,W,se,Z,ne,T;const{View:i,Profile:m,Account:S,Func:l,GoBack:A,Post:P,UserPanel:d,LoggedIn:c,Dm:f}=r.useContext(q),[v,o]=i,[a,s]=m,[G,b]=c,[F,p]=S,[y,h]=P,[N,w]=f,[V,E]=d,[u,O]=A,[D,R]=r.useState(!1),[_,H]=r.useState(!1),[z,ee]=r.useState(null);r.useEffect(()=>{de("Instagram")&&a.username&&(R(F.username===a.username),I("Instagram",{action:"getPosts",filters:{profile:!0,username:a.username},page:0}).then(g=>{g&&ee(g)}))},[a==null?void 0:a.username]);const{handleScroll:ae}=le({fetchData:g=>I("Instagram",{action:"getPosts",filters:{profile:!0,username:a.username},page:g}),onDataFetched:g=>ee([...z,...g]),perPage:15}),$=()=>{if(!a.name)return L("warning","Name is required, not saving");I("Instagram",{action:"updateProfile",data:{name:a.name,bio:a.bio,avatar:a.avatar,private:a.private}},!0).then(g=>{if(!g)return L("warning","Failed to update profile");te.APPS.INSTAGRAM.account.set({...F,name:a.name,bio:a.bio,avatar:a.avatar,private:a.private}),H(!1),L("info","Successfully updated profile")})};J("instagram:updateProfileData",g=>{g.username===a.username&&s({...a,[g.data]:g.increment?a[g.data]+1:a[g.data]-1})});const j=r.useRef(!0);r.useEffect(()=>{if(j.current){j.current=!1;return}I("Instagram",{action:"toggleFollow",data:{username:a.username,following:a.isFollowing}},!0)},[a.isFollowing]);const C=()=>{I("AccountSwitcher",{action:"getAccounts",app:"Instagram"}).then(g=>{var B;if(!g)return L("info","No accounts found");let M=F.isAdmin,x=(B=g==null?void 0:g.filter(X=>X!==a.username))==null?void 0:B.map(X=>({title:X,cb:()=>{I("AccountSwitcher",{action:"switch",app:"Instagram",account:X}).then(ge=>{I("Instagram",{action:"isLoggedIn"}).then(ve=>{ve?(te.APPS.INSTAGRAM.account.set(ve),p({...ve,isAdmin:M}),o("feed"),b(!0)):te.APPS.INSTAGRAM.account.set(null)})})}}));U.ContextMenu.set({buttons:[{title:F.username},...x,{title:n("APPS.INSTAGRAM.ADD_ACCOUNT"),cb:()=>b(!1)}]})})};return e(Y,{children:a&&t("div",{className:"profile",children:[e(Ne,{children:_&&t(Se.div,{className:"edit-profile",initial:{y:750,opacity:.75},animate:{y:0,opacity:1},exit:{y:750,opacity:.75},transition:{duration:.3,ease:"easeInOut"},children:[t("div",{className:"edit-profile-header",children:[e("div",{className:"cancel",onClick:()=>H(!1),children:n("CANCEL")}),e("div",{className:"title",children:n("APPS.INSTAGRAM.EDIT_PROFILE")}),e("div",{className:"save",onClick:()=>$(),children:n("APPS.INSTAGRAM.DONE")})]}),t("div",{className:"edit-profile-body",children:[t("div",{className:"profile-picture",onClick:()=>{var g,M,x;U.Gallery.set({allowExternal:(x=(M=(g=me)==null?void 0:g.value)==null?void 0:M.AllowExternal)==null?void 0:x.InstaPic,onSelect:B=>{s({...a,avatar:B.src}),p({...F,avatar:B.src})}})},children:[e("img",{src:l.getAvatar(a.avatar),alt:"profile"}),e("span",{children:n("APPS.INSTAGRAM.CHANGE_PICTURE")})]}),t("div",{className:"profile-items",children:[t("div",{className:"item",children:[e("div",{className:"title",children:n("APPS.INSTAGRAM.NAME")}),e(re,{placeholder:n("APPS.INSTAGRAM.NAME_PLACEHOLDER"),onChange:g=>{s({...a,name:g.target.value})},maxLength:30,defaultValue:a.name})]}),t("div",{className:"item",children:[e("div",{className:"title",children:n("APPS.INSTAGRAM.BIO")}),e(xe,{placeholder:n("APPS.INSTAGRAM.BIO"),onChange:g=>{s({...a,bio:g.target.value})},maxLength:100,defaultValue:a.bio??""})]}),t("div",{className:"item",children:[e("div",{className:"title",children:n("APPS.INSTAGRAM.PRIVATE")}),e("div",{className:"switch-wrapper",children:e(dt,{checked:a.private,onChange:()=>s({...a,private:!a.private})})})]})]}),t("div",{className:"buttons",children:[e("div",{className:"button blue",onClick:()=>{U.PopUp.set({title:n("APPS.INSTAGRAM.SIGN_OUT_POPUP.TITLE"),description:n("APPS.INSTAGRAM.SIGN_OUT_POPUP.DESCRIPTION"),buttons:[{title:n("APPS.INSTAGRAM.SIGN_OUT_POPUP.CANCEL")},{title:n("APPS.INSTAGRAM.SIGN_OUT_POPUP.PROCEED"),color:"red",cb:()=>{I("Instagram",{action:"signOut"},!0).then(g=>{if(!g)return L("error","Failed to sign out");b(null),p(null),te.APPS.INSTAGRAM.account.set(null)})}}]})},children:n("APPS.INSTAGRAM.SIGN_OUT")}),((se=(W=(k=me)==null?void 0:k.value)==null?void 0:W.ChangePassword)==null?void 0:se.InstaPic)&&e("div",{className:"button red",onClick:()=>Xe("Instagram",()=>{}),children:n("APPS.INSTAGRAM.CHANGE_PASSWORD")}),((T=(ne=(Z=me)==null?void 0:Z.value)==null?void 0:ne.DeleteAccount)==null?void 0:T.InstaPic)&&e("div",{className:"button red",onClick:()=>{Je("Instagram",()=>{b(null),p(null),te.APPS.INSTAGRAM.account.set(null)})},children:n("APPS.INSTAGRAM.DELETE_ACCOUNT")})]})]})]})}),D?e("div",{className:"instagram-header",children:t("div",{className:"name",style:{cursor:"pointer"},onClick:()=>C(),children:[a.username??"Unknown",a.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})}),e(De,{})]})}):t("div",{className:"profile-header",children:[e("i",{className:"fas fa-chevron-left",onClick:()=>{u!=null&&u.cb?u.cb():o("feed")}}),t("div",{className:"name",children:[a.username??"Unknown",a.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),e("span",{})]}),t("div",{className:"profile-body",children:[t("div",{className:"profile-wrapper",children:[t("div",{className:"top",children:[t("div",{className:"profile-picture",style:{backgroundImage:`url(${l.getAvatar(a.avatar)})`},children:[a.isLive&&(!a.private||a.isFollowing||!D)?e("img",{onClick:()=>{I("Instagram",{action:"getLives"}).then(g=>{var x;let M=a.username;I("Instagram",{action:"viewLive",username:((x=g[M])==null?void 0:x.participant)??M}).then(B=>{var ve,we,Le,Oe;if(!B)return L("error","Failed to view live, perhaps it ended?");let X=(ve=g[M])!=null&&ve.participant?g[(we=g[M])==null?void 0:we.participant]:g[M],ge=(X==null?void 0:X.participants)??[];ge.unshift({username:((Le=g[M])==null?void 0:Le.participant)??M,name:X.name,avatar:X.avatar,verified:X.verified,id:X.id}),ie.set({host:((Oe=g[M])==null?void 0:Oe.participant)??M,participants:ge,viewers:B}),o("live")})})},className:"circle live",src:"./assets/img/icons/instagram/LiveCircle.svg"}):null,a.hasStory&&!a.isLive&&(!a.private||a.isFollowing||D)?e("img",{className:"circle","data-seen":a.seenStory===1,src:"./assets/img/icons/instagram/StoryCircle.svg",onClick:g=>{let[M,x]=Fe(g);l.fetchAndSetStory({username:a.username,avatar:a.avatar,verified:a.verified},null,{x:M,y:x})}}):null]}),t("div",{className:"stats",children:[t("div",{children:[e("div",{className:"value",children:a.posts}),e("div",{className:"label",children:a.posts===1?n("APPS.INSTAGRAM.POST"):n("APPS.INSTAGRAM.POSTS")})]}),t("div",{"data-disabled":!a.isFollowing&&a.private&&!D,onClick:()=>{!a.isFollowing&&a.private&&!D||E({display:!0,data:{title:n("APPS.INSTAGRAM.FOLLOWERS"),username:a.username,cb:()=>{s(a),o("profile"),E({display:!1})}}})},children:[e("div",{className:"value",children:a.followers}),e("div",{className:"label",children:a.followers===1?n("APPS.INSTAGRAM.FOLLOWER"):n("APPS.INSTAGRAM.FOLLOWERS")})]}),t("div",{"data-disabled":!a.isFollowing&&a.private&&!D,onClick:()=>{!a.isFollowing&&a.private&&!D||E({display:!0,data:{title:n("APPS.INSTAGRAM.FOLLOWING"),username:a.username,cb:()=>{s(a),o("profile"),E({display:!1})}}})},children:[e("div",{className:"value",children:a.following}),e("div",{className:"label",children:n("APPS.INSTAGRAM.FOLLOWING")})]})]})]}),e("div",{className:"name",children:a.name}),e("div",{className:"description",children:Ae(a.bio)??""}),e("div",{className:"buttons",children:D?D&&e("div",{className:"button edit",onClick:()=>H(!0),children:n("APPS.INSTAGRAM.EDIT_PROFILE")}):t(Y,{children:[e("div",{className:Re("button",a.requested||a.isFollowing?"following":"follow"),onClick:()=>{a.isFollowing?U.PopUp.set({title:n("APPS.INSTAGRAM.UNFOLLOW_POPUP.TITLE"),description:n("APPS.INSTAGRAM.UNFOLLOW_POPUP.DESCRIPTION").format({name:a.username}),buttons:[{title:n("APPS.INSTAGRAM.UNFOLLOW_POPUP.CANCEL")},{title:n("APPS.INSTAGRAM.UNFOLLOW_POPUP.PROCEED"),color:"red",cb:()=>{s({...a,isFollowing:!1})}}]}):a.private?I("Instagram",{action:"toggleFollow",data:{username:a.username,following:!0}},!0).then(g=>{g&&s({...a,requested:!a.requested})}):s({...a,isFollowing:!0})},children:a.isFollowing?n("APPS.INSTAGRAM.FOLLOWING"):a.requested?n("APPS.INSTAGRAM.REQUESTED"):n("APPS.INSTAGRAM.FOLLOW")}),!a.private||a.isFollowing?e("div",{className:"button following",onClick:()=>{w({username:a.username,name:a.name,verified:a.verified,avatar:a.avatar}),o("dm")},children:n("APPS.INSTAGRAM.MESSAGE")}):null]})})]}),a.private&&!a.isFollowing&&!D?t("div",{className:"private-account",children:[e("div",{className:"icon",children:e(Qe,{})}),e("div",{className:"title",children:n("APPS.INSTAGRAM.PRIVATE_ACCOUNT")}),e("div",{className:"description",children:n("APPS.INSTAGRAM.PRIVATE_ACCOUNT_DESCRIPTION")})]}):e("div",{className:"posts",onScroll:ae,children:z&&z.map((g,M)=>{let x=JSON.parse(g.media)[0];return e("div",{onClick:()=>{O({cb:()=>{s(a),o("profile"),h(null),O(null)}}),h(g),o("post")},children:ce(x)?e("video",{src:x,muted:!0,autoPlay:!0,loop:!0}):e("img",{src:x})},M)})})]})]})})}function Et(){const{Func:i,View:m,GoBack:S,Post:l}=r.useContext(q),[A,P]=m,[d,c]=S,[f,v]=l,[o,a]=r.useState(""),[s,G]=r.useState(""),[b,F]=r.useState([]);r.useState([]);const[p,y]=r.useState([]);r.useEffect(()=>{de("Instagram")&&I("Instagram",{action:"getPosts",page:0},K.posts).then(N=>{if(!N)return L("warning","No posts received in getPosts");y(N)})},[]),r.useEffect(()=>{const N=setTimeout(()=>a(s),500);return()=>clearTimeout(N)},[s]),r.useEffect(()=>{o.length>0&&I("Instagram",{action:"search",query:o},Object.keys(K.accounts).map(N=>K.accounts[N])).then(N=>{N&&F(N)})},[o]);const{handleScroll:h}=le({fetchData:N=>I("Instagram",{action:"getPosts",page:N}),onDataFetched:N=>y([...p,...N]),perPage:15});return t("div",{className:"search-container",children:[e("div",{className:"search-header",children:e(Te,{placeholder:n("SEARCH"),onChange:N=>G(N.target.value)})}),e("div",{className:"search-body",onScroll:h,children:o.length>0?e("div",{className:"search-results",children:b.map(N=>t("div",{className:"item",onClick:()=>i.fetchAndSetProfile(N.username),children:[e("div",{className:"profile-picture",children:e("img",{src:i.getAvatar(N.avatar),alt:"profile"})}),t("div",{className:"user",children:[t("div",{className:"username",children:[N.username,N.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),e("div",{className:"name",children:N.name})]})]}))}):e("div",{className:"feed-grid",children:p.map((N,w)=>{let E=Math.floor(w/3)%2==0,u=!1;u=w%3==(E?1:0),p[w+1]||(u=!1);let O=JSON.parse(N.media)[0];return e("div",{className:`grid-post${u?" big":""}`,onClick:()=>{c({cb:()=>{P("search"),c(null)}}),v(N),P("post")},children:ce(O)?e("video",{src:O,autoPlay:!0,loop:!0,muted:!0}):e("img",{src:O,alt:"post"})},w)})})})]})}function Ct(){const{View:i,GoBack:m,Comments:S,Account:l,Func:A}=r.useContext(q),[P]=l,[d,c]=i,[f]=m,[v,o]=S,[a,s]=r.useState(""),G=r.useRef(null);r.useState(0),r.useState(!1),r.useState(!1);const b=()=>{a.length!==0&&I("Instagram",{action:"postComment",data:{postId:v.post.id,comment:a}},Math.random().toString(36).substring(7)).then(p=>{if(!p)return L("error","Failed to post comment, no ");s(""),G.current.value="",o({...v,post:v.post,comments:[{user:{username:P.username,avatar:P.avatar,verified:P.verified},comment:{id:p,content:a,timestamp:new Date().getTime(),likes:0,liked:!1}},...v.comments]})})},{handleScroll:F}=le({fetchData:p=>I("Instagram",{action:"getComments",postId:v.post.id,page:p}),onDataFetched:p=>o({...v,comments:[...v.comments,...p]}),perPage:25});return t("div",{className:"comments-container",children:[t("div",{className:"comments-header",children:[e(pe,{onClick:()=>{f&&(f!=null&&f.cb)?f.cb():c("feed")}}),e("div",{className:"title",children:n("APPS.INSTAGRAM.COMMENTS")}),e("span",{})]}),t("div",{className:"comments-body",onScroll:F,children:[t("div",{className:"post-info",children:[e("div",{className:"profile-picture",children:e("img",{src:A.getAvatar(v.post.avatar),alt:"profile"})}),t("div",{className:"post-data",children:[t("div",{className:"caption",children:[t("span",{className:"username",children:[v.post.username,v.post.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),Ae(v.post.caption)]}),e("div",{className:"actions",children:e("div",{className:"date",children:Be(v.post.timestamp)})})]})]}),v.comments.map((p,y)=>e(Tt,{data:p},y))]}),t("div",{className:"add-comment",children:[e("div",{className:"profile-picture",children:e("img",{src:A.getAvatar(P.avatar),alt:"profile"})}),t("div",{className:"input-container",children:[e(re,{type:"text",ref:G,placeholder:n("APPS.INSTAGRAM.ADD_COMMENT_AS").format({name:P.username}),onKeyPress:p=>{p.key==="Enter"&&b()},onChange:p=>s(p.target.value)}),e("div",{className:"send",onClick:b,children:n("APPS.INSTAGRAM.POST")})]})]})]})}const Tt=({data:i})=>{const{Func:m}=r.useContext(q),[S,l]=r.useState(i.comment.liked),[A,P]=r.useState(i.comment.likes);return J("instagram:updateCommentLikes",d=>{!d||d.commentId!==i.comment.id||P(c=>c+(d.increment?1:-1))}),t("div",{className:"comment",children:[t("div",{className:"user",children:[e("div",{className:"profile-picture",onClick:()=>m.fetchAndSetProfile(i.user.username),children:e("img",{src:m.getAvatar(i.user.avatar),alt:"profile"})}),t("div",{className:"comment-data",children:[t("div",{className:"caption",children:[t("span",{className:"username",onClick:()=>m.fetchAndSetProfile(i.user.username),children:[i.user.username,i.user.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),i.comment.content]}),t("div",{className:"actions",children:[e("div",{className:"date",children:Be(i.comment.timestamp)}),t("div",{className:"likes",children:[A," ",n("APPS.INSTAGRAM.LIKES").toLowerCase()]})]})]})]}),e(He,{liked:S,onClick:()=>{i.comment.id&&I("Instagram",{action:"toggleLike",data:{postId:i.comment.id,toggle:!S,isComment:!0}},!S).then(d=>{l(d)})}})]})},Be=i=>{const m=new Date(i),l=new Date().getTime()-m.getTime(),A=Math.floor(l/(1e3*60*60*24)),P=Math.floor(l/(1e3*60*60)),d=Math.floor(l/(1e3*60));let c="";return A<1?P<1?c=`${d}m`:c=`${P}h`:A<30?c=`${A}d`:c=`${m.getDate()}/${m.getMonth()+1}/${m.getFullYear()}`,c};function Rt(){const{View:i}=r.useContext(q),[m,S]=i,[l,A]=r.useState(0),[P,d]=r.useState([]),[c,f]=r.useState(""),[v,o]=r.useState(null);return r.useEffect(()=>{var a,s,G;l===0&&U.Gallery.set({allowExternal:(G=(s=(a=me)==null?void 0:a.value)==null?void 0:s.AllowExternal)==null?void 0:G.InstaPic,multiSelect:!0,includeVideos:!0,onCancel:()=>S("feed"),onSelect:b=>{b!=null&&b.length?d(b.map(F=>F.src)):d([b.src]),A(1)}})},[l]),e("div",{className:"newpost-container","data-camera":!1,children:l===1&&t(Y,{children:[t("div",{className:"newpost-header",children:[e(pe,{onClick:()=>A(0)}),e("div",{className:"title",children:n("APPS.INSTAGRAM.NEW_POST")}),e("div",{className:"next",onClick:()=>{I("Instagram",{action:"newPost",data:{caption:c,location:v,images:P}},!0).then(a=>{if(!a)return L("warning","Failed to post");S("feed")})},children:n("APPS.INSTAGRAM.POST")})]}),e("div",{className:"newpost-body",children:t("div",{className:"newpost-content",children:[t("div",{className:"caption",children:[e("div",{className:"attachments",style:{width:`calc(4rem + ${P.length*20}px)`},children:P.slice(0,5).map((a,s)=>e("div",{className:"attachment",style:{left:`${s*20}px`,top:`${s*5}px`,zIndex:s+1},children:ce(a)?e(wt,{src:a}):e("img",{src:a,alt:"image"})},s))}),e("div",{className:"text-area",children:e(xe,{onChange:a=>f(a.target.value),placeholder:n("APPS.INSTAGRAM.CAPTION_PLACEHOLDER")})})]}),e("div",{className:"item",onClick:()=>{U.PopUp.set({title:n("APPS.INSTAGRAM.CHOOSE_LOCATION.TITLE"),description:n("APPS.INSTAGRAM.CHOOSE_LOCATION.DESCRIPTION"),input:{type:"text",maxCharacters:30,onChange:a=>o(a)},buttons:[{title:n("APPS.INSTAGRAM.CHOOSE_LOCATION.CANCEL")},{title:n("APPS.INSTAGRAM.CHOOSE_LOCATION.PROCEED")}]})},children:v?t(Y,{children:[t("div",{className:"label",children:[e(Ze,{}),v]}),e(fe,{onClick:a=>{a.stopPropagation(),o(null)}})]}):t(Y,{children:[e("div",{className:"label",children:n("APPS.INSTAGRAM.LOCATION")}),e(Ue,{})]})})]})})]})})}const wt=({src:i})=>{const[m,S]=r.useState(null);return t(Y,{children:[e("video",{src:i,crossOrigin:"anonymous",controls:!1,onMouseOver:A=>A.currentTarget.play(),onMouseOut:A=>A.currentTarget.pause(),onLoadedMetadata:A=>S(A.currentTarget.duration)}),m&&e("div",{className:"video-duration",children:(A=>{const P=Math.floor(A/60),d=et(A-P*60,0);return`${P}:${d<10?"0"+d:d}`})(m)})]})};function Lt(){const{View:i,Post:m,GoBack:S}=r.useContext(q),[l,A]=i,[P]=S,[d]=m;return e(Y,{children:d&&e("div",{className:"viewpost-container",children:t(Y,{children:[t("div",{className:"viewpost-header",children:[e(pe,{onClick:()=>{P&&(P.cb?P.cb():A(P.view))}}),e("div",{className:"name",children:d.username??"Unknown"}),e("span",{})]}),e("div",{className:"profile-body",children:e(We,{data:d})})]})})})}function Ot(){const{Func:i,Account:m,Dm:S,View:l,GoBack:A}=r.useContext(q);Q(oe.Settings);const[P]=m,[d,c]=l,[f,v]=S,[o,a]=A,[s,G]=r.useState([]),b=r.useRef(null),F=r.useRef(0),[p,y]=r.useState({content:"",attachments:[]}),[h,N]=r.useState(0),[w,V]=r.useState(!1),[E,u]=r.useState(!1);r.useEffect(()=>{var R;V(!1),u(!1),N(0),G([]),I("Instagram",{action:"getMessages",page:0,username:f.username},((R=K.messages.find(_=>_.username===f.username))==null?void 0:R.messages)??[]).then(_=>{_&&G(_.reverse())})},[]),J("instagram:newMessage",R=>{if(f.username!==R.sender)return;G([...s,R]);let _=document.querySelector(".dm-body-container");_.scrollTop=_.scrollHeight});const O=()=>{p.content.length===0&&p.attachments.length===0||I("Instagram",{action:"sendMessage",username:f.username,message:{content:p.content,attachments:p.attachments.length>0?p.attachments:null}},!0).then(R=>{if(!R)return;b.current.value="",G([...s,{sender:P.username,recipient:f.username,content:p.content,attachments:p.attachments,timestamp:Date.now()}]),y({content:"",attachments:[]});let _=document.querySelector(".dm-body-container");_.scrollTop=_.scrollHeight})},{handleScroll:D}=le({fetchData:R=>I("Instagram",{action:"getMessages",username:f.username,page:R}),onDataFetched:R=>{let _=document.querySelector(".dm-body-container");F.current=_.scrollHeight,G([...R.reverse(),...s])},isReversed:!0,perPage:25});return r.useEffect(()=>{let R=document.querySelector(".dm-body-container");const _=R.scrollHeight;R.scrollTop+=_-F.current,R.scroll},[s]),t("div",{className:"dm-container",children:[t("div",{className:"dm-header",children:[e("i",{className:"far fa-chevron-left",onClick:()=>{o&&o.cb?(o.cb(),a(null)):c("dmList")}}),t("div",{className:"profile",onClick:R=>{R.stopPropagation(),a({cb:()=>{v(f),c("dm")}}),i.fetchAndSetProfile(f.username)},children:[e("div",{className:"avatar",children:e("img",{src:i.getAvatar(f.avatar)})}),t("div",{className:"username",children:[f.name??f.username,f.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]})]})]}),e("div",{className:"dm-body-container",onScroll:D,children:e("div",{className:"dm-body",children:s.map((R,_)=>{var ae;let H,z=R.sender===P.username?"self":"other",ee=((ae=s[_+1])==null?void 0:ae.sender)===P.username?"self":"other";return s[_+1]?H=Math.abs(R.timestamp-s[_+1].timestamp)/36e5:ee=void 0,t("div",{className:`message ${z}`,children:[z=="other"?t("div",{className:"message-with-pfp",children:[e("div",{className:Re("profile-picture",z!==ee?"show":"hide"),onClick:$=>{$.stopPropagation(),a({cb:()=>{v(f),c("dm")}}),i.fetchAndSetProfile(f.username)},children:e("img",{src:i.getAvatar(f.avatar)})}),t("div",{className:"message-content",children:[R.content&&e("div",{className:"content",children:Ae(R.content)}),R.attachments&&e("div",{className:"attatchments",children:R.attachments.map(($,j)=>ce($)?e("video",{src:$,controls:!1,loop:!0,autoPlay:!0,muted:!0,onClick:C=>U.FullscreenImage.set($)},j):e(Ge,{src:$,onClick:()=>U.FullscreenImage.set($)},j))})]})]}):t(Y,{children:[R.content&&e("div",{className:"content",children:Ae(R.content)}),R.attachments&&e("div",{className:"attatchments",children:R.attachments.map(($,j)=>ce($)?e("video",{src:$,controls:!1,loop:!0,muted:!0,autoPlay:!0,onClick:C=>{U.FullscreenImage.set($)}},j):e("img",{src:$,onClick:()=>{U.FullscreenImage.set($)}},j))})]}),s[_+1]&&H>6?e("div",{className:"date",children:be(R.timestamp)}):z!==ee&&e("div",{className:"date",children:be(R.timestamp)})]},_)})})}),e("div",{className:"attachments",children:p.attachments.map((R,_)=>t("div",{className:"attachment",children:[ce(R)?e("video",{src:R,muted:!0,controls:!1,loop:!0,autoPlay:!0}):e(Ge,{src:R}),e(fe,{onClick:()=>{y({...p,attachments:p.attachments.filter((H,z)=>z!==_)})}})]},_))}),t("div",{className:"dm-footer",children:[e(re,{type:"text",ref:b,onChange:R=>{y({...p,content:R.target.value})},onKeyDown:R=>{R.key==="Enter"&&O()},placeholder:n("APPS.INSTAGRAM.MESSAGE_PLACEHOLDER")}),p.content.length>0?e("span",{onClick:()=>O(),className:"send",children:n("APPS.INSTAGRAM.SEND")}):e(tt,{onClick:()=>{var R,_,H;p.attachments.length<3&&U.Gallery.set({includeVideos:!0,allowExternal:(H=(_=(R=me)==null?void 0:R.value)==null?void 0:_.AllowExternal)==null?void 0:H.InstaPic,onSelect:z=>y({...p,attachments:[...p.attachments,z.src]})})}})]})]})}function Mt(){const{View:i,Func:m,Dm:S,Account:l,GoBack:A}=r.useContext(q),[P,d]=i,[c]=l,[f,v]=S,[o,a]=A,[s,G]=r.useState(!1),[b,F]=r.useState(""),[p,y]=r.useState(""),[h,N]=r.useState([]);r.useState([]);const[w,V]=r.useState([]);r.useEffect(()=>{de("Instagram")&&I("Instagram",{action:"getRecentMessages",page:0},K.messages).then(u=>{u&&V(u)})},[]);const{handleScroll:E}=le({fetchData:u=>I("Instagram",{action:"getRecentMessages",page:u}),onDataFetched:u=>V([...w,...u]),perPage:25});return r.useEffect(()=>{const u=setTimeout(()=>F(p),500);return()=>clearTimeout(u)},[p]),r.useEffect(()=>{b.length>0?s?I("Instagram",{action:"search",query:b},K.messages.filter(u=>u.username!==c.username)).then(u=>{u&&N(u)}):N(w.filter(u=>{var O;return u.username.includes(b)||((O=u==null?void 0:u.name)==null?void 0:O.includes(b))&&u.username!==c.username})):N([])},[b]),r.useEffect(()=>{F(""),N([])},[s]),e("div",{className:"dm-list",children:s?t("div",{className:"slide up",children:[t("div",{className:"dm-list-header new",children:[e("i",{className:"far fa-chevron-left",onClick:()=>{G(!1),N([])}}),e("div",{className:"title",children:n("APPS.INSTAGRAM.NEW_MESSAGE")}),e("span",{})]}),t("div",{className:"dm-list-body ",children:[t("div",{className:"input",children:[e("span",{children:n("APPS.INSTAGRAM.TO")}),e(re,{type:"text",onChange:u=>y(u.target.value),placeholder:n("SEARCH")})]}),h.length>0&&e("div",{className:"items",children:h.map((u,O)=>t("div",{className:"item",onClick:()=>{G(!1),v(u),d("dm")},children:[e("div",{className:"avatar",onClick:D=>{D.stopPropagation(),a({cb:()=>{d("dmList"),a(null)}}),m.fetchAndSetProfile(u.username)},children:e("img",{src:m.getAvatar(u.avatar)})}),t("div",{className:"info",children:[t("div",{className:"username",children:[u.username,u.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),e("div",{className:"last-message",children:u.name})]})]},O))})]})]}):t(Y,{children:[t("div",{className:"dm-list-header",children:[t("div",{className:"top",children:[e("i",{className:"far fa-chevron-left",onClick:()=>d("feed")}),e("i",{className:"far fa-edit",onClick:()=>G(!0)})]}),e(Te,{placeholder:n("SEARCH"),onChange:u=>y(u.target.value)})]}),e("div",{className:"dm-list-body",onScroll:E,children:e("div",{className:"items",children:b.length>0&&!s?h.map((u,O)=>{var D;return((D=u.content)==null?void 0:D.length)===0&&(u.content=n("APPS.INSTAGRAM.SENT_A_PHOTO")),t("div",{className:"item",onClick:()=>{G(!1),v(u),d("dm")},children:[e("div",{className:"avatar",onClick:R=>{R.stopPropagation(),a({cb:()=>{d("dmList"),a(null)}}),m.fetchAndSetProfile(u.username)},children:e("img",{src:m.getAvatar(u.avatar)})}),t("div",{className:"info",children:[t("div",{className:"username",children:[u.name,u.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),t("div",{className:"last-message",children:[u.content.length>40?u.content.substring(0,40)+"...":u.content,"  ",ue(u.timestamp)]})]})]},O)}):w.map((u,O)=>(u.content.length===0&&(u.content=n("APPS.INSTAGRAM.SENT_A_PHOTO")),t("div",{className:"item",onClick:()=>{G(!1),v(u),d("dm")},children:[e("div",{className:"avatar",onClick:D=>{D.stopPropagation(),a({cb:()=>{d("dmList"),a(null)}}),m.fetchAndSetProfile(u.username)},children:e("img",{src:m.getAvatar(u.avatar)})}),t("div",{className:"info",children:[t("div",{className:"username",children:[u.name,u.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),u.content.length>40?u.content.substring(0,40)+"...":u.content,"  ",ue(u.timestamp)]})]},O)))})})]})})}function Gt(){var z,ee,ae,$,j;const{Account:i,View:m,Func:S,Stories:l,Story:A,Dm:P}=r.useContext(q),d=Q(oe.Settings),[c]=i,[f,v]=m,[o,a]=l,[s,G]=A,[b,F]=P,[p,y]=r.useState(0),[h,N]=r.useState(""),[w,V]=r.useState(!1),[E,u]=r.useState({x:0,y:0}),O=r.useRef(null);r.useEffect(()=>{if(s){u(s.origin);for(let C=0;C<s.media.length;C++)if(!s.media[C].seen)return y(C)}},[]);const D=C=>{if(w)return V(!1);const k=C.target.getBoundingClientRect(),W=C.clientX-k.left*Pe();let se=s.media[p];if(se.seen||I("Instagram",{action:"viewedStory",id:se.id}),W<k.width*Pe()/2)if(p>0)y(p-1);else{let Z=o.findIndex(T=>T.username===s.username),ne=o[Z-1];ne&&S.fetchAndSetStory(ne)}else if(p<s.media.length-1)y(p+1);else{let Z=o.findIndex(T=>T.username===s.username),ne=o[Z+1];ne?(_(s.username),S.fetchAndSetStory(ne),y(0)):H()}},R=()=>{!h||h===""||I("Instagram",{action:"sendMessage",username:s.username,message:{content:h}}).then(C=>{C&&(F({username:s.username,name:s.name,verified:s.verified,avatar:s.avatar}),v("dm"),H())})},_=C=>{s.media.length===p+1&&a(k=>k.map(W=>(W.username===C&&(W.seen=1),W)))},H=C=>{C!==!1&&_(s.username),G(null)};return r.useEffect(()=>{var C;!O.current||((C=d==null?void 0:d.sound)==null?void 0:C.volume)===void 0||(O.current.volume=d.sound.volume)},[(z=d==null?void 0:d.sound)==null?void 0:z.volume]),t(Se.div,{className:"instagram-story",initial:{scale:0,transformOrigin:s!=null&&s.origin?`${((ee=s==null?void 0:s.origin)==null?void 0:ee.x)??0}px ${((ae=s==null?void 0:s.origin)==null?void 0:ae.y)??0}px`:"50% 50%"},animate:{scale:1,transformOrigin:s!=null&&s.origin?`${(($=s==null?void 0:s.origin)==null?void 0:$.x)??0}px ${((j=s==null?void 0:s.origin)==null?void 0:j.y)??0}px`:"50% 50%"},exit:{scale:0,transformOrigin:E?`${(E==null?void 0:E.x)??0}px ${(E==null?void 0:E.y)??0}px`:"50% 50%"},transition:{duration:.25,ease:"easeInOut"},children:[ce(s==null?void 0:s.media[p].image)?e("video",{ref:O,className:"background-image",onClick:D,autoPlay:!0,loop:!0,src:s==null?void 0:s.media[p].image}):e("div",{className:"background-image",onClick:D,style:{backgroundImage:`url(${s==null?void 0:s.media[p].image})`}}),e(Ne,{children:w&&e(bt,{activeImage:p,close:()=>V(!1)})}),t("div",{className:"story-wrapper",children:[t("div",{className:"story-header",children:[e("div",{className:"story-steps",children:s==null?void 0:s.media.map((C,k)=>e("div",{className:p===k?"active":"",onClick:()=>y(k)},k))}),t("div",{className:"profile-details",children:[t("div",{className:"profile",onClick:()=>{s!=null&&s.media[p].seen||I("Instagram",{action:"viewedStory",id:s==null?void 0:s.media[p].id},!0).then(()=>H()),H(),S.fetchAndSetProfile(s.username)},children:[e("div",{className:"profile-picture",style:{backgroundImage:`url(${S.getAvatar(s==null?void 0:s.avatar)})`}}),t("div",{className:"name",children:[s==null?void 0:s.username,!1]}),e("div",{className:"time",children:ue(s==null?void 0:s.media[p].timestamp)})]}),e("div",{className:"stats",children:e(fe,{onClick:()=>{if(s!=null&&s.media[p].seen)return H();I("Instagram",{action:"viewedStory",id:s==null?void 0:s.media[p].id},!0).then(()=>H())}})})]})]}),(s==null?void 0:s.username)===c.username?t("div",{className:"story-footer","data-stats":!0,children:[t("div",{className:"seen-by",onClick:()=>V(!0),children:[(s==null?void 0:s.media[p].viewers)&&e("div",{className:"images",children:s==null?void 0:s.media[p].viewers.map((C,k)=>e("img",{src:S.getAvatar(C.avatar)},k))}),n("APPS.INSTAGRAM.SEEN_BY").format({count:mt(s==null?void 0:s.media[p].views)??0})]}),e(fe,{onClick:()=>{U.PopUp.set({title:n("APPS.INSTAGRAM.DELETE_STORY.TITLE"),description:n("APPS.INSTAGRAM.DELETE_STORY.DESCRIPTION"),buttons:[{title:n("APPS.INSTAGRAM.DELETE_STORY.CANCEL")},{title:n("APPS.INSTAGRAM.DELETE_STORY.PROCEED"),color:"red",cb:()=>{I("Instagram",{action:"removeFromStory",id:s==null?void 0:s.media[p].id},!0).then(C=>{if(!C)return L("error","Failed to remove image from story");L("info","Removed image from story"),G(null),s.media.length===1&&a(k=>k.filter(W=>W.username!==s.username))})}}]})}})]}):t("div",{className:"story-footer",children:[e("div",{className:"input",children:e(re,{type:"text",placeholder:n("APPS.INSTAGRAM.SEND_A_MESSAGE"),onChange:C=>N(C.target.value),onKeyDown:C=>{C.key==="Enter"&&R()}})}),e(Ve,{onClick:()=>R()})]})]})]})}const bt=i=>{var f;const{Func:m,Story:S}=r.useContext(q),[l,A]=S,[P,d]=r.useState([]);r.useEffect(()=>{var v,o;(i==null?void 0:i.activeImage)!==void 0&&I("Instagram",{action:"getViewers",id:l==null?void 0:l.media[i.activeImage].id,page:0},(o=(v=K.stories.find(a=>a.username===l.username))==null?void 0:v.media.find(a=>a.id===l.media[i.activeImage].id))==null?void 0:o.viewers).then(a=>{if(!a)return L("warning","Failed to fetch viewers data");d(a)})},[]);const{handleScroll:c}=le({fetchData:v=>I("Instagram",{action:"getViewers",id:l==null?void 0:l.media[i.activeImage].id,page:v}),onDataFetched:v=>d(o=>[...o,...v]),perPage:15});return t(Se.div,{className:"story-modal",initial:{y:600},animate:{y:0},exit:{y:600},transition:{duration:.35,ease:"easeInOut"},children:[t("div",{className:"story-modal-header",children:[t("div",{className:"views",children:[e(at,{})," ",e("div",{className:"views",children:((f=l==null?void 0:l.media[i==null?void 0:i.activeImage])==null?void 0:f.views)??0})]}),e(fe,{className:"close",onClick:i==null?void 0:i.close})]}),t("div",{className:"story-modal-content",children:[e("div",{className:"title",children:n("APPS.INSTAGRAM.STORY_VIEWERS")}),e("div",{className:"viewers",onScroll:c,children:P.map((v,o)=>e("div",{className:"item",children:t("div",{className:"user",onClick:()=>{m.fetchAndSetProfile(v.username),A(null)},children:[e("div",{className:"profile-picture",children:e("img",{src:m.getAvatar(v.avatar)})}),t("div",{className:"user-details",children:[t("div",{className:"username",children:[v.username,v.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),e("div",{className:"name",children:v.name})]})]})},o))})]})]})};function kt(){const{Func:i,View:m,Account:S}=r.useContext(q),[l,A]=m,[P]=S;return e("div",{className:"instagram-footer",children:t(Y,{children:[[{value:"feed",activeIcon:e(st,{}),icon:e(nt,{})},{value:"search",activeIcon:e(it,{}),icon:e(rt,{})},{value:"newPost",activeIcon:e(ct,{}),icon:e(lt,{})},{value:"notifications",activeIcon:e(Ee,{}),icon:e(ye,{})}].map((c,f)=>e("div",{onClick:()=>A(c.value),children:l===c.value?c.activeIcon:c.icon},f)),e("img",{src:i.getAvatar(P.avatar),className:"profile",alt:"profile",onClick:()=>i.fetchAndSetProfile(P.username)})]})})}function _t(){const{UserPanel:i}=r.useContext(q),[m,S]=i,[l,A]=r.useState([]);let P={[n("APPS.INSTAGRAM.FOLLOWING")]:"getFollowing",[n("APPS.INSTAGRAM.FOLLOWERS")]:"getFollowers",[n("APPS.INSTAGRAM.LIKED_BY")]:"getLikes"};const d=(f,v)=>{var o,a;if(f!==n("APPS.INSTAGRAM.LIKED_BY")){let s=f===n("APPS.INSTAGRAM.FOLLOWING")?(o=K.accounts[v])==null?void 0:o.followingList:((a=K.accounts[v])==null?void 0:a.followerList)??[];return s==null?void 0:s.map(G=>K.accounts[G])}};r.useEffect(()=>{de("Instagram")&&I("Instagram",{action:P[m.data.title],data:{postId:m.data.postId,username:m.data.username,page:0}},d(m.data.title,m.data.username)).then(f=>{if(!f)return L("info","No data returned from instagram event");A(f)})},[]);const{handleScroll:c}=le({fetchData:f=>I("Instagram",{action:P[m.data.title],data:{postId:m.data.postId,username:m.data.username,page:f}}),onDataFetched:f=>A([...l,...f]),perPage:25});return e(Y,{children:m.data&&l&&t("div",{className:"userpanel-container",children:[t("div",{className:"userpanel-header",children:[e("i",{className:"far fa-chevron-left",onClick:()=>{var f;return(f=m.data)==null?void 0:f.cb()}}),e("div",{className:"userpanel-title",children:m.data.title}),e("span",{})]}),e("div",{className:"userpanel-body",onScroll:c,children:e("div",{className:"items",children:l.map((f,v)=>e(Dt,{data:f,allData:m.data},v))})})]})})}const Dt=i=>{const{Func:m,Account:S,GoBack:l,UserPanel:A}=r.useContext(q),[P]=S,[d,c]=l,[f,v]=A;let o=i.data;const[a,s]=r.useState(o.isFollowing===1);return t("div",{className:"item",onClick:()=>{c({cb:()=>{v({display:!0,data:i.allData})}}),m.fetchAndSetProfile(o.username)},children:[t("div",{className:"user",children:[e("div",{className:"profile-picture",children:e("img",{src:m.getAvatar(o.avatar),alt:"profile"})}),t("div",{className:"user-details",children:[t("div",{className:"username",children:[o.username,o.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),e("div",{className:"name",children:o.name})]})]}),P.username!==o.username&&e("div",{className:"action",onClick:G=>{G.stopPropagation(),o.username!==P.username&&(a?U.PopUp.set({title:n("APPS.INSTAGRAM.UNFOLLOW_POPUP.TITLE"),description:n("APPS.INSTAGRAM.UNFOLLOW_POPUP.DESCRIPTION").format({name:o.username}),buttons:[{title:n("APPS.INSTAGRAM.UNFOLLOW_POPUP.CANCEL")},{title:n("APPS.INSTAGRAM.UNFOLLOW_POPUP.PROCEED"),color:"red",cb:()=>{I("Instagram",{action:"toggleFollow",data:{username:o.username,following:!a}},!0).then(()=>{s(b=>!b)})}}]}):I("Instagram",{action:"toggleFollow",data:{username:o.username,following:!a}},!0).then(()=>{s(b=>!b)}))},children:a?e("div",{className:"button following",children:n("APPS.INSTAGRAM.FOLLOWING")}):e("div",{className:"button follow",children:n("APPS.INSTAGRAM.FOLLOW")})})]})},q=r.createContext(null);function Ht(){var j;const i=Q(oe.Settings),m=(j=Q(Ce))==null?void 0:j.active,S=Q(oe.Styles.TextColor),[l,A]=r.useState("feed"),[P,d]=r.useState(null),[c,f]=r.useState(!1),[v,o]=r.useState([]),[a,s]=r.useState(null),[G,b]=r.useState(null),[F,p]=r.useState(null),[y,h]=r.useState(null),[N,w]=r.useState(null),[V,E]=r.useState(null),[u,O]=r.useState({display:!1,data:null}),[D,R]=r.useState(!0);r.useEffect(()=>{var C,k;m&&((C=m==null?void 0:m.data)==null?void 0:C.view)==="profile"&&H((k=m==null?void 0:m.data)==null?void 0:k.username)},[m]),r.useEffect(()=>{I("isAdmin",null,!1).then(C=>{if(te.APPS.INSTAGRAM.account.value){d({...te.APPS.INSTAGRAM.account.value,isAdmin:C}),f(!0),R(!1);return}else if(te.APPS.INSTAGRAM.account.value===!1)return R(!1);I("Instagram",{action:"isLoggedIn"},K.account).then(k=>{k?(te.APPS.INSTAGRAM.account.set(k),d({...k,isAdmin:C}),f(!0),R(!1)):(R(!1),te.APPS.INSTAGRAM.account.set(null))})})},[]),r.useEffect(()=>{if(de("Instagram"))return setTimeout(()=>{l==="live"||l==="story"?(oe.Styles.TextColor.set("#fafafaed"),l=="live"&&U.IndicatorVisible.set(!1)):(oe.Styles.TextColor.set(i.display.theme==="dark"?"#fafafaed":"#000000"),U.IndicatorVisible.set(!0)),l==="dm"?he.ReceiveAppNotifications.set(!1):he.ReceiveAppNotifications.set(!0)},250),()=>{he.ReceiveAppNotifications.set(!0)}},[l]);const _=(C,k)=>{C&&I("Instagram",{action:"getPost",id:C},K.posts.find(W=>W.id===C)).then(W=>{if(W){if(k)return z(W);w(W),A("post")}})},H=C=>{var k;C&&I("Instagram",{action:"getProfile",username:C},(k=K.accounts)==null?void 0:k[C]).then(W=>{if(!W)return L("warning","Failed to fetch profile data");b(W),A("profile")})},z=C=>{C.id&&I("Instagram",{action:"getComments",postId:C.id,page:0},K.comments.filter(k=>k.postId===C.id)).then(k=>{k&&(h({post:C,comments:k}),A("comments"))})},ee=(C,k,W)=>{var se;!C&&!(C!=null&&C.username)||((k==null?void 0:k.length)==0&&(k=void 0),I("Instagram",{action:"getStory",username:C.username},(se=K.stories.find(Z=>Z.username===C.username))==null?void 0:se.media).then(Z=>{if(!Z)return L("warning","Failed to fetch story data");s({username:C.username,avatar:C.avatar,verified:C.verified,media:Z,queue:k,origin:W})}))},ae=C=>C||`./assets/img/avatar-placeholder-${i.display.theme}.svg`,$={feed:e(At,{}),search:e(Et,{}),notifications:e(Nt,{}),profile:e(It,{}),live:e(ut,{}),logIn:e(ke,{}),comments:e(Ct,{}),post:e(Lt,{}),newPost:e(Rt,{}),userpanel:e(_t,{}),dmList:e(Mt,{}),dm:e(Ot,{})};return r.useEffect(()=>{u.display&&A("userpanel")},[u]),J("instagram:logout",C=>{if(!C)return L("warning","No username provided to logout");if(!c)return L("info","User is not logged in, cannot log out");if(C!==(P==null?void 0:P.username))return L("warning","Username provided does not match current logged in username, not logging out");d(null),f(!1),A("logIn")}),e("div",{className:"instagram-container",children:e(q.Provider,{value:{View:[l,A],Account:[P,d],Profile:[G,b],Post:[N,w],Comments:[y,h],LoggedIn:[c,f],GoBack:[V,E],UserPanel:[u,O],Dm:[F,p],Stories:[v,o],Story:[a,s],Func:{fetchAndSetProfile:H,fetchAndSetStory:ee,fetchAndSetComments:z,fetchAndSetPost:_,getAvatar:ae}},children:D||i.airplaneMode?e("div",{className:"loading",children:e(ot,{size:40,lineWeight:5,speed:2,color:S})}):e("div",{className:"instagram-wrapper",children:c?t(Y,{children:[e(Ne,{children:a&&e(Gt,{})}),$[l],l!=="live"&&l!=="logIn"&&l!=="newPost"&&l!=="comments"&&!a&&e(kt,{})]}):e(ke,{})})})})}export{q as InstagramContext,Ht as default};
