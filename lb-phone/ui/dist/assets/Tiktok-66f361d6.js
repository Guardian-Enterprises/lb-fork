import{a as e,ai as be,r as l,E as se,p as E,q as f,j as o,w as Ue,L as s,b3 as qe,a9 as le,C as W,cC as De,_ as de,m as oe,cD as Fe,N as Pe,I as ve,aw as je,ch as ye,ac as Ne,ad as pe,a3 as we,J as Se,cw as Re,cE as Ve,bc as Ie,Q as Oe,a7 as Ke,F as J,d as ue,a4 as Je,$ as Xe,cu as Me,u as fe,A as ge,aV as xe,cF as Qe,cG as Ge,b1 as et,P as ce,T as Be,S as We,b as he,s as ne,cH as tt,cI as nt,cJ as it,cp as st,aA as Ee,am as ot,an as at,bf as He,c4 as lt,aC as rt,a6 as ct,bZ as dt,ck as ut,c3 as mt,cl as ft,cz as Le,cK as ht,c0 as vt,cL as Tt,cM as Pt,cy as gt,bl as pt}from"./index-646d6ab8.js";import{T as $e}from"./Textarea-a0d39959.js";import{S as St}from"./Switch-65eebfb4.js";import{S as Ct}from"./Slider-a7b623ee.js";function me(){return e("div",{className:"checkmark",children:e(be,{})})}const $={Account:{name:"LB",username:"lb",follower_count:2,following_count:2,like_count:543,avatar:"https://docs.lbscripts.com/images/icons/icon.png",bio:`Official LB account
https://lbphone.com`,twitter:"lb",instagram:"lb",verified:!0,following:["breze","loaf"],followers:["breze","loaf"]},Accounts:[{name:"LB",username:"lb",follower_count:2,following_count:2,like_count:543,video_count:2,avatar:"https://docs.lbscripts.com/images/icons/icon.png",bio:`Official LB account
https://lbphone.com`,twitter:"lb",instagram:"lb",verified:!0,following:["breze","loaf"],followers:["breze","loaf"]},{name:"Breze",username:"breze",follower_count:1,following_count:1,like_count:0,video_count:0,bio:"I'm a developer",twitter:"breze",instagram:"breze",isFollowing:!0,following:["lb"],followers:["lb"]},{name:"Loaf Scripts",username:"loaf",follower_count:1,following_count:1,like_count:0,video_count:0,bio:"I'm a developer",twitter:"loaf",instagram:"loaf",isFollowing:!0,following:["lb"],followers:["lb"]}],Videos:[{id:"1",caption:"Trippy vibes",src:"https://r2.fivemanage.com/video/NfFKTX2V0iJ1.mp4",views:532,likes:16,comments:1,saves:1,commentsData:[{id:"1",username:"lb",name:"LB",verified:!0,avatar:"https://docs.lbscripts.com/images/icons/icon.png",comment:"First comment!",creator_liked:1,likes:1,liked:1,timestamp:Date.now()-1e3*60*60*2}],timestamp:Date.now()-1e3*60*60*8,username:"lb",name:"LB",avatar:"https://docs.lbscripts.com/images/icons/icon.png",verified:!0,following:!0},{id:"2",caption:"Car spotting in Los Santos",src:"https://r2.fivemanage.com/video/0NNIBeGAfx5J.mp4",views:1445,likes:123,comments:0,saves:3,commentsData:[],timestamp:Date.now()-1e3*60*60*24,username:"lb",name:"LB",avatar:"https://docs.lbscripts.com/images/icons/icon.png",verified:!0,following:!0}],Messages:[{id:"1",username:"breze",name:"Breze",verified:!0,last_message:"hey",unread_messages:1,following_count:12,follower_count:123,messages:[{id:"1",sender:"breze",content:"hey",timestamp:Date.now()-1e3*60*60*4}],timestamp:Date.now()-1e3*60*60*4},{id:"2",username:"loaf",name:"Loaf Scripts",verified:!1,last_message:"yoo, that vid was fire",unread_messages:0,following_count:4,follower_count:3,messages:[{id:"3",sender:"loaf",content:"yoo, that vid was fire",timestamp:Date.now()-1e3*60*60*8},{id:"1",sender:"lb",video:"https://r2.fivemanage.com/video/NfFKTX2V0iJ1.mp4",videoId:"1",timestamp:Date.now()-1e3*60*60*13}],timestamp:Date.now()-1e3*60*60*8}],Notifications:[{type:"like",username:"loaf",name:"Loaf Scripts",videoId:"1",videoSrc:"https://r2.fivemanage.com/video/NfFKTX2V0iJ1.mp4",timestamp:Date.now()-1e3*60*60*2},{type:"follow",username:"loaf",name:"Loaf Scripts",isFollowing:!0,followsYou:!0,timestamp:Date.now()-1e3*60*60*24*3}]};function Ze(){return e("svg",{viewBox:"0 0 16 14",xmlns:"http://www.w3.org/2000/svg",children:e("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M11.0203 0.108741C13.5601 -0.122158 15.75 1.87768 15.75 4.42804V4.49056C15.75 5.65597 15.2871 6.77366 14.463 7.59773L8.81009 13.2506C8.36271 13.698 7.63736 13.698 7.18998 13.2506L1.53704 7.59773C0.712962 6.77366 0.25 5.65597 0.25 4.49055V4.42806C0.25 1.87769 2.4399 -0.122157 4.97979 0.108742C6.17121 0.217053 7.26352 0.812457 8.00003 1.75171C8.73653 0.812457 9.82884 0.217052 11.0203 0.108741ZM14.25 4.42804C14.25 2.75973 12.8175 1.45154 11.1561 1.60258C10.3564 1.67528 9.625 2.08341 9.14323 2.72577L8.67378 3.3517C8.33691 3.80087 7.66317 3.80087 7.32629 3.35171L6.85681 2.72576C6.37504 2.08341 5.64364 1.67528 4.84399 1.60258C3.18252 1.45154 1.75 2.75974 1.75 4.42806V4.49055C1.75 5.25815 2.05493 5.9943 2.5977 6.53707L8.00003 11.9394L13.4023 6.53707C13.9451 5.9943 14.25 5.25815 14.25 4.49056V4.42804Z",fill:"currentColor"})})}function Nt(){const{User:t}=l.useContext(B),[u]=t,[h,p]=l.useState(""),[N,g]=l.useState(""),[m,r]=l.useState([]),[a,S]=l.useState([]),[n,i]=l.useState(0),[P,L]=l.useState(!1),[y,_]=l.useState(0),[d,v]=l.useState(!1),[I,b]=l.useState(!1);l.useEffect(()=>{se("TikTok")&&E("TikTok",{action:"getVideos",data:{full:!0,type:"recent"},page:0},$.Videos).then(O=>{if(!O)return f("warning","Failed to get videos");S(O)})},[]),l.useEffect(()=>{h.length>0&&E("TikTok",{action:"searchAccounts",query:h},$.Accounts.filter(O=>O.username.includes(h))).then(O=>{if(!O)return f("info","No response, most likely no accounts to search for?");r(O)}),_(0),b(!1)},[h]),l.useEffect(()=>{const O=setTimeout(()=>p(N),500);return()=>clearTimeout(O)},[N]);const U=()=>{let O=h.length===0;if(O&&P)return f("info","Fetched everything, no need to fetch more (VIDEOS)");if(!O&&I)return f("info","Fetched everything, no need to fetch more (SEARCH)");if(d)return f("info","Already fetching");let F=document.querySelector("#last");if(!F)return f("warning","No last element");!qe(F)&&(v(!0),E("TikTok",{action:O?"getVideos":"searchAccounts",query:h,data:{full:!0,type:"recent"},page:(O?n:y)+1},null).then(w=>{w&&w.length>0?(O?S(K=>[...K,...w]):r(K=>[...K,...w]),v(!1)):(v(!1),O?L(!0):b(!0))}),O?i(w=>w+1):_(w=>w+1))};return o("div",{className:"discover-container",children:[e("div",{className:"discover-header",children:e(Ue,{placeholder:s("APPS.TIKTOK.SEARCH_PLACEHOLDER"),onChange:O=>g(O.target.value)})}),h.length>0?e("div",{className:"search-results",onScroll:U,children:m==null?void 0:m.filter(O=>O.username!==u.username).map((O,F)=>e(It,{data:O,last:m.length-1===F},F))}):e("div",{className:"discover-content",onScroll:U,children:a.map((O,F)=>e(Ot,{data:O,last:a.length-1===F},F))})]})}const It=({data:t,last:u})=>{const{User:h,Func:p,GoBack:N}=l.useContext(B),[g,m]=N,[r,a]=l.useState(t.isFollowing),S=n=>{E("TikTok",{action:"toggleFollow",data:{username:t.username,follow:n}},!0).then(i=>{if(!i||!(i!=null&&i.success))return f("warning","Failed to toggle follow");if(i.error)return f("error",i.error);a(n)})};return o("div",{className:"item",id:u?"last":"",onClick:()=>{m({view:"discover"}),p.fetchAndSetProfile(t.username)},children:[o("div",{className:"item-user",children:[e("div",{className:"avatar",children:e("img",{src:Z(t.avatar)})}),o("div",{className:"user",children:[o("div",{className:"name",children:[t.username,t.verified&&e(me,{})]}),e("div",{className:"username",children:t.name}),o("div",{className:"stats",children:[z(t.followers)," ",s("APPS.TIKTOK.FOLLOWERS").toLowerCase()," ",z(t.videos)??"0"," ",s("APPS.TIKTOK.VIDEOS").toLowerCase()]})]})]}),e("div",{className:"action",children:e("div",{className:le("button",r?"following":"follow"),onClick:n=>{n.stopPropagation(),r?W.PopUp.set({title:s("APPS.TIKTOK.UNFOLLOW_POPUP.TITLE"),description:s("APPS.TIKTOK.UNFOLLOW_POPUP.DESCRIPTION").format({name:t.name}),buttons:[{title:s("APPS.TIKTOK.UNFOLLOW_POPUP.CANCEL")},{title:s("APPS.TIKTOK.UNFOLLOW_POPUP.PROCEED"),color:"red",cb:()=>S(!1)}]}):S(!0)},children:r?s("APPS.TIKTOK.UNFOLLOW"):s("APPS.TIKTOK.FOLLOW")})})]})},Ot=({data:t,last:u})=>{const{Func:h,GoBack:p}=l.useContext(B),[N,g]=p;return o("div",{className:"item",id:u?"last":"",onClick:()=>{h.fetchAndSetVideo(t.id,{type:"recent"}),g({view:"discover"})},children:[o("div",{className:"video-item",children:[e("video",{src:t.src,loop:!0,onMouseEnter:m=>m.currentTarget.play().catch(()=>{}),onMouseLeave:m=>m.currentTarget.pause(),muted:!0}),e("div",{className:"timestamp",children:Ce(t.timestamp)})]}),o("div",{className:"video-items",children:[e("div",{className:"caption",children:t.caption}),o("div",{className:"video-info",children:[o("div",{className:"user",onClick:m=>{m.stopPropagation(),g({view:"discover"}),h.fetchAndSetProfile(t.username)},children:[e("img",{src:Z(t.avatar)}),e("div",{className:"name",children:t.username})]}),o("div",{className:"stats",children:[o("div",{children:[e(De,{className:"plays"}),z(t.views)]}),o("div",{children:[e(Ze,{}),z(t.likes)]})]})]})]})]})};function wt(){const{User:t,View:u,Dm:h}=l.useContext(B),[p,N]=u,[g,m]=h,[r,a]=l.useState(!1),[S,n]=l.useState([]);return l.useEffect(()=>{se("TikTok")&&E("TikTok",{action:"getRecentMessages"},{success:!0,channels:$.Messages}).then(i=>{if(!(i!=null&&i.success))return f("warning",i.error);n(i.channels)})},[]),de("tiktok:receivedMessage",i=>{n(P=>{let L=P.findIndex(_=>_.channelId===i.channelId);if(L===-1)return P;let y=[...P];return y[L].lastMessage=i.content,y[L].lastMessageTimestamp=Date.now(),y})}),o(oe.div,{...Fe,className:"messages-container",children:[e(Pe,{children:r&&e(At,{close:()=>a(!1)})}),o("div",{className:"dmmessages-header",children:[e(ve,{onClick:()=>N("inbox")}),e("div",{className:"title",children:s("APPS.TIKTOK.DIRECT_MESSAGES")}),e(je,{onClick:()=>a(!0)})]}),o("div",{className:"messages-body",children:[S.length===0&&o("div",{className:"no-messages",children:[e(ye,{}),e("div",{className:"title",children:s("APPS.TIKTOK.NO_MESSAGES_TITLE")}),e("div",{className:"content",children:s("APPS.TIKTOK.NO_MESSAGES_SUBTITLE")})]}),S.map((i,P)=>o("div",{className:"message","data-unread":i.unread_messages>0,onClick:()=>{m({id:i.id,name:i.name,username:i.username,avatar:i.avatar,verified:i.verified,follower_count:i.follower_count,following_count:i.following_count,video_count:i.video_count}),i.unread_messages>0&&E("TikTok",{action:"clearUnreadMessages",id:i.id}),N("dm")},children:[o("div",{className:"user",children:[e("img",{src:Z(i.avatar)}),o("div",{className:"message-content",children:[e("div",{className:"username",children:i.name}),e("div",{className:"content",children:i.last_message})]})]}),e("div",{className:"timestamp",children:Ne(i.timestamp)})]},P))]})]})}const At=({close:t})=>{const{User:u}=l.useContext(B),[h]=u,[p,N]=l.useState(""),[g,m]=l.useState(""),[r,a]=l.useState([]);l.useEffect(()=>{const n=setTimeout(()=>N(g),500);return()=>clearTimeout(n)},[g]),l.useEffect(()=>{p.length>0&&E("TikTok",{action:"searchAccounts",query:p},{success:!0,accounts:$.Accounts}).then(n=>{if(!n)return f("info","No response, most likely no accounts to search for?");a(n)})},[p]);const S=n=>{};return o(oe.div,{...pe,className:"search-container",children:[o("div",{className:"search-header",children:[e(we,{onClick:t}),e(Ue,{placeholder:s("APPS.TIKTOK.SEARCH_PLACEHOLDER"),onChange:n=>m(n.target.value)}),e("span",{})]}),e("div",{className:"search-results",onScroll:S,children:r==null?void 0:r.filter(n=>n.username!==h.username).map((n,i)=>e(kt,{data:n,last:r.length-1===i},i))})]})},kt=({data:t,last:u})=>{const{View:h,Dm:p}=l.useContext(B),[N,g]=h,[m,r]=p;return e("div",{className:"item",id:u?"last":"",onClick:()=>{r({name:t.name,username:t.username,avatar:t.avatar,verified:t.verified,follower_count:t.follower_count,following_count:t.following_count,video_count:t.video_count}),g("dm")},children:o("div",{className:"item-user",children:[e("div",{className:"avatar",children:e("img",{src:Z(t.avatar)})}),o("div",{className:"user",children:[o("div",{className:"name",children:[t.username,t.verified&&e(me,{})]}),e("div",{className:"username",children:t.name}),o("div",{className:"stats",children:[z(t.follower_count)," ",s("APPS.TIKTOK.FOLLOWERS").toLowerCase()," ",z(t.video_count)??"0"," ",s("APPS.TIKTOK.VIDEOS").toLowerCase()]})]})]})})};function ze({className:t}){return o("svg",{className:t,width:"43",height:"43",viewBox:"0 0 43 43",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[o("g",{filter:"url(#filter0_d_4_1160)",children:[e("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M21.8242 33.4976C21.7164 33.4992 21.6083 33.5 21.5 33.5C11.835 33.5 4 27.0081 4 19C4 10.9919 11.835 4.5 21.5 4.5C31.165 4.5 39 10.9919 39 19C39 21.0253 38.4989 22.9536 37.5938 24.7044C36.3794 27.1797 34.5051 29.3888 32.472 31.2945C29.3743 34.1981 25.7901 36.39 23.2378 37.6253C22.5627 37.9521 21.8242 37.4404 21.8242 36.7278V33.4976ZM15.5 19.75C15.5 21.1307 14.3807 22.25 13 22.25C11.6193 22.25 10.5 21.1307 10.5 19.75C10.5 18.3693 11.6193 17.25 13 17.25C14.3807 17.25 15.5 18.3693 15.5 19.75ZM21.5 22.25C22.8807 22.25 24 21.1307 24 19.75C24 18.3693 22.8807 17.25 21.5 17.25C20.1193 17.25 19 18.3693 19 19.75C19 21.1307 20.1193 22.25 21.5 22.25ZM32.5 19.75C32.5 21.1307 31.3807 22.25 30 22.25C28.6193 22.25 27.5 21.1307 27.5 19.75C27.5 18.3693 28.6193 17.25 30 17.25C31.3807 17.25 32.5 18.3693 32.5 19.75Z",fill:"currentColor"}),e("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M21.5 33.5C31.165 33.5 39 27.0081 39 19C39 10.9919 31.165 4.5 21.5 4.5C11.835 4.5 4 10.9919 4 19C4 27.0081 11.835 33.5 21.5 33.5ZM13 22.25C14.3807 22.25 15.5 21.1307 15.5 19.75C15.5 18.3693 14.3807 17.25 13 17.25C11.6193 17.25 10.5 18.3693 10.5 19.75C10.5 21.1307 11.6193 22.25 13 22.25ZM24 19.75C24 21.1307 22.8807 22.25 21.5 22.25C20.1193 22.25 19 21.1307 19 19.75C19 18.3693 20.1193 17.25 21.5 17.25C22.8807 17.25 24 18.3693 24 19.75ZM30 22.25C31.3807 22.25 32.5 21.1307 32.5 19.75C32.5 18.3693 31.3807 17.25 30 17.25C28.6193 17.25 27.5 18.3693 27.5 19.75C27.5 21.1307 28.6193 22.25 30 22.25Z",fill:"currentColor"})]}),e("defs",{children:o("filter",{id:"filter0_d_4_1160",x:"0",y:"0.83",width:"43",height:"41.2262",filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB",children:[e("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),e("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),e("feOffset",{dy:"0.33"}),e("feGaussianBlur",{stdDeviation:"2"}),e("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.1 0"}),e("feBlend",{mode:"normal",in2:"BackgroundImageFix",result:"effect1_dropShadow_4_1160"}),e("feBlend",{mode:"normal",in:"SourceGraphic",in2:"effect1_dropShadow_4_1160",result:"shape"})]})})]})}function Ae({className:t}){return o("svg",{className:t,viewBox:"0 0 44 41",xmlns:"http://www.w3.org/2000/svg",children:[o("g",{filter:"url(#filter0_d_4_1165)",children:[e("path",{d:"M20.0611 35.818C21.0718 36.5395 22.4282 36.5395 23.4389 35.818C28.4905 32.2118 33.3281 28.063 36.6744 22.7538C38.3509 20.0939 39.0537 17.9429 39.3301 16.184C39.4416 15.5647 39.5 14.9257 39.5 14.2725C39.5 8.59918 35.097 4 29.6655 4C26.4197 4 23.5411 5.64254 21.75 8.17528C19.9589 5.64254 17.0803 4 13.8345 4C8.40304 4 4 8.59918 4 14.2725C4 14.9257 4.05836 15.5647 4.16994 16.184C4.44634 17.9429 5.14906 20.0939 6.82555 22.7538C10.1719 28.063 15.0095 32.2118 20.0611 35.818Z",fill:"currentColor"}),e("path",{d:"M20.0611 31.5C21.0718 32.2216 22.4282 32.2216 23.4389 31.5C29 28.5 31 27.5 36.6744 22.7538C38.3509 20.0939 39.0537 17.9429 39.3301 16.184C39.4416 15.5647 39.5 14.9257 39.5 14.2725C39.5 8.59918 35.097 4 29.6655 4C26.4197 4 23.5411 5.64254 21.75 8.17528C19.9589 5.64254 17.0803 4 13.8345 4C8.40304 4 4 8.59918 4 14.2725C4 14.9257 4.05836 15.5647 4.16994 16.184C4.44634 17.9429 5.14906 20.0939 6.82555 22.7538C13 27.5 15 28.5 20.0611 31.5Z",fill:"currentColor"})]}),e("defs",{children:o("filter",{id:"filter0_d_4_1165",x:"0",y:"0.33",width:"43.5",height:"40.3591",filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB",children:[e("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),e("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),e("feOffset",{dy:"0.33"}),e("feGaussianBlur",{stdDeviation:"2"}),e("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.1 0"}),e("feBlend",{mode:"normal",in2:"BackgroundImageFix",result:"effect1_dropShadow_4_1165"}),e("feBlend",{mode:"normal",in:"SourceGraphic",in2:"effect1_dropShadow_4_1165",result:"shape"})]})})]})}function Kt(){const{View:t}=l.useContext(B),[u,h]=t,[p,N]=l.useState([]),[g,m]=l.useState(0);l.useEffect(()=>{se("TikTok")&&(E("TikTok",{action:"getUnreadMessages"},{success:!0,unread:1}).then(a=>{if(!a.success)return f("warning","Failed to get unread messages: "+a.error);m(a==null?void 0:a.unread)}),E("TikTok",{action:"getNotifications",page:0},{success:!0,data:$.Notifications}).then(a=>{if(!a.success)return f("warning","Failed to get notifications: "+a.error);N(a.data)}))},[]);const{handleScroll:r}=Se({fetchData:a=>E("TikTok",{action:"getNotifications",page:a}),onDataFetched:a=>()=>{if(!(a!=null&&a.success))return f("warning","Failed to get notifications: "+a.error);if(!(a!=null&&a.data))return f("warning","Failed to get notifications: (NO DATA)"+(a==null?void 0:a.error));N([...p,...a.data])},perPage:25});return o("div",{className:"inbox-container",children:[o("div",{className:"inbox-header",children:[e("span",{}),e("div",{className:"title",children:s("APPS.TIKTOK.ALL_ACTIVITY")}),o("div",{className:"messages",onClick:()=>h("messages"),children:[e(Re,{}),g>0&&e("div",{className:"notifications",children:g})]})]}),o("div",{className:"inbox-body",onScroll:r,children:[p.length===0&&o("div",{className:"no-notifications",children:[e(Ve,{}),e("div",{className:"title",children:s("APPS.TIKTOK.NO_NOTIFICATIONS")}),e("div",{className:"content",children:s("APPS.TIKTOK.NO_NOTIFICATIONS_SUBTITLE")})]}),p.map((a,S)=>e(Et,{data:a},S))]})]})}const Et=({data:t})=>{const{Func:u,GoBack:h}=l.useContext(B),[p,N]=h,[g,m]=l.useState(t.isFollowing),r=n=>{E("TikTok",{action:"toggleFollow",data:{username:t.username,follow:n}},{success:!0}).then(i=>{if(!i||!(i!=null&&i.success))return f("warning","Failed to toggle follow");if(i.error)return f("error",i.error);m(n)})};let a;switch(t.type){case"follow":a=s("APPS.TIKTOK.STARTED_FOLLOWING");break;case"like":a=s("APPS.TIKTOK.LIKED_VIDEO");break;case"like_comment":a=s("APPS.TIKTOK.LIKED_COMMENT");break;case"save":a=s("APPS.TIKTOK.SAVED_VIDEO");break;case"comment":a=s("APPS.TIKTOK.COMMENTED").format({comment:t.commentText});break;case"reply":a=s("APPS.TIKTOK.REPLIED").format({comment:t.commentText});break}const S=()=>{N({view:"inbox"}),u.fetchAndSetProfile(t.username)};return o("div",{className:le("notification",t.type),children:[o("div",{className:"user",children:[o("div",{className:"avatar",onClick:S,children:[e("img",{src:Z(t.avatar)}),(t.type==="like"||t.type==="comment"||t.type==="reply")&&e("div",{className:"type","data-color":t.type==="like"?"red":"blue",children:t.type==="like"?e(Ae,{}):e(ze,{})})]}),o("div",{className:"info",children:[o("div",{className:"username",onClick:S,children:[t.name,t.verified&&e(me,{})]}),o("div",{className:"notification-content",children:[a,e("div",{className:"timestamp",children:Ce(t.timestamp)})]}),(t.type==="reply"||t.type==="like_comment")&&o("div",{className:"original-text",children:[e("div",{className:"border"}),t.type==="like_comment"?t.commentText:t.originalText]})]})]}),t.type==="follow"?e("div",{className:le("button",g?"following":"follow"),onClick:n=>{n.stopPropagation(),g?W.PopUp.set({title:s("APPS.TIKTOK.UNFOLLOW_POPUP.TITLE"),description:s("APPS.TIKTOK.UNFOLLOW_POPUP.DESCRIPTION").format({name:t.name}),buttons:[{title:s("APPS.TIKTOK.UNFOLLOW_POPUP.CANCEL")},{title:s("APPS.TIKTOK.UNFOLLOW_POPUP.PROCEED"),color:"red",cb:()=>r(!1)}]}):r(!0)},children:g?s("APPS.TIKTOK.UNFOLLOW"):s("APPS.TIKTOK.FOLLOW")}):e("div",{className:"video-preview",onClick:()=>{t.videoId&&(N({view:"inbox"}),u.fetchAndSetVideo(t.videoId,{single:!0}))},children:e("video",{src:t.videoSrc,controls:!1,autoPlay:!1,muted:!0})})]})};function Lt(){const{User:t,GoBack:u,View:h,Func:p,Dm:N,Profile:g}=l.useContext(B),[m,r]=t,[a,S]=h,[n]=N,[i,P]=u,[L,y]=g,[_,d]=l.useState([]),[v,I]=l.useState(n==null?void 0:n.id),b=l.useRef(null),[U,O]=l.useState("");l.useState(0),l.useState(!1),l.useState(!1),l.useEffect(()=>(Ie.ReceiveAppNotifications.set(!1),()=>{Ie.ReceiveAppNotifications.set(!0)}),[]),l.useEffect(()=>{var c;v&&E("TikTok",{action:"getMessages",page:0,id:v},{success:!0,messages:(c=$.Messages.find(T=>T.id===v))==null?void 0:c.messages}).then(T=>{if(!(T!=null&&T.success))return f("warning","An error occured while fetching messages. "+(T==null?void 0:T.error));if(!(T!=null&&T.messages))return f("warning","An error occured while fetching messages. (No messages)");d(T.messages.reverse())})},[v]),de("tiktok:receivedMessage",c=>{n.username===c.sender&&d([..._,{...c,timestamp:new Date().getTime()}])});const F=()=>{var c;if(U.trim().length===0)return f("warning","You can't send an empty message");E("TikTok",{action:"sendMessage",data:{id:v,username:n.username,content:U}},{success:!0,id:"3",channelId:(c=$.Messages.find(T=>T.id===v))==null?void 0:c.id}).then(T=>{if(!(T!=null&&T.success))return f("warning","An error occured while sending message. "+(T==null?void 0:T.error));f("info",`Message sent to ${n.username}, id: ${T.id}, channelId: ${T==null?void 0:T.channelId}`),T!=null&&T.channelId&&!v&&I(T.channelId),b.current.value="",d([..._,{id:T.id,sender:m.username,recipient:n.username,content:U,timestamp:new Date().getTime()}]),O("");let R=document.querySelector(".dm-body");R.scrollTop=R.scrollHeight})},{handleScroll:k}=Se({fetchData:c=>E("TikTok",{action:"getMessages",username:n.username,page:c}),onDataFetched:c=>d([...c.reverse(),..._]),isReversed:!0,perPage:25}),w=c=>{if(c)return/<!SHARED-VIDEO-URL="(.*)"ID="(.*)"!>/.test(c)},K=c=>{p.fetchAndSetVideo(c,{single:!0}),P({view:"dm"})};return o(oe.div,{...Fe,className:"dm-container",children:[o("div",{className:"dm-header",children:[e(ve,{onClick:()=>{i!=null&&i.view?(i.data&&i.data.identifier==="profile"&&y(i.data.data),S(i.view),P(null)):S("messages")},className:"chevron"}),o("div",{className:"profile",onClick:c=>{c.stopPropagation(),P({view:"dm",data:{identifier:"dm",data:n}}),p.fetchAndSetProfile(n.username)},children:[e("div",{className:"avatar",children:e("img",{src:Z(n.avatar)})}),o("div",{className:"username",children:[n.name??n.username,n.verified&&e(me,{})]})]})]}),e("div",{className:"dm-body-container",onScroll:k,children:o("div",{className:"dm-body",children:[o("div",{className:"messages-hero","data-nomessages":_.length===0,children:[e("img",{className:"avatar",src:Z(n.avatar)}),e("div",{className:"name",children:n.name}),o("div",{className:"secondary",children:[o("div",{className:"username",children:["@",n.username]}),o("div",{className:"stats",children:[o("div",{className:"following",children:[z(n.following_count)," ",s("APPS.TIKTOK.FOLLOWING").toLowerCase()]}),o("div",{className:"followers",children:[z(n.follower_count)," ",s("APPS.TIKTOK.FOLLOWERS").toLowerCase()]})]})]})]}),_.map((c,T)=>{var X;let R,x=c.sender===m.username?"self":"other",G=((X=_[T+1])==null?void 0:X.sender)===m.username?"self":"other";return _[T+1]?R=Math.abs(c.timestamp-_[T+1].timestamp)/36e5:G=void 0,c.content&&w(c.content)&&(c.video=c.content.match(/<!SHARED-VIDEO-URL="(.*)"ID="(.*)"!>/)[1],c.videoId=c.content.match(/<!SHARED-VIDEO-URL="(.*)"ID="(.*)"!>/)[2]),o("div",{className:le("message",x),children:[x=="other"?o("div",{className:"message-with-pfp",children:[e("div",{className:`profile-picture ${x!==G?"show":"hide"}`,onClick:ae=>{ae.stopPropagation(),P({view:"dm",data:{identifier:"dm",data:n}}),p.fetchAndSetProfile(n.username)},children:e("img",{src:Z(n.avatar)})}),e("div",{className:"message-content",children:c.video?o("div",{className:"shared-video",onClick:()=>K(c.videoId),children:[e("video",{src:c.video,autoPlay:!1,controls:!1}),e(Oe,{})]}):e("div",{className:"content",children:Ke(c.content)})})]}):e(J,{children:c.video?o("div",{className:"shared-video",onClick:()=>K(c.videoId),children:[e("video",{src:c.video,autoPlay:!1,controls:!1}),e(Oe,{})]}):e("div",{className:"content",children:Ke(c.content)})}),_[T+1]&&R>6?e("div",{className:"date",children:Ne(c.timestamp)}):x!==G&&e("div",{className:"date",children:Ne(c.timestamp)})]},T)})]})}),e("div",{className:"dm-footer",children:o("div",{className:"input",children:[e(ue,{type:"text",placeholder:s("APPS.DARKCHAT.INPUT_PLACEHOLDER"),ref:b,onChange:c=>O(c.target.value),onKeyDown:c=>{c.key==="Enter"&&F()}}),e("div",{className:"buttons",children:U.trim().length>0&&e("div",{className:"send",onClick:F,children:e(Je,{})})})]})})]})}function _t(){return o("svg",{viewBox:"0 0 23 23",xmlns:"http://www.w3.org/2000/svg",children:[e("path",{d:"M7.56201 11C8.39038 11 9.06201 10.1045 9.06201 9C9.06201 7.89551 8.39038 7 7.56201 7C6.73364 7 6.06201 7.89551 6.06201 9C6.06201 10.1045 6.73364 11 7.56201 11Z",fill:"currentColor"}),e("path",{d:"M16.062 9C16.062 10.1045 15.3904 11 14.562 11C13.7336 11 13.062 10.1045 13.062 9C13.062 7.89551 13.7336 7 14.562 7C15.3904 7 16.062 7.89551 16.062 9Z",fill:"currentColor"}),e("path",{d:"M11.062 15.7891C12.562 15.7891 14.062 14.7373 14.062 13.6328C14.062 12.5283 12.062 12.5 11.062 12.5C10.062 12.5 8.06201 12.5283 8.06201 13.6328C8.06201 14.7373 9.56201 15.7891 11.062 15.7891Z",fill:"currentColor"}),e("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M22.062 11.5C22.062 17.5752 17.1372 22.5 11.062 22.5C4.98682 22.5 0.0620117 17.5752 0.0620117 11.5C0.0620117 5.4248 4.98682 0.5 11.062 0.5C17.1372 0.5 22.062 5.4248 22.062 11.5ZM20.062 11.5C20.062 16.4705 16.0325 20.5 11.062 20.5C6.09155 20.5 2.06201 16.4705 2.06201 11.5C2.06201 6.52954 6.09155 2.5 11.062 2.5C16.0325 2.5 20.062 6.52954 20.062 11.5Z",fill:"currentColor"})]})}function bt({id:t,commentCount:u,username:h,close:p}){const{User:N}=l.useContext(B),[g]=N,[m,r]=l.useState([]),[a,S]=l.useState(""),[n,i]=l.useState(null),P=l.useRef(null),L=l.useRef(null);l.useEffect(()=>{var d;se("TikTok")&&E("TikTok",{action:"getComments",page:0,data:{id:t,creator:h}},{success:!0,comments:(d=$.Videos.find(v=>v.id===t))==null?void 0:d.commentsData}).then(v=>{if(!(v!=null&&v.success))return f("warning",v.error);r(v.comments)})},[]);const y=()=>{if(a.trim().length===0)return f("warning","Comment is empty");let d=n!=null&&n.isReplyToReply?`@${n.name} ${a}`:a;E("TikTok",{action:"postComment",data:{id:t,comment:d,replyTo:n==null?void 0:n.id}},{success:!0,id:Math.floor(Math.random()*100)}).then(v=>{if(!(v!=null&&v.success))return f("warning",v.error);r(n?I=>I.map(b=>b.id==n.id?{...b,reply_count:b!=null&&b.reply_count?b.reply_count+1:1,replies:[{id:v.id,username:g.username,avatar:g.avatar,comment:d,timestamp:new Date().getTime(),likes:0,liked:!1,verified:g.verified},...(b==null?void 0:b.replies)||[]]}:b):I=>[{id:v.id,username:g.username,avatar:g.avatar,comment:d,timestamp:new Date().getTime(),likes:0,liked:!1,verified:g.verified},...I]),S(""),L.current.style.height="auto",i(null)})},{handleScroll:_}=Se({fetchData:d=>E("TikTok",{action:"getComments",data:{id:t,creator:h},page:d}),onDataFetched:d=>r(v=>[...v,...(d==null?void 0:d.comments)??[]]),perPage:15});return l.useEffect(()=>{const d=v=>{const I=P.current;I.scrollTo({top:I.scrollTop+v.deltaY,behavior:"smooth"})};return P.current&&P.current.addEventListener("wheel",d),()=>{P.current&&P.current.removeEventListener("wheel",d)}},[P]),e("div",{className:"comments-container",onClick:()=>p(),children:o(oe.div,{...pe,className:"comments-wrapper",onClick:d=>d.stopPropagation(),children:[o("div",{className:"comments-header",children:[e("div",{}),e("div",{className:"title",children:s("APPS.TIKTOK.COMMENTS_TITLE").format({count:u})}),e("div",{className:"close",children:e(we,{onClick:p})})]}),e("div",{className:"comments-body",ref:P,onScroll:_,children:m.map((d,v)=>e(Ye,{comment:d,videoId:t,username:h,remove:()=>r(I=>I.filter(b=>b.id!=d.id)),setReplyTo:i},d.id))}),o("div",{className:"comments-footer",children:[e("img",{src:Z(g.avatar)}),o("div",{className:"input",children:[e(ue,{maxLength:300,ref:L,value:a,onChange:d=>{S(d.target.value);let v=d.target.scrollHeight;d.target.style.height=v+"px"},onKeyDown:d=>{d.key=="Enter"&&y(),d.key==" "&&S(v=>v+" ")},placeholder:n?s("APPS.TIKTOK.REPLY_TO").format({name:n.name}):s("APPS.TIKTOK.ADD_COMMENT")}),e("span",{onClick:()=>{W.Emoji.set({onSelect:d=>S(v=>v+d.emoji)})},children:e(_t,{})}),a.trim().length>0&&e("span",{children:e(ye,{onClick:y})})]})]})]})})}const Ye=({videoId:t,username:u,comment:h,remove:p,setReplyTo:N})=>{var O,F,k;const{User:g}=l.useContext(B),[m]=g,[r,a]=l.useState(h),[S,n]=l.useState(r.likes),[i,P]=l.useState(r.liked===1),[L,y]=l.useState(r.creator_liked===1);l.useState(0),l.useState(!1),l.useState(!1);const[_,d]=l.useState(!1);l.useEffect(()=>{h&&a(h)},[h]);const v=()=>{E("TikTok",{action:"getComments",page:0,data:{id:t,replyTo:r.id,creator:u}},null).then(w=>{if(!(w!=null&&w.success))return f("warning",w.error);a(K=>({...K,replies:[...(K==null?void 0:K.replies)??[],...w.comments.filter(c=>K!=null&&K.replies?!K.replies.some(T=>T.id===c.id):!0)]})),d(!0)})},I=()=>{E("TikTok",{action:"toggleLikeComment",id:r.id,toggle:!i},{success:!0}).then(w=>{if(!(w!=null&&w.success))return f("warning",w.error);m.username===u&&y(K=>!K),P(K=>!K),a(K=>({...K,liked:!K.liked}))})};de("tiktok:updateCommentLikes",w=>{w.id===r.id&&n(K=>w.method==="add"?K+1:K-1)});let b=r.username!==m.username||u!==r.username||m.isAdmin;const U=Xe(w=>{if(w.stopPropagation(),w.preventDefault(),!b)return f("warning","You cannot click to this comment!");let K=[(m.isAdmin||m.username===r.username)&&{title:s("APPS.TIKTOK.DELETE_COMMENT"),color:"red",cb:()=>{E("TikTok",{action:"deleteComment",id:r.id,videoId:t}).then(c=>{if(!(c!=null&&c.success))return f("warning",c.error);p()})}}];W.ContextMenu.set({buttons:K})});return o("div",{className:"item","data-clickable":b,"data-id":r.id,children:[o("div",{className:"comment-info",...U,children:[e("div",{className:"avatar",children:e("img",{src:Z(r.avatar)})}),o("div",{className:"comment-data",children:[o("div",{className:"username",children:[r.username,r.verified&&e(me,{}),r.username===u&&e("div",{className:"creator-badge",children:s("APPS.TIKTOK.CREATOR")})]}),e("div",{className:"comment",children:r.comment}),o("div",{className:"actions",children:[e("div",{className:"timestamp",children:Ce(r.timestamp)}),e("div",{className:"reply",onClick:()=>{N(()=>({id:r.replyTo??r.id,name:r.username,isReplyToReply:r.replyTo!==void 0}))},children:s("APPS.TIKTOK.REPLY")})]}),L&&e("div",{className:"creator-liked",children:s("APPS.TIKTOK.LIKED_BY_CREATOR")})]})]}),(r.reply_count>0||r.replies)&&o("div",{className:"replies",children:[(O=r.replies)==null?void 0:O.map(w=>e(Ye,{videoId:t,username:u,comment:{...w,replyTo:r.id},remove:()=>{a(K=>{var c;return{...K,reply_count:K.reply_count-1,replies:(c=K.replies)==null?void 0:c.filter(T=>T.id!==w.id)}})},setReplyTo:N})),!_&&((F=r.replies)==null?void 0:F.length)!==r.reply_count&&o("div",{className:"view-replies",onClick:v,children:[s("APPS.TIKTOK.VIEW_REPLIES")," ",o("b",{children:["(",r!=null&&r.replies?r.reply_count-(((k=r.replies)==null?void 0:k.length)??0):r.reply_count,")"]})," ",e(Me,{})]})]}),o("div",{className:"likes","data-active":i,onClick:I,children:[i?e(Ae,{}):e(Ze,{}),z(S)]})]})};function Ut({className:t}){return o("svg",{className:t,width:"43",height:"36",viewBox:"0 0 43 36",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[o("g",{filter:"url(#filter0_d_4_1154)",children:[e("path",{d:"M37.9988 19.0845C38.4285 18.6965 38.4399 18.0257 38.0236 17.6233L24.7382 4.78295C24.1035 4.16949 23.0432 4.61928 23.0432 5.50199V10.8621C18.0772 10.7853 14.3463 12.0842 11.5737 14.0746C8.75779 16.0962 6.9636 18.807 5.858 21.4345C4.75341 24.0595 4.32774 26.6203 4.25995 28.3761C4.22652 29.242 4.27816 29.9566 4.40223 30.3933C4.43394 30.5048 4.47678 30.622 4.53837 30.7255C4.59258 30.8167 4.70727 30.9754 4.91565 31.0417C5.16639 31.1214 5.37921 31.0191 5.50256 30.9132C5.61389 30.8176 5.6887 30.6943 5.74047 30.5908L5.74705 30.5777L5.75234 30.5653L5.75284 30.5641L5.75411 30.5613L5.76432 30.5391C5.77418 30.518 5.79023 30.4845 5.81294 30.44C5.85837 30.3509 5.93042 30.2173 6.03287 30.049C6.23783 29.7123 6.56409 29.237 7.04199 28.6994C7.99659 27.6255 9.55921 26.2993 11.979 25.3314C13.3564 24.7805 15.6523 24.5297 17.9033 24.4891C20.0514 24.4504 22.0549 24.6041 23.0432 24.822V30.3392C23.0432 31.2058 24.0703 31.6622 24.7134 31.0814L37.9988 19.0845Z",fill:"currentColor"}),e("path",{d:"M33.906 17.6574C34.8657 16.5418 33.906 14.9506 33.906 14.9506L32.25 12.0469L24.7382 4.78295C24.1035 4.16949 23.0432 4.61928 23.0432 5.50199V10.8621C18.0772 10.7853 14.3463 12.0842 11.5737 14.0746C8.75779 16.0962 6.9636 18.807 5.858 21.4345C4.75341 24.0595 4.32774 26.6203 4.25995 28.3761C4.22652 29.242 4.27816 29.9566 4.40223 30.3933C4.43394 30.5048 4.47678 30.622 4.53837 30.7255C4.59258 30.8167 4.70727 30.9754 4.91565 31.0417C5.16639 31.1214 5.37921 31.0191 5.50256 30.9132C5.61389 30.8176 5.6887 30.6943 5.74047 30.5908L5.74705 30.5777L5.75234 30.5653L5.75284 30.5641L5.75411 30.5613L5.76432 30.5391C5.77418 30.518 5.79023 30.4845 5.81294 30.44C5.85837 30.3509 5.93042 30.2173 6.03287 30.049C6.23783 29.7123 6.56409 29.237 7.04199 28.6994C7.99659 27.6255 13.2932 23.8672 16.2932 22.3672C18.7932 20.8672 23.0432 19.8672 23.0432 19.8672V25.8672C23.0432 26.7337 24.0703 27.1901 24.7134 26.6094L33.906 17.6574Z",fill:"currentColor"})]}),e("defs",{children:o("filter",{id:"filter0_d_4_1154",x:"0.25",y:"0.83",width:"42.0786",height:"34.8412",filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB",children:[e("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),e("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),e("feOffset",{dy:"0.33"}),e("feGaussianBlur",{stdDeviation:"2"}),e("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.1 0"}),e("feBlend",{mode:"normal",in2:"BackgroundImageFix",result:"effect1_dropShadow_4_1154"}),e("feBlend",{mode:"normal",in:"SourceGraphic",in2:"effect1_dropShadow_4_1154",result:"shape"})]})})]})}function ke({data:t,active:u,preview:h}){var j,ie,te;const{User:p,Func:N,ShareComponent:g,GoBack:m}=l.useContext(B),r=fe(ce.Settings),[a]=p,[S,n]=g,[i,P]=l.useState(t==null?void 0:t.liked),[L,y]=l.useState(t==null?void 0:t.saved),[_,d]=l.useState(t==null?void 0:t.viewed),[v,I]=l.useState(t==null?void 0:t.likes),[b,U]=l.useState(t==null?void 0:t.saves),[O,F]=l.useState(t==null?void 0:t.comments),[k,w]=l.useState(!1),K=l.useRef(null),c=l.useRef(null),T=l.useRef(null),R=l.useRef(0),[x,G]=l.useState(!1),[X,ae]=l.useState(!1),Q=fe(Be),re=fe(ge),V=fe(Ie.LockScreenVisible);l.useEffect(()=>{var C,M;return u&&((C=t.music)!=null&&C.path&&ee(),(M=t.metadata)!=null&&M.tts&&H()),()=>{c!=null&&c.current&&c.current.pause(),T!=null&&T.current&&T.current.pause(),_||E("TikTok",{action:"setViewed",id:t.id},!0).then(()=>{d(!0)})}},[u]),l.useEffect(()=>{var C,M,Y;Q!=null&&Q.visible||!se("TikTok")||V?(ae(!0),c!=null&&c.current&&c.current.pause(),T!=null&&T.current&&T.current.pause()):((Y=(M=(C=ge)==null?void 0:C.value)==null?void 0:M.active)==null?void 0:Y.name)==="TikTok"&&(ae(!1),c!=null&&c.current&&c.current.play().catch(()=>f("warning","TTS failed to play")),T!=null&&T.current&&T.current.play().catch(()=>f("warning","Music failed to play")))},[Q==null?void 0:Q.visible,re==null?void 0:re.active,V]);const H=()=>{var Y,Te;if(!t.metadata.ttsUrl)return;c!=null&&c.current&&(c.current.pause(),c.current=null);const C=new Audio;C.src=t.metadata.ttsUrl;let M=((Y=r==null?void 0:r.sound)==null?void 0:Y.volume)!==void 0?(Te=r==null?void 0:r.sound)==null?void 0:Te.volume:.5;C.volume=M/2,C.play().catch(()=>f("warning","TTS failed to play")),c.current=C},ee=()=>{var M,Y;const C=new Audio;T!=null&&T.current&&(T.current.pause(),T.current=null),C.src=(M=t.music.path)!=null&&M.includes("http")?t.music.path:`./assets/sound/songs/${t.music.path}`,C.volume=t.music.volume*(((Y=r==null?void 0:r.sound)==null?void 0:Y.volume)!==void 0?r.sound.volume:.5),C.play().catch(()=>f("warning","Music failed to play")),T.current=C};l.useEffect(()=>{var C,M,Y,Te;(C=r==null?void 0:r.sound)!=null&&C.volume&&(K.current&&(K.current.volume=((M=r==null?void 0:r.sound)==null?void 0:M.volume)!==void 0?r.sound.volume:.5),T!=null&&T.current&&(T.current.volume=t.music.volume*(((Y=r==null?void 0:r.sound)==null?void 0:Y.volume)!==void 0?r.sound.volume:.5)),c!=null&&c.current&&(c.current.volume=(((Te=r==null?void 0:r.sound)==null?void 0:Te.volume)!==void 0?r.sound.volume:.5)/2))},[(j=r==null?void 0:r.sound)==null?void 0:j.volume]);const q=()=>{h||E("TikTok",{action:"toggleLike",id:t.id,toggle:!i},{success:!0}).then(C=>{if(!C.success)return f("warning",C.error);P(!i)})},A=()=>{h||-E("TikTok",{action:"toggleSave",id:t.id,toggle:!L},{success:!0}).then(C=>{if(!C.success)return f("warning",C.error);y(!L)})};de("tiktok:updateLikes",C=>{if(C&&C.id===t.id)return I(M=>M+(C.method==="add"?1:-1))}),de("tiktok:updateSaves",C=>{if(C&&C.id===t.id)return U(M=>M+(C.method==="add"?1:-1))}),de("tiktok:updateComments",C=>{if(C&&C.id===t.id)return F(M=>(C.count=C.count??1,M+(C.method==="add"?C.count:-C.count)))});const D=C=>{if(C.detail===1)return ae(!X);if(C.detail===2){if(!t.id)return;i||(q(),G(!0),setTimeout(()=>{G(!1)},1e3))}};return l.useEffect(()=>{const C=document.querySelector(".video video");C&&(X?(C.pause(),c!=null&&c.current&&c.current.pause(),T!=null&&T.current&&T.current.pause(),f("info","paused everything")):(C.play().catch(()=>f("warning","Video failed to play")),c!=null&&c.current&&c.current.play().catch(()=>f("warning","TTS failed to play")),T!=null&&T.current&&T.current.play().catch(()=>f("warning","Music failed to play")),f("info","playing everything")))},[X]),o(J,{children:[e(Pe,{children:k&&!h&&e(bt,{id:t.id,username:t.username,commentCount:O,close:()=>w(!1)})}),o("div",{className:"video","data-active":u,onClick:D,children:[x&&e("div",{className:"popup-heart","data-visible":x,children:e(xe,{})}),X&&e("div",{className:"paused",children:e(Oe,{})}),e("video",{src:t.src,autoPlay:!0,loop:!0,muted:!u,ref:K,onTimeUpdate:C=>{var M,Y;u&&(C.target.currentTime<R.current&&((M=t==null?void 0:t.music)!=null&&M.path&&ee(),(Y=t==null?void 0:t.metadata)!=null&&Y.ttsUrl&&(c.current.currentTime=0,c.current.play().catch(()=>f("warning","TTS failed to play")))),R.current=C.target.currentTime)},onLoadedMetadata:C=>{var M;u&&(C.currentTarget.volume=((M=r==null?void 0:r.sound)==null?void 0:M.volume)!==void 0?r.sound.volume:.5)}}),o("div",{className:"video-info",children:[o("div",{className:"user",children:[o("div",{className:"username",onClick:()=>{if(!h)return N.fetchAndSetProfile(t.username)},children:[t.name??`@${t.username}`,t.verified&&e(me,{})]}),o("span",{children:[" â€¢ ",Ce(t.timestamp)]})]}),e("div",{className:"caption",children:t.caption}),((ie=t==null?void 0:t.music)==null?void 0:ie.title)&&o("div",{className:"song",children:[e(Qe,{})," ",t.music.artist," - ",t.music.title]})]}),o("div",{className:"video-actions",children:[e("img",{className:"profile",src:Z(t.avatar),onClick:C=>{if(C.stopPropagation(),!h)return N.fetchAndSetProfile(t.username)}}),o("div",{className:"action","data-active":i,onClick:C=>{C.stopPropagation(),q()},children:[e(Ae,{className:"like"}),z(v)]}),o("div",{className:"action",onClick:C=>{C.stopPropagation(),w(!0)},children:[e(ze,{className:"comment"}),z(O)]}),o("div",{className:"action",onClick:C=>{C.stopPropagation(),A()},"data-active":L,children:[e(Ge,{className:"save"}),z(b)]}),e("div",{className:"action",onClick:C=>{C.stopPropagation(),n({id:t.id,src:t.src,username:t.username,pinned:t.pinned})},children:(a==null?void 0:a.username)===t.username?e(et,{className:"manage"}):o(J,{children:[e(Ut,{className:"share"}),s("APPS.TIKTOK.SHARE")]})}),e("div",{className:"song",children:e("img",{src:((te=t==null?void 0:t.music)==null?void 0:te.cover)??"./assets/img/icons/music/unknown.png"})})]})]})]})}function _e(){var re;const{View:t,Profile:u,FeedData:h,Func:p,GoBack:N}=l.useContext(B),g=fe(ce.Settings),[m,r]=t,[a,S]=h,[n,i]=N,[P,L]=l.useState(0),[y,_]=l.useState(!1),[d,v]=l.useState(!1),[I,b]=l.useState("recent"),[U,O]=l.useState([]),[F,k]=l.useState(0),w=fe(ge),K=l.useRef(null);l.useEffect(()=>{var V;if(se("TikTok")){if(m!=="feed"){c.current=!0;return}return L(0),v(!1),_(!1),O([]),(V=a==null?void 0:a.args)!=null&&V.single?(O([a.video]),k(0),R.current=0):E("TikTok",{action:"getVideos",page:0,data:{full:!0,type:I,...a==null?void 0:a.args}},$.Videos).then(H=>{if(!H)return f("warning","No videos found");H.length<5&&v(!0),a&&(a!=null&&a.video)&&H.unshift(a.video),k(0),R.current=0,O(H)}),()=>{S(null)}}},[m]),l.useEffect(()=>{if(se("TikTok")&&m==="feed")return setTimeout(()=>{ce.Styles.TextColor.set("#ffffff")},100),()=>{ce.Styles.TextColor.set(g.display.theme==="dark"?"#ffffff":"#000000"),ce.SoundManager.reset()}},[m,w==null?void 0:w.active]);const c=l.useRef(!0);l.useEffect(()=>{if(se("TikTok")&&!a){if(c.current){c.current=!1;return}O([]),E("TikTok",{action:"getVideos",page:0,data:{full:!0,type:I}},$.Videos).then(V=>{if(!V)return f("warning","No videos found");V.length<5&&v(!0),O(V),R.current=0,k(0)})}},[I,a]);const T=l.useRef(!1),R=l.useRef(0);l.useEffect(()=>{R.current=0,k(0),L(0),v(!1),_(!1)},[I]),l.useEffect(()=>{if(se("TikTok")){if(U.length===0)return f("info","No videos found");if(U.length===1||U.length-2===F){if(f("info","fetching more videos: "+JSON.stringify(a)),a!=null&&a.single)return;if(y||d)return f("info","Already fetching or fetched everything");_(!0),E("TikTok",{action:"getVideos",page:P+1,data:{full:!0,type:I,...a==null?void 0:a.args}},null).then(V=>{V&&V.length>0?(V.length<5&&v(!0),O(H=>[...H,...V]),_(!1)):(f("info","Fetched everything"),_(!1),v(!0)),L(H=>H+1)})}}},[F]),l.useEffect(()=>{if(!U||U.length===0)return;const V=()=>{if(!T.current)return requestAnimationFrame(V);T.current=!1;const D=K.current,ie=document.querySelector(".video").getBoundingClientRect().height,te=R.current*ie;f("info",`Target scroll position: ${te}, current scroll position: ${D.scrollTop}, snapIndex: ${R.current}`),D.scrollTo({top:te,behavior:"smooth"}),k(R.current),requestAnimationFrame(V)};requestAnimationFrame(V);const H=D=>{var j,ie;D.preventDefault(),!((ie=(j=Be)==null?void 0:j.value)!=null&&ie.visible)&&x(D)},ee=["ArrowUp","ArrowDown","Space"],q=D=>{var j;(ee.includes(D.key)||ee.includes(D.code))&&!document.querySelector(".tiktok-content")&&((j=w==null?void 0:w.active)==null?void 0:j.name)==="TikTok"&&D.preventDefault(),(D.key==="ArrowUp"||D.key==="ArrowDown")&&G(D.key==="ArrowUp"?-1:1)},A=K.current;return A.addEventListener("wheel",H,{passive:!1}),window.addEventListener("keydown",q),()=>{f("info","Removing event listeners (space button)"),A.removeEventListener("wheel",H),window.removeEventListener("keydown",q)}},[U]);const x=V=>{if(V.preventDefault(),ae())return;const ee=V.deltaY<0?-1:1;G(ee)},G=V=>{const ee=U.length-1,q=R.current+V;q>=0&&q<=ee?(R.current=q,T.current=!0,f("info","Scrolling to video: "+R.current)):q<0?f("info","Top of the feed, trying to scroll up?"):f("info","Reached the bottom of the feed")},X=V=>{V.button===1&&V.preventDefault()},ae=()=>!!document.querySelector(".comments-container");let Q=m==="feed";return e("div",{className:"tiktok-feed",style:{visibility:Q?"visible":"hidden"},children:o(oe.div,{className:"feed-wrapper",...We("right",m),children:[!a&&e("div",{className:"feed-header",children:o("div",{className:"feed-header-content",children:[e("div",{className:le("item",I=="following"&&"active"),onClick:()=>b("following"),children:s("APPS.TIKTOK.FOLLOWING")}),e("div",{className:le("item",I=="recent"&&"active"),onClick:()=>b("recent"),children:s("APPS.TIKTOK.FOR_YOU")}),e("div",{className:"border","data-direction":I==="recent"?"right":"left"})]})}),I==="following"&&U.length===0&&e("div",{className:"no-following",children:s("APPS.TIKTOK.NO_FOLLOWING_TITLE")}),(((re=a==null?void 0:a.args)==null?void 0:re.username)||(n==null?void 0:n.view))&&e(ve,{className:"go-back",onClick:()=>{S(null),n!=null&&n.view&&!(n!=null&&n.ignoreFeed)?(r(n.view),i(null)):p.fetchAndSetProfile(a.args.username)}}),e("div",{className:"videos",ref:K,onMouseDown:X,children:U==null?void 0:U.map((V,H)=>e(ke,{data:V,active:F===U.indexOf(V)&&Q},H))})]})})}function Dt(){const{User:t,LoggedIn:u,View:h}=l.useContext(B),[p,N]=t,[g,m]=u,[r,a]=h,[S,n]=l.useState("login"),[i,P]=l.useState(null),[L,y]=l.useState(!0),_=()=>{if(L)return f("warning","Button is disabled");if(!i)return f("warning","No form data");let d=i==null?void 0:i.username.toLowerCase().replace(/\s/g,"");if(S==="signup"){let v=d.match(he.value.UsernameFilter);if(!v||(v==null?void 0:v[0])!==d||d.length<3||d.length>15){f("warning","Username did not match regex"),W.PopUp.set({title:s("APPS.INSTAGRAM.ERROR"),description:s("APPS.INSTAGRAM.USERNAME_NOT_ALLOWED"),buttons:[{title:s("APPS.INSTAGRAM.OK")}]});return}}E("TikTok",{action:S,data:i}).then(v=>{var I,b,U,O,F,k;if(!v)return f("warning","Could not login, no response");if(v.success){let w={...v.data,username:((I=v.data)==null?void 0:I.username)??d,name:((b=v.data)==null?void 0:b.username)??(i==null?void 0:i.name),follower_count:((U=v.data)==null?void 0:U.follower_count)||0,following_count:((O=v.data)==null?void 0:O.following_count)||0,like_count:((F=v.data)==null?void 0:F.like_count)||0};N(w),m(!0),a("feed"),ne.APPS.TIKTOK.account.set(w)}else{if(v.error)return W.PopUp.set({title:s("APPS.INSTAGRAM.ERROR"),description:s(`APPS.INSTAGRAM.${(k=v.error)==null?void 0:k.toUpperCase()}`),buttons:[{title:s("APPS.INSTAGRAM.OK")}]});f("info",`Could not login, ${v.error}`)}})};return l.useEffect(()=>{var d,v;i&&y(S==="login"?!i.username||!i.password:!i.name||!i.username&&((d=i.username)==null?void 0:d.length)<3||!i.password&&((v=i.password)==null?void 0:v.length)<3)},[i]),o("div",{className:"login-container",children:[o("div",{className:"login-header",children:[e("div",{className:"title",children:S==="login"?s("APPS.TIKTOK.LOGIN_TITLE"):s("APPS.TIKTOK.SIGNUP_TITLE")}),e("div",{className:"subtitle",children:S==="login"?s("APPS.TIKTOK.LOGIN_SUBTITLE"):s("APPS.TIKTOK.SIGNUP_SUBTITLE")})]}),o("div",{className:"login-body",children:[S==="signup"&&e(ue,{placeholder:s("APPS.TIKTOK.NAME"),onChange:d=>{d.target.value.length>30||P({...i,name:d.target.value})}}),e(ue,{placeholder:s("APPS.TIKTOK.USERNAME"),onChange:d=>{d.target.value.length>20||P({...i,username:d.target.value.toLowerCase()})}}),e(ue,{type:"password",placeholder:s("APPS.TIKTOK.PASSWORD"),onChange:d=>{d.target.value.length>50||P({...i,password:d.target.value})}}),e("div",{className:"login-button","data-disabled":L,onClick:_,children:S==="login"?s("APPS.TIKTOK.LOGIN"):s("APPS.TIKTOK.SIGNUP")})]}),e("div",{className:"login-footer",children:S==="login"?o(J,{children:[s("APPS.TIKTOK.NO_ACCOUNT")," ",e("span",{onClick:()=>n("signup"),children:s("APPS.TIKTOK.SIGNUP")})]}):o(J,{children:[s("APPS.TIKTOK.ALREADY_ACCOUNT")," ",e("span",{onClick:()=>n("login"),children:s("APPS.TIKTOK.LOGIN")})]})})]})}function Ft(){const{User:t,Profile:u,View:h,LoggedIn:p,UserPanel:N,Func:g,GoBack:m,Dm:r}=l.useContext(B),[a,S]=t,[n,i]=u,[P,L]=p,[y,_]=N,[d,v]=m,[I,b]=r,[U,O]=h,[F,k]=l.useState([]),[w,K]=l.useState(!1),[c,T]=l.useState("recent"),[R,x]=l.useState((n==null?void 0:n.follower_count)||0),[G,X]=l.useState((n==null?void 0:n.following_count)||0),ae=[{value:"recent",icon:e(tt,{})},{value:"liked",icon:n!=null&&n.show_likes?e(xe,{}):e(nt,{})},{value:"saved",hidden:(a==null?void 0:a.username)!==(n==null?void 0:n.username),icon:e(Ge,{})}],Q=[{label:s("APPS.TIKTOK.FOLLOWING"),name:"following",value:n==null?void 0:n.following_count},{label:s("APPS.TIKTOK.FOLLOWERS"),name:"followers",value:n==null?void 0:n.follower_count},{label:s("APPS.TIKTOK.LIKES"),value:n==null?void 0:n.like_count}];l.useEffect(()=>{se("TikTok")&&n&&(x((n==null?void 0:n.follower_count)||0),X((n==null?void 0:n.following_count)||0),k([]),!(c==="liked"&&!(n!=null&&n.show_likes)&&a.username!==n.username)&&E("TikTok",{action:"getVideos",data:{full:!1,username:n.username,type:c},page:0},$.Videos.filter(A=>A.username===n.username)).then(A=>{if(!A)return f("warning","Failed to get videos");k(A)}))},[c,n==null?void 0:n.username]);const{handleScroll:re}=Se({fetchData:A=>E("TikTok",{action:"getVideos",data:{full:!1,username:n.username,type:c},page:A}),onDataFetched:A=>k(D=>[...D,...A]),perPage:25}),V=A=>{E("TikTok",{action:"toggleFollow",data:{username:n.username,follow:A}},{success:!0}).then(D=>{if(!D||!(D!=null&&D.success))return f("warning","Failed to toggle follow");if(D.error)return f("error",D.error);f("info",`Toggling follow to ${A}`),i({...n,isFollowing:A})})};de("tiktok:updateFollowers",A=>{if(!A||A.username!==n.username)return;let D=R+(A.method==="add"?1:-1);i({...n,follower_count:D}),x(D)}),de("tiktok:updateFollowing",A=>{if(!A||A.username!==n.username)return;let D=G+(A.method==="add"?1:-1);i({...n,following_count:D}),X(D)});const H=()=>{a.username===n.username&&E("AccountSwitcher",{action:"getAccounts",app:"TikTok"}).then(A=>{var ie;if(!A)return f("info","No accounts found");let D=a.isAdmin,j=(ie=A==null?void 0:A.filter(te=>te!==a.username))==null?void 0:ie.map(te=>({title:te,cb:()=>{te!==a.username&&E("AccountSwitcher",{action:"switch",app:"TikTok",account:te}).then(()=>{E("TikTok",{action:"isLoggedIn"}).then(C=>{C?(ne.APPS.TIKTOK.account.set(C),S({...C,isAdmin:D}),O("feed"),L(!0)):ne.APPS.TIKTOK.account.set(null)})})}}));W.ContextMenu.set({buttons:[...j,{title:s("APPS.TIKTOK.ADD_ACCOUNT_TITLE"),cb:()=>{L(!1)}}]})})},ee=A=>{S(A),i(A),K(!1)},q=()=>{a.username!==n.username&&E("TikTok",{action:"getChannelId",username:n.username}).then(A=>{b({id:A.id,username:n.username,name:n.name,avatar:n.avatar,follower_count:n.follower_count,following_count:n.following_count,isFollowing:n.isFollowing}),v({view:"profile",data:{identifier:"profile",data:n}}),O("dm"),i(null)})};return n?o(J,{children:[e(Pe,{children:w&&e(Rt,{close:A=>ee(A)})}),o(oe.div,{className:"profile-container",children:[o("div",{className:"profile-header",children:[n.username===a.username?e("span",{}):e("div",{children:e(ve,{className:"go-back",onClick:()=>{var A,D;if(d!=null&&d.view){if(d!=null&&d.data)switch((A=d==null?void 0:d.data)==null?void 0:A.identifier){case"dm":b((D=d==null?void 0:d.data)==null?void 0:D.data),O("dm");break;default:O("feed"),i(null)}else O(d==null?void 0:d.view);v(null)}else O("feed");i(null)}})}),o("div",{className:"name",onClick:H,children:[n.name,a.username===n.username&&e(Me,{})]}),e("span",{})]}),o("div",{className:"profile-info",onScroll:re,children:[e("div",{className:"avatar",children:e("img",{src:Z(n.avatar)})}),o("div",{className:"username",children:["@",n.username,n.verified&&e(me,{})]}),e("div",{className:"stats",children:Q.map((A,D)=>{let j={followers:R,following:G};return o("div",{className:"item","data-cursor":A.name!==void 0,onClick:()=>{A.name&&_({value:A.name,username:n.username,following:G,followers:R})},children:[e("div",{className:"value",children:z(j[A.name]??n.like_count)}),e("div",{className:"label",children:A.label})]},D)})}),o("div",{className:"actions",children:[a.username===n.username?e("div",{className:"button big",onClick:()=>K(!0),children:s("APPS.TIKTOK.EDIT_PROFILE")}):e(J,{children:n.isFollowing?o(J,{children:[e("div",{className:le("button","big"),onClick:q,children:s("APPS.TIKTOK.MESSAGE")}),e("div",{className:"button",onClick:()=>{W.PopUp.set({title:s("APPS.TIKTOK.UNFOLLOW_POPUP.TITLE"),description:s("APPS.TIKTOK.UNFOLLOW_POPUP.DESCRIPTION").format({name:n.name}),buttons:[{title:s("APPS.TIKTOK.UNFOLLOW_POPUP.CANCEL")},{title:s("APPS.TIKTOK.UNFOLLOW_POPUP.PROCEED"),color:"red",cb:()=>V(!1)}]})},children:e(it,{})})]}):o(J,{children:[e("div",{className:"button follow",onClick:()=>V(!0),children:s("APPS.TIKTOK.FOLLOW")}),e("div",{className:"button",onClick:q,children:e(Re,{})})]})}),n.instagram&&e("div",{className:"button instapic",onClick:()=>{ge.patch({active:{name:"Instagram",data:{username:n.instagram,view:"profile"}}})},children:e("img",{src:"./assets/img/icons/instagram/icon.svg"})}),n.twitter&&e("div",{className:"button birdy",onClick:()=>{ge.patch({active:{name:"Twitter",data:{username:n.twitter,view:"profile"}}})},children:e("img",{src:"./assets/img/icons/twitter/logo.png"})})]}),e("div",{className:"bio",children:n.bio}),o("div",{className:"profile-videos",children:[e("div",{className:"navbar",children:ae.filter(A=>!A.hidden).map(A=>e("div",{className:le("item",c===A.value&&"active"),onClick:()=>T(A.value),children:A.icon}))}),o("div",{className:"feed",children:[c==="liked"&&!(n!=null&&n.show_likes)&&a.username!==n.username&&o("div",{className:"private",children:[e("div",{className:"title",children:s("APPS.TIKTOK.LIKED_HIDDEN_TITLE")}),e("div",{className:"subtitle",children:s("APPS.TIKTOK.LIKED_HIDDEN_SUBTITLE").format({name:n.username})})]}),F.map((A,D)=>e(yt,{data:A,onClick:()=>{v({...d,ignoreFeed:!0}),g.fetchAndSetVideo(A.id,{username:n.username,id:A.id,type:c})}}))]})]})]})]})]}):null}const yt=({data:t,onClick:u})=>o("div",{className:"item",onClick:u,children:[e("video",{src:t.src,loop:!0,onMouseEnter:h=>h.currentTarget.play().catch(()=>f("warning","Failed to play video")),onMouseLeave:h=>h.currentTarget.pause(),muted:!0}),t.pinned===1&&e("div",{className:"pinned",children:"Pinned"}),o("div",{className:"views",children:[e(De,{}),z(t.views)]})]}),Rt=t=>{var P,L,y,_,d,v;const{User:u,LoggedIn:h,View:p}=l.useContext(B),[N,g]=u,[m,r]=h,[a,S]=l.useState(null),n=["instagram","twitter"];l.useEffect(()=>{S({name:N.name,bio:N.bio,avatar:N.avatar,instagram:N.instagram,twitter:N.twitter,show_likes:N.show_likes})},[]);const i=()=>{E("TikTok",{action:"updateProfile",data:a},{success:!0}).then(I=>{if(!I)return f("warning","No response from server");if(I.success)ne.APPS.TIKTOK.account.set({...N,...a}),t.close({...N,...a});else switch(f("error",I.error),I.error){case"invalid_twitter":W.PopUp.set({title:s("APPS.TIKTOK.INVALID_ACCOUNT_POPUP.TITLE").format({name:s("APPS.TWITTER.TITLE")}),description:s("APPS.TIKTOK.INVALID_ACCOUNT_POPUP.DESCRIPTION").format({name:s("APPS.TWITTER.TITLE".toLocaleLowerCase())}),buttons:[{title:s("APPS.TIKTOK.INVALID_ACCOUNT_POPUP.OK")}]});break;case"invalid_instagram":W.PopUp.set({title:s("APPS.TIKTOK.INVALID_ACCOUNT_POPUP.TITLE").format({name:s("APPS.INSTAGRAM.TITLE")}),description:s("APPS.TIKTOK.INVALID_ACCOUNT_POPUP.DESCRIPTION").format({name:s("APPS.INSTAGRAM.TITLE").toLocaleLowerCase()}),buttons:[{title:s("APPS.TIKTOK.INVALID_ACCOUNT_POPUP.OK")}]})}})};return o(oe.div,{...pe,className:"edit-profile-container",children:[o("div",{className:"edit-profile-header",children:[e("div",{children:e(ve,{onClick:i})}),e("div",{className:"title",children:s("APPS.TIKTOK.EDIT_PROFILE")}),e("span",{})]}),o("div",{className:"edit-profile-content",children:[o("div",{className:"avatar",children:[o("div",{className:"image",onClick:()=>{var I,b,U;return W.Gallery.set({allowExternal:(U=(b=(I=he)==null?void 0:I.value)==null?void 0:b.AllowExternal)==null?void 0:U.Trendy,onSelect:O=>S({...a,avatar:O.src})})},children:[e("img",{src:Z(a==null?void 0:a.avatar)}),e(st,{})]}),s("APPS.TIKTOK.CHANGE_PHOTO")]}),o("div",{className:"form",children:[o("div",{className:"item",children:[e("div",{className:"label",children:s("APPS.TIKTOK.NAME")}),e(ue,{type:"text",defaultValue:a==null?void 0:a.name,onChange:I=>{I.target.value.length<=30&&S({...a,name:I.target.value})}})]}),o("div",{className:"item",children:[e("div",{className:"label",children:s("APPS.TIKTOK.USERNAME")}),e(ue,{type:"text",disabled:!0,value:N.username})]}),o("div",{className:"item",children:[e("div",{className:"label",children:s("APPS.TIKTOK.BIO")}),e($e,{placeholder:s("APPS.TIKTOK.ADD_TO_YOUR_PROFILE"),defaultValue:a==null?void 0:a.bio,onChange:I=>{I.target.value.length<=150&&S({...a,bio:I.target.value})}})]}),e("div",{className:"break"}),n.map((I,b)=>o("div",{className:"item",children:[e("div",{className:"label",children:Ee(I)}),e("div",{className:"value",onClick:()=>{a!=null&&a[I]?W.PopUp.set({title:s("APPS.TIKTOK.REMOVE_ACCOUNT_POPUP.TITLE").format({name:s(`APPS.${I.toUpperCase()}.TITLE`)}),description:s("APPS.TIKTOK.REMOVE_ACCOUNT_POPUP.DESCRIPTION").format({name:s(`APPS.${I.toUpperCase()}.TITLE`)}),buttons:[{title:s("APPS.TIKTOK.REMOVE_ACCOUNT_POPUP.CANCEL")},{title:s("APPS.TIKTOK.REMOVE_ACCOUNT_POPUP.PROCEED"),color:"red",cb:()=>{S({...a,[I]:null})}}]}):E("AccountSwitcher",{action:"getAccounts",app:Ee(I)}).then(U=>{U||f("info","No accounts found");let O=(U==null?void 0:U.map(F=>({title:F,cb:()=>{S({...a,[I]:F})}})))??[];W.ContextMenu.set({buttons:[...O]})})},children:a!=null&&a[I]?`@${a==null?void 0:a[I]}`:s("APPS.TIKTOK.ADD_ACCOUNT").format({name:s(`APPS.${I.toUpperCase()}.TITLE`)})})]},b)),e("div",{className:"break"}),o("div",{className:"item",children:[e("div",{className:"label",children:s("APPS.TIKTOK.SHOW_LIKES")}),e(St,{checked:a==null?void 0:a.show_likes,onChange:()=>{S({...a,show_likes:!(a!=null&&a.show_likes)})}})]})]}),o("div",{className:"buttons",children:[e("div",{className:"button",onClick:()=>{W.PopUp.set({title:s("APPS.INSTAGRAM.SIGN_OUT_POPUP.TITLE"),description:s("APPS.INSTAGRAM.SIGN_OUT_POPUP.DESCRIPTION"),buttons:[{title:s("APPS.INSTAGRAM.SIGN_OUT_POPUP.CANCEL")},{title:s("APPS.INSTAGRAM.SIGN_OUT_POPUP.PROCEED"),color:"red",cb:()=>{E("TikTok",{action:"logout"},!0).then(I=>{if(!I)return f("warning","Failed to logout");ne.APPS.TIKTOK.account.set(null),r(!1)})}}]})},children:s("APPS.TIKTOK.LOGOUT")}),((y=(L=(P=he)==null?void 0:P.value)==null?void 0:L.ChangePassword)==null?void 0:y.Trendy)&&e("div",{className:"button red",onClick:()=>ot("TikTok",()=>{}),children:s("APPS.TIKTOK.CHANGE_PASSWORD")}),((v=(d=(_=he)==null?void 0:_.value)==null?void 0:d.DeleteAccount)==null?void 0:v.Trendy)&&e("div",{className:"button red",onClick:()=>{at("TikTok",()=>{r(null),g(null),ne.APPS.TIKTOK.account.set(null)})},children:s("APPS.TIKTOK.DELETE_ACCOUNT")})]})]})]})};function Vt(){var d,v,I,b,U,O,F;const{View:t,User:u}=l.useContext(B),[h]=u,[p,N]=t,[g,m]=l.useState(0),[r,a]=l.useState(!1),[S,n]=l.useState("en_us_001"),[i,P]=l.useState({src:null,caption:null,music:{title:null,artist:null,path:null,cover:null,volume:.25},metadata:{tts:null,ttsUrl:null,ttsVoice:null}}),[L,y]=l.useState(!1);l.useEffect(()=>{y(i.src&&i.caption)},[i]),l.useEffect(()=>{var k,w,K;switch(g){case 0:W.Gallery.set({allowExternal:(K=(w=(k=he)==null?void 0:k.value)==null?void 0:w.AllowExternal)==null?void 0:K.Trendy,includeVideos:!0,includeImages:!1,onSelect:c=>{P({...i,src:c.src}),m(T=>T+1)}});break}},[g]);const _=()=>{var k,w;E("TikTok",{action:"uploadVideo",data:{src:i.src,caption:i.caption,metadata:((k=i.metadata)==null?void 0:k.ttsUrl)&&i.metadata,music:((w=i.music)==null?void 0:w.path)&&{path:i.music.path,volume:i.music.volume}}},{success:!0}).then(K=>{if(!K||K.error)return f("warning","Failed to upload video, error: "+K.error);if(!K.success)return f("warning","Failed to upload video");N("feed")})};return o("div",{className:"upload-container",children:[r&&e("div",{className:"loading",children:e(He,{size:40,lineWeight:5,speed:2,color:((v=(d=ce.Settings)==null?void 0:d.value)==null?void 0:v.display.theme)==="dark"?"#fff":"#000"})}),g!==0&&o(J,{children:[o("div",{className:"upload-header",children:[e("div",{className:"cancel",onClick:()=>{if(g===2)return m(k=>k-1);if(g===1)return N("feed")},children:g===2?s("APPS.TIKTOK.GO_BACK"):s("APPS.TIKTOK.CANCEL")}),e("div",{className:"title",children:s("APPS.TIKTOK.UPLOAD_VIDEO")}),e("div",{className:"next","data-disabled":!L,onClick:()=>{if(L){if(g===2)return _();i!=null&&i.metadata.tts?(a(!0),Gt(i.metadata.tts,S).then(k=>{a(!1),P({...i,metadata:{...i.metadata,ttsUrl:k}}),m(w=>w+1)}).catch(k=>{a(!1),W.PopUp.set({title:s("APPS.TIKTOK.FAILED_UPLOAD_POPUP.TITLE"),description:s("APPS.TIKTOK.FAILED_UPLOAD_POPUP.DESCRIPTION"),buttons:[{title:s("APPS.TIKTOK.FAILED_UPLOAD_POPUP.CANCEL")},{title:s("APPS.TIKTOK.FAILED_UPLOAD_POPUP.PROCEED"),cb:()=>{m(w=>w+1)}}]})})):m(k=>k+1)}},children:g===1?s("APPS.TIKTOK.PREVIEW"):s("APPS.TIKTOK.SHARE")})]}),o("div",{className:"upload-body",children:[g===1&&o(J,{children:[e("div",{className:"video-placeholder",children:e("video",{src:i.src,controls:!1,autoPlay:!0,loop:!0,muted:!0})}),o("div",{className:"form",children:[o("div",{className:"item",children:[e("div",{className:"label",children:s("APPS.TIKTOK.CAPTION")}),e(ue,{defaultValue:i.caption,placeholder:s("APPS.TIKTOK.CAPTION_PLACEHOLDER"),type:"text",maxLength:100,onChange:k=>{if(k.target.value.length<=100)return P({...i,caption:k.target.value})}})]}),o("div",{className:"item",children:[o("div",{className:"label",children:[s("APPS.TIKTOK.TTS")," ",o("span",{children:["(",s("APPS.TIKTOK.OPTIONAL"),")"]})]}),e($e,{defaultValue:(I=i==null?void 0:i.metadata)==null?void 0:I.tts,placeholder:s("APPS.TIKTOK.TTS_PLACEHOLDER"),maxLength:300,onChange:k=>{if(k.target.value.length<=300)return P({...i,metadata:{...i.metadata,tts:k.target.value}})}}),((b=i==null?void 0:i.metadata)==null?void 0:b.tts)&&e("select",{onChange:k=>n(k.target.value),children:(O=(U=he)==null?void 0:U.value.TikTokTTS)==null?void 0:O.map(k=>e("option",{value:k[1],selected:k[1]===S,children:k[0]}))})]}),o("div",{className:"item",children:[o("div",{className:"label",children:[s("APPS.TIKTOK.MUSIC")," ",o("span",{children:["(",s("APPS.TIKTOK.OPTIONAL"),")"]})]}),o("div",{className:"button",onClick:()=>W.MusicSelector.set({onSelect:k=>P({...i,music:{...i.music,...k}})}),children:[i.music?i.music.title:s("APPS.TIKTOK.SELECT_MUSIC"),e(we,{onClick:k=>{k.stopPropagation(),P({...i,music:null})}})]}),((F=i.music)==null?void 0:F.title)&&o("div",{className:"slider",children:[e(lt,{}),e(Ct,{min:0,max:.5,step:.025,value:i.music.volume!==void 0?i.music.volume:.25,onChange:k=>P({...i,music:{...i.music,volume:k}})}),e(rt,{})]})]})]})]}),g===2&&e("div",{className:"preview",children:e(ke,{data:{...i,timestamp:new Date().getTime(),id:"preview",likes:0,comments:0,saves:0,username:h.username,avatar:Z(h.avatar),verified:h.verified,music:i.music},active:!0,preview:!0})})]})]})]})}const Mt=async(t,u,h)=>{const p=await fetch(t,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({text:u,voice:h})});if(!p.ok)throw new Error(`Fetch error: ${p.status} ${p.statusText}`);return p.json()},xt=async(t,u)=>{const h=await Mt("https://tiktok-tts.weilnet.workers.dev/api/generation",t,u);if(h.success&&h.data)return h.data;throw h},Gt=async(t,u)=>{try{const h=await xt(t,u),N=await(await fetch(`data:application/octet-stream;base64,${h}`)).arrayBuffer(),g=new Uint8Array(N),m=new Blob([g],{type:"audio/mp3"});return await ct("Audio",m)}catch(h){throw h}};function Bt(){const{View:t,User:u,Profile:h,FeedData:p}=l.useContext(B),[N,g]=u,[m,r]=t,[a,S]=h,[n,i]=p,P=[{value:"feed",label:s("APPS.TIKTOK.HOME"),activeIcon:e(dt,{}),icon:e(ut,{}),cb:()=>{r("feed"),i(null)}},{value:"discover",label:s("APPS.TIKTOK.DISCOVER"),activeIcon:e(mt,{}),icon:e(ft,{})},{value:"upload",label:s("APPS.TIKTOK.UPLOAD"),activeIcon:e(Le,{}),icon:e(Le,{})},{value:"inbox",label:s("APPS.TIKTOK.INBOX"),activeIcon:e(ht,{}),icon:e(Ve,{})},{value:"profile",label:s("APPS.TIKTOK.PROFILE"),activeIcon:e(vt,{}),icon:e(Tt,{}),cb:()=>{S(N),r("profile")}}];return e("div",{className:"tiktok-footer","data-feed":m==="feed",children:P.map((L,y)=>{let _=m===L.value;return o("div",{className:"item","data-active":_,onClick:()=>L.cb?L.cb():r(L.value),children:[_?L.activeIcon:L.icon,L.label]},y)})})}function Wt(){const{User:t,ShareComponent:u,View:h}=l.useContext(B),[p]=t,[N,g]=h,[m,r]=u,[a,S]=l.useState([]);l.useState(!1);const[n,i]=l.useState(m==null?void 0:m.pinned);return l.useEffect(()=>{E("TikTok",{action:"getRecentMessages"},{success:!0,channels:$.Messages}).then(P=>{if(!(P!=null&&P.success))return f("warning",P.error);S(P.channels.sort((L,y)=>y.timestamp-L.timestamp))})},[]),e("div",{className:"share-container",onClick:()=>r(null),children:o(oe.div,{...pe,className:"share-wrapper",onClick:P=>P.stopPropagation(),children:[e("div",{className:"share-header",children:s("APPS.TIKTOK.SHARE_TITLE")}),o("div",{className:"share-body",children:[e("div",{className:"friends",children:a.map(P=>e(Ht,{data:{username:P.username,name:P.name,avatar:P.avatar,verified:P.verified}}))}),o("div",{className:"options",children:[o("div",{className:"item",children:[e(Pt,{}),s("APPS.TIKTOK.REPORT")]}),p.username===(m==null?void 0:m.username)&&o(J,{children:[o("div",{className:"item",onClick:()=>{W.PopUp.set({title:s("APPS.TIKTOK.PIN_VIDEO_POPUP.TITLE"),description:s("APPS.TIKTOK.PIN_VIDEO_POPUP.DESCRIPTION").format({action:n?s("APPS.TIKTOK.UNPIN"):s("APPS.TIKTOK.PIN")}),buttons:[{title:s("APPS.TIKTOK.PIN_VIDEO_POPUP.CANCEL")},{title:s("APPS.TIKTOK.PIN_VIDEO_POPUP.PROCEED"),color:n?"red":null,cb:()=>{E("TikTok",{action:"togglePinnedVideo",id:m==null?void 0:m.id,toggle:!n},{success:!0}).then(P=>{if(P!=null&&P.success||f("warning",P.error),P!=null&&P.error&&P.error==="max_pinned")return W.PopUp.set({title:s("APPS.TIKTOK.MAX_PINNED_TITLE"),description:s("APPS.TIKTOK.MAX_PINNED_DESCRIPTION"),buttons:[{title:s("APPS.TIKTOK.OK")}]});i(!n)})}}]})},children:[e(gt,{}),n?s("APPS.TIKTOK.UNPIN_VIDEO"):s("APPS.TIKTOK.PIN_VIDEO")]}),o("div",{className:"item",onClick:()=>{W.PopUp.set({title:s("APPS.TIKTOK.DELETE_VIDEO_POPUP.TITLE"),description:s("APPS.TIKTOK.DELETE_VIDEO_POPUP.DESCRIPTION"),buttons:[{title:s("APPS.TIKTOK.DELETE_VIDEO_POPUP.CANCEL")},{title:s("APPS.TIKTOK.DELETE_VIDEO_POPUP.PROCEED"),color:"red",cb:()=>{E("TikTok",{action:"deleteVideo",id:m==null?void 0:m.id},{success:!0}).then(P=>{P!=null&&P.success||f("warning",P.error),r(null),g("profile")})}}]})},children:[e(pt,{}),s("APPS.TIKTOK.DELETE")]})]})]})]}),e("div",{className:"share-footer",onClick:()=>r(null),children:s("APPS.TIKTOK.CANCEL")})]})})}const Ht=t=>{const{ShareComponent:u}=l.useContext(B),[h]=u,[p,N]=l.useState(!1);return o("div",{className:"item","data-sent":p,onClick:()=>{if(p)return f("warning","You have already sent this video to this user!");E("TikTok",{action:"sendMessage",data:{username:t.data.username,content:`<!SHARED-VIDEO-URL="${h.src}"ID="${h.id}"!>`}},{success:!0}).then(m=>{if(!(m!=null&&m.success))return f("warning",m.error);f("info","Successfully sent video to user!"),N(!0)})},children:[e("img",{src:Z(t.data.avatar)}),e("div",{className:"name",children:t.data.name}),p&&e(be,{className:"checkmark"})]})};function $t(){const{UserPanel:t}=l.useContext(B),[u,h]=t,[p,N]=l.useState([]),[g,m]=l.useState(u==null?void 0:u.value),r={following:"getFollowing",followers:"getFollowers"},a={following:s("APPS.TIKTOK.FOLLOWING"),followers:s("APPS.TIKTOK.FOLLOWERS")},S=(i,P)=>{var y,_;return(i===s("APPS.TIKTOK.FOLLOWING")?(y=$.Accounts[P])==null?void 0:y.following:((_=$.Accounts[P])==null?void 0:_.followers)??[]).map(d=>$.Accounts[d])};l.useEffect(()=>{!u||!(u!=null&&u.value)||g&&E("TikTok",{action:r[g],username:u.username,page:0},S(r[g],u.username)).then(i=>{if(!i)return f("warning","No data returned from tiktok event");N(i)})},[g]);const{handleScroll:n}=Se({fetchData:i=>E("TikTok",{action:r[u.value],username:u.username,page:i}),onDataFetched:i=>N([...p,...i]),perPage:15});return o(oe.div,{...pe,className:"userpanel-container",children:[o("div",{className:"userpanel-header",children:[e("div",{onClick:()=>h(null),children:e(ve,{})}),e("div",{className:"title",children:u==null?void 0:u.username}),e("div",{})]}),e("div",{className:"userpanel-selector",children:["following","followers"].map(i=>o("div",{className:"item","data-active":g===i,onClick:()=>m(i),children:[a[i]," ",z(u==null?void 0:u[i])??0]}))}),e("div",{className:"userpanel-content",onScroll:n,children:p.map((i,P)=>e(Zt,{data:i}))})]})}const Zt=({data:t})=>{const{Func:u,UserPanel:h}=l.useContext(B),[p,N]=h,[g,m]=l.useState(t.isFollowing),r=a=>{E("TikTok",{action:"toggleFollow",data:{username:t.username,follow:a}}).then(S=>{if(!S||!(S!=null&&S.success))return f("warning","Failed to toggle follow");if(S.error)return f("error",S.error);m(a)})};return o("div",{className:"item",onClick:()=>{u.fetchAndSetProfile(t.username),N(null)},children:[o("div",{className:"item-user",children:[e("div",{className:"avatar",children:e("img",{src:Z(t.avatar)})}),o("div",{className:"user",children:[o("div",{className:"name",children:[t.name," ",t.verified&&e(me,{})]}),e("div",{className:"username",children:t.username})]})]}),e("div",{className:"action",children:e("div",{className:le("button",g?"following":"follow"),onClick:a=>{a.stopPropagation(),g?W.PopUp.set({title:s("APPS.TIKTOK.UNFOLLOW_POPUP.TITLE"),description:s("APPS.TIKTOK.UNFOLLOW_POPUP.DESCRIPTION").format({name:t.name}),buttons:[{title:s("APPS.TIKTOK.UNFOLLOW_POPUP.CANCEL")},{title:s("APPS.TIKTOK.UNFOLLOW_POPUP.PROCEED"),color:"red",cb:()=>r(!1)}]}):r(!0)},children:g?s("APPS.TIKTOK.UNFOLLOW"):s("APPS.TIKTOK.FOLLOW")})})]})};const B=l.createContext(null);function Jt(){const t=fe(ce.Settings),[u,h]=l.useState(null),[p,N]=l.useState("feed"),[g,m]=l.useState(null),[r,a]=l.useState(null),[S,n]=l.useState(null),[i,P]=l.useState(null),[L,y]=l.useState(null),[_,d]=l.useState(null),[v,I]=l.useState(!1),[b,U]=l.useState(null),[O,F]=l.useState(!0),[k,w]=l.useState(!0);l.useEffect(()=>{E("isAdmin",null,!1).then(R=>{if(ne.APPS.TIKTOK.account.value){h({...ne.APPS.TIKTOK.account.value,isAdmin:R}),I(!0),F(!1);return}else if(ne.APPS.TIKTOK.account.value===!1)return F(!1);E("TikTok",{action:"isLoggedIn"},$.Account).then(x=>{x?(ne.APPS.TIKTOK.account.set(x),h({...x,isAdmin:R}),I(!0),F(!1)):(ne.APPS.TIKTOK.account.set(!1),F(!1))})})},[]),l.useEffect(()=>{p==="feed"&&g||p==="profile"&&(g==null?void 0:g.username)!==u.username?w(!1):w(!0)},[g]);const K={profile:e(Ft,{}),video:e(ke,{}),discover:e(Nt,{}),inbox:e(Kt,{}),messages:e(wt,{}),dm:e(Lt,{}),upload:e(Vt,{}),feed:e(_e,{})},c=R=>{if(!R)return f("warning","Couldn't fetch profile (no username provided)");f("info",`Fetching profile ${R}`),E("TikTok",{action:"getProfile",username:R},$.Accounts.find(x=>x.username===R)).then(x=>{if(!x)return f("warning","Couldn't fetch profile");m(x),N("profile")})},T=(R,x)=>{E("TikTok",{action:"getVideo",id:R},{video:$.Videos.find(G=>G.id===R)}).then(G=>{if(!G)return f("warning","Couldn't fetch video");if(G.error)return f("warning",G.error);if(!(G!=null&&G.video))return f("warning","Couldn't fetch video");y({video:G.video,args:x}),N("feed")})};return e(B.Provider,{value:{User:[u,h],View:[p,N],Profile:[g,m],LoggedIn:[v,I],FeedData:[L,y],UserPanel:[S,n],ShareComponent:[i,P],GoBack:[_,d],Video:[b,U],Dm:[r,a],Func:{fetchAndSetProfile:c,fetchAndSetVideo:T}},children:O||t!=null&&t.airplaneMode?e("div",{className:"loading",children:e(He,{size:40,lineWeight:5,speed:2,color:(t==null?void 0:t.display.theme)==="dark"?"#ffffff":"#000000"})}):e("div",{className:"tiktok-container","data-infeed":p==="feed",children:v===!0?o(J,{children:[o("div",{className:"tiktok-wrapper","data-profile":!k,children:[e(_e,{}),p!=="feed"&&e(oe.div,{...We(p=="discover"||p=="messages"?"right":"left",p),className:"tiktok-content",children:K==null?void 0:K[p]}),e(Pe,{children:S&&e($t,{})})]}),e(Pe,{children:i&&e(Wt,{})}),k&&e(Bt,{})]}):e(Dt,{})})})}const Z=t=>{var u;return t??`./assets/img/avatar-placeholder-${(u=ce.Settings.value)==null?void 0:u.display.theme}.svg`},Ce=t=>{if(!t)return;const u=new Date(t),p=new Date().getTime()-u.getTime(),N=Math.floor(p/(1e3*3600*24)),g=Math.floor(p/(1e3*3600)),m=Math.floor(p/(1e3*60)),r=Math.floor(p/1e3);return N>0?`${u.getMonth()+1}-${u.getDate()}`:g>0?`${g}h`:m>0?`${m}m`:r>0?`${r}s`:s("NOW")};function z(t){if(t<1e4)return t;if(t>=1e4&&t<1e6)return`${(t/1e3).toFixed(1)}K`;if(t>=1e6&&t<1e9)return`${(t/1e6).toFixed(1)}M`}export{B as TikTokContext,Jt as default,Ce as formatDate,z as formatNumber,Z as getAvatar};
