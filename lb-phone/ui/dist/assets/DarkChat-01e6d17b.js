import{u as R,r as C,s as r,p,q as D,j as s,m as _,S as M,a as t,L as e,aw as Z,C as E,aV as ee,b as W,am as te,an as ne,w as ae,$ as se,c4 as ie,aj as re,x as ce,P as y,E as j,_ as q,I as le,af as oe,A as Ae,a7 as me,ab as X,d as L,cu as de,a4 as he,K as ue,t as $,H as U}from"./index-e806e9b7.js";const b={username:"lb",channels:[{id:1,name:"guns",members:7,lastMessage:"i have a draco, 2k",sender:"kevin",timestamp:Date.now()-1e3*60*60*4},{id:2,name:"comics",members:134,lastMessage:"whats up, i found this really great comic the other day",sender:"anonymous943",timestamp:Date.now()-1e3*60*60*8},{id:3,name:"cars",members:23,lastMessage:"i have a 2019 mustang for sale",sender:"pirateking32",timestamp:Date.now()-1e3*60*60*12}],messages:{guns:[{content:"i have a draco, 2k",sender:"kevin",timestamp:Date.now()-1e3*60*60*4},{content:"yo, does anyone have any weapons for sale?",sender:"rya2n",timestamp:Date.now()-1e3*60*60*6},{content:"sup",sender:"lb",timestamp:Date.now()-1e3*60*60*17}],comics:[{content:"whats up, i found this really great comic the other day",sender:"anonymous943",timestamp:Date.now()-1e3*60*60*8},{content:"any good cominc recommendations?",sender:"yungblood",timestamp:Date.now()-1e3*60*60*10},{content:"just finished reading the new batman comic, its amazing",sender:"batmanfan123",timestamp:Date.now()-1e3*60*60*24}],cars:[{content:"i have a 2019 mustang for sale",sender:"pirateking32",timestamp:Date.now()-1e3*60*60*12},{content:"anyone know where i can get a good deal on a car?",sender:"anonymous",timestamp:Date.now()-1e3*60*60*14},{content:"i have a 2018 camaro for sale, 15k",sender:"camaroguy",timestamp:Date.now()-1e3*60*60*18},{content:"i have a 2017 mustang for sale, 10k",sender:"mustangguy",timestamp:Date.now()-1e3*60*60*20},{content:"looking for a quite new car in good condition for around 10k, anyone know where i can find one?",sender:"lb",timestamp:Date.now()-1e3*60*60*22}]}};function Pe(){var O,k;const a=R(h),l=R(S),[u,i]=C.useState(""),[g,A]=C.useState(""),T=R(y.Settings),m=R(r.APPS.DARKCHAT.channels);C.useEffect(()=>{r.APPS.DARKCHAT.channels.value||p("DarkChat",{action:"getChannels"},b.channels).then(c=>{if(!c)return D("warning","Failed to fetch channels");r.APPS.DARKCHAT.channels.set(c)})},[l]);const w=()=>{p("AccountSwitcher",{action:"getAccounts",app:"DarkChat"},null).then(c=>{var H;if(!c)return D("info","No accounts found");let N=(H=c==null?void 0:c.filter(v=>v!==l))==null?void 0:H.map(v=>({title:v,cb:()=>{p("AccountSwitcher",{action:"switch",app:"DarkChat",account:v}).then(()=>{S.set(v),r.APPS.DARKCHAT.username.set(v),r.APPS.DARKCHAT.channels.reset(),h.set("channels")})}}));E.ContextMenu.set({buttons:[{title:l},...N,{title:e("APPS.DARKCHAT.CHANGE_ACCOUNT"),cb:()=>{h.set("signup"),S.reset(),r.APPS.DARKCHAT.username.reset(),r.APPS.DARKCHAT.channels.reset()}},{title:e("APPS.MAIL.SIGN_OUT_POPUP.TITLE"),color:"red",cb:()=>{E.PopUp.set({title:e("APPS.MAIL.SIGN_OUT_POPUP.TITLE"),description:e("APPS.MAIL.SIGN_OUT_POPUP.DESCRIPTION"),buttons:[{title:e("APPS.MAIL.SIGN_OUT_POPUP.CANCEL")},{title:e("APPS.MAIL.SIGN_OUT_POPUP.PROCEED"),color:"red",cb:()=>{p("DarkChat",{action:"logout"},!0).then(v=>{if(!v)return D("warning","Failed to logout, success returned false");S.reset(),r.APPS.DARKCHAT.username.reset(),r.APPS.DARKCHAT.channels.reset(),h.set("signin")})}}]})}}]})})};return s(_.div,{...M("left",a,.2),className:"animation-container",children:[s("div",{className:"darkchat-header",children:[s("div",{className:"top",children:[t("div",{className:"title",children:e("APPS.DARKCHAT.TITLE")}),s("div",{className:"buttons",children:[t(Z,{onClick:()=>{l&&E.PopUp.set({title:e("APPS.DARKCHAT.NEW_ROOM"),description:e("APPS.DARKCHAT.NEW_ROOM_TEXT"),input:{placeholder:e("APPS.DARKCHAT.ROOM_CODE"),type:T!=null&&T.streamerMode?"password":"text",minCharacters:3,onChange:c=>A(c)},buttons:[{title:e("APPS.DARKCHAT.CANCEL")},{title:e("APPS.DARKCHAT.JOIN"),color:"blue",cb:()=>{A(c=>(p("DarkChat",{action:"joinChannel",channel:c},!b.channels.find(N=>N.name===c)&&{timestamp:Date.now(),name:c,members:Math.floor(Math.random()*100),lastMessage:"Welcome to the channel!",sender:"admin"}).then(N=>{if(!N)return D("warning","Failed to join channel");K.set(N),h.set("chat"),r.APPS.DARKCHAT.channels.set([N,...m])}),c))}}]})}}),t(ee,{className:"elipse",onClick:()=>{var c,N,H,v;E.ContextMenu.set({buttons:[{title:e("APPS.DARKCHAT.CHANGE_ACCOUNT"),cb:w},((N=(c=W)==null?void 0:c.value)==null?void 0:N.ChangePassword.DarkChat)&&{title:e("APPS.DARKCHAT.CHANGE_PASSWORD"),cb:()=>{setTimeout(()=>{te("DarkChat",()=>{})},250)}},((v=(H=W)==null?void 0:H.value)==null?void 0:v.DeleteAccount.DarkChat)&&{title:e("APPS.DARKCHAT.DELETE_ACCOUNT"),color:"red",cb:()=>{setTimeout(()=>{ne("DarkChat",()=>{S.reset(),r.APPS.DARKCHAT.username.set(null),r.APPS.DARKCHAT.channels.set(null),h.set("signin")})},250)}}]})}})]})]}),t(ae,{placeholder:e("APPS.DARKCHAT.SEARCH"),theme:"dark",onChange:c=>i(c.target.value)})]}),(m==null?void 0:m.length)===0&&s("div",{className:"no-channels",children:[t("div",{className:"title",children:e("APPS.DARKCHAT.NO_CHATS")}),t("div",{className:"description",children:e("APPS.DARKCHAT.NO_CHATS_TEXT")})]}),t("div",{className:"channels-body",children:(k=(O=m==null?void 0:m.sort((c,N)=>N.timestamp-c.timestamp))==null?void 0:O.filter(c=>c.name.toLowerCase().includes(u.toLowerCase())))==null?void 0:k.map(c=>t(Ce,{channel:c},c.id))})]})}const Ce=({channel:a})=>{const l=R(S),u=R(y.Settings),i=A=>/<!SENT-LOCATION-X=(-?\d*\.?\d*)Y=(-?\d*\.?\d*)!>/.test(A),g=se(A=>{E.ContextMenu.set({buttons:[{title:e("APPS.DARKCHAT.LEAVE_CHANNEL.TITLE"),color:"red",cb:()=>{E.PopUp.set({title:e("APPS.DARKCHAT.LEAVE_CHANNEL.TITLE"),description:e("APPS.DARKCHAT.LEAVE_CHANNEL.DESCRIPTION"),buttons:[{title:e("APPS.DARKCHAT.LEAVE_CHANNEL.CANCEL")},{title:e("APPS.DARKCHAT.LEAVE_CHANNEL.PROCEED"),cb:()=>{p("DarkChat",{action:"leaveChannel",channel:a.name},!0).then(T=>{if(!T)return D("warning","Failed to leave channel");h.set("channels"),K.set(null);let m=r.APPS.DARKCHAT.channels.value.filter(w=>w.name!==a.name);r.APPS.DARKCHAT.channels.set(m)})}}]})}}]})});return s("div",{...g,className:"channel",onClick:()=>{l&&(K.set(a),h.set("chat"))},children:[s("div",{className:"channel-info",children:[s("div",{className:"members",children:[t(ie,{}),t("span",{children:a.members})]}),s("div",{className:"channel-content",children:[t("div",{className:"channel-name",children:u.streamerMode?"*****":a.name}),a.lastMessage&&s("div",{className:"recent-message",children:[s("b",{children:[a.sender,":"]})," ",i(a.lastMessage)?e("APPS.MESSAGES.SENT_LOCATION_SHORT"):a.lastMessage]})]})]}),s("div",{className:"right",children:[t("div",{className:"timestamp",children:re(a.timestamp)}),t(ce,{})]})]})};function Se(){const a=R(y.Settings),l=R(K),u=R(S),i=R(h),[g,A]=C.useState([]),[T,m]=C.useState(""),w=C.useRef(null),O=C.useRef(0),[k,c]=C.useState(0),[N,H]=C.useState(!1),[v,G]=C.useState(!1);C.useEffect(()=>{var n;j("DarkChat")&&p("DarkChat",{action:"getMessages",channel:l.name,page:0},(n=b.messages)==null?void 0:n[l.name]).then(o=>{o&&o.length>0?(A(o.reverse()),o.length<15&&H(!0)):H(!0)})},[]);const Y=n=>{if(N||v)return;let o=document.querySelector("#last");if(!o)return;!ue(o)&&(G(!0),p("DarkChat",{action:"getMessages",channel:l.name,page:k+1},null).then(P=>{if(P&&(P==null?void 0:P.length)>0){let f=document.querySelector(".chat-wrapper");O.current=f.scrollHeight,A([...P.reverse(),...g]),G(!1),P.length<15&&H(!0)}else H(!0)}),c(P=>P+1))};C.useEffect(()=>{let n=document.querySelector(".chat-wrapper");const o=n.scrollHeight;n.scrollTop+=o-O.current,n.scroll},[g]);const x=()=>{if(T.length>0){let n={sender:u,content:T,timestamp:new Date().getTime()};p("DarkChat",{action:"sendMessage",content:T,channel:l.name},!0).then(()=>{m(""),w.current.value="",A([...g,n]);let o=r.APPS.DARKCHAT.channels.value.map(d=>(d.name===l.name&&(d.lastMessage=n.content,d.sender=u,d.timestamp=new Date().getTime()),d));r.APPS.DARKCHAT.channels.set(o)})}},B=()=>{E.PopUp.set({title:e("APPS.MESSAGES.SEND_LOCATION_POPUP.TITLE"),description:e("APPS.MESSAGES.SEND_LOCATION_POPUP.TEXT"),buttons:[{title:e("APPS.MESSAGES.SEND_LOCATION_POPUP.CANCEL")},{title:e("APPS.MESSAGES.SEND_LOCATION_POPUP.SEND"),cb:()=>{p("Maps",{action:"getCurrentLocation"},{x:"0",y:"0"}).then(n=>{if(!n)return;let o={content:`<!SENT-LOCATION-X=${$(n.x,2)}Y=${$(n.y,2)}!>`,sender:u,timestamp:new Date().getTime()};p("DarkChat",{action:"sendMessage",...o,channel:l.name},!0).then(d=>{if(d){A(f=>[...f,o]),m(""),w.current.value="";let P=r.APPS.DARKCHAT.channels.value.map(f=>(f.name===l.name&&(f.lastMessage=o.content,f.sender=u,f.timestamp=new Date().getTime()),f));r.APPS.DARKCHAT.channels.set(P)}else A(P=>[...P,{...o,delivered:!1}])})})}}]})};q("darkChat:newMessage",n=>{if(l.name!==n.channel||!j("DarkChat"))return;let o=r.APPS.DARKCHAT.channels.value.map(d=>(d.name===n.channel&&(d.lastMessage=n.content,d.sender=n.sender,d.timestamp=new Date().getTime()),d));r.APPS.DARKCHAT.channels.set(o),A([...g,{...n,timestamp:new Date().getTime()}])});const z=n=>{if(n)return/<!SENT-LOCATION-X=(-?\d*\.?\d*)Y=(-?\d*\.?\d*)!>/.test(n)};return s(_.div,{...M("right",i,.2),className:"animation-container",children:[t("div",{className:"darkchat-header chat",children:s("div",{className:"top",children:[t(le,{onClick:()=>{h.set("channels"),K.set(null)}}),s("div",{className:"content",children:[t("div",{className:"title",children:a.streamerMode?"*****":l.name}),s("div",{className:"members",children:[l.members," ",l.members===1?e("APPS.DARKCHAT.MEMBER"):e("APPS.DARKCHAT.MEMBERS")]})]}),t(oe,{onClick:()=>{E.PopUp.set({title:e("APPS.DARKCHAT.LEAVE_ROOM"),description:e("APPS.DARKCHAT.LEAVE_ROOM_TEXT"),buttons:[{title:e("APPS.DARKCHAT.CANCEL")},{title:e("APPS.DARKCHAT.LEAVE"),color:"red",cb:()=>{p("DarkChat",{action:"leaveChannel",channel:l.name},!0).then(n=>{if(!n)return D("warning","Failed to leave channel");h.set("channels"),K.set(null);let o=r.APPS.DARKCHAT.channels.value.filter(d=>d.name!==l.name);r.APPS.DARKCHAT.channels.set(o)})}}]})}})]})}),t("div",{className:"chat-wrapper",onScroll:Y,children:t("div",{className:"chat-body",children:g.map((n,o)=>{var F;let d,P=null,f=o===0?"last":"",I=n.sender===u?"self":"other",V=((F=g[o+1])==null?void 0:F.sender)===u?"self":"other";if(g[o+1]?d=Math.abs(n.timestamp-g[o+1].timestamp)/36e5:V=void 0,z(n.content)){let J=n.content.match(/X=(-?\d*\.?\d*)Y/)[1],Q=n.content.match(/Y=(-?\d*\.?\d*)!>/)[1];P={x:J,y:Q}}return s("div",{className:`message ${I}`,id:f,children:[P?t("div",{className:"location",onClick:()=>{Ae.patch({active:{name:"Maps",data:{location:[P.y,P.x],name:`${n.sender}'s location`}}})},children:t("div",{className:"img",style:{backgroundImage:'url("https://img.gta5-mods.com/q95/images/mirror-park-garden/2b72f9-20160428154103_1.jpg")'}})}):t("div",{className:"content",children:me(n.content)}),g[o+1]&&d>6?s("div",{className:"date",children:[I=="other"&&t("div",{className:"user",children:n.sender}),X(n.timestamp)]}):I!==V&&s("div",{className:"date",children:[I=="other"&&t("div",{className:"user",children:n.sender}),X(n.timestamp)]})]},o)})})}),t("div",{className:"chat-bottom",children:s("div",{className:"input",children:[t(L,{type:"text",placeholder:e("APPS.DARKCHAT.INPUT_PLACEHOLDER"),value:T,ref:w,onChange:n=>m(n.target.value),onKeyDown:n=>{if(n.key==="Enter")return x()}}),s("div",{className:"buttons",children:[t("div",{className:"location",children:t(de,{onClick:B})}),T.length>0&&t("div",{className:"send",onClick:x,children:t(he,{})})]})]})})]})}function pe(){const[a,l]=C.useState({username:"",password:""}),u=()=>{p("DarkChat",{action:"login",username:a.username,password:a.password},{success:!0}).then(i=>{i&&i.success?(S.set(a.username),r.APPS.DARKCHAT.username.set(a.username),h.set("channels")):i&&i.reason&&(D("error",i.reason),E.PopUp.set({title:e("APPS.DARKCHAT.ERROR"),description:e(`APPS.DARKCHAT.${i.reason.toUpperCase()}`),buttons:[{title:e("APPS.DARKCHAT.OK")}]}))})};return t(_.div,{...M("right","signin",.2),className:"animation-container",children:s("div",{className:"form",children:[t("div",{className:"form-header",children:t("div",{className:"title",children:e("APPS.DARKCHAT.LOGIN")})}),s("div",{className:"form-content",children:[s("div",{className:"item",children:[t("div",{className:"title",children:e("APPS.DARKCHAT.USERNAME")}),t("div",{className:"input",children:t(L,{type:"text",placeholder:"anonymous",maxLength:50,onChange:i=>{l({...a,username:i.target.value.toLowerCase()})}})})]}),s("div",{className:"item",children:[t("div",{className:"title",children:e("APPS.DARKCHAT.PASSWORD")}),t("div",{className:"input",children:t(L,{type:"password",placeholder:"••••••••••",minLength:3,onChange:i=>{l({...a,password:i.target.value})}})})]}),t("div",{className:"button",onClick:()=>u(),children:e("APPS.DARKCHAT.LOGIN")})]}),s("div",{className:"footer",children:[e("APPS.DARKCHAT.NO_ACCOUNT")," ",t("span",{onClick:()=>h.set("signup"),children:e("APPS.DARKCHAT.SIGN_UP")})]})]})})}function De(){const[a,l]=C.useState({username:"",password:""}),u=()=>{if(a.username===""||a.password==="")return D("warning","Username or password is empty");p("DarkChat",{action:"register",username:a.username,password:a.password},{success:!0}).then(i=>{if(!i)return D("warning","Darkchat response is null");if(i&&i.success)D("info","Account created successfully"),S.set(a.username),r.APPS.DARKCHAT.username.set(a.username),h.set("channels");else if(i&&i.reason){D("warning",i.reason),E.PopUp.set({title:e("APPS.DARKCHAT.ERROR"),description:e(`APPS.DARKCHAT.${i.reason.toUpperCase()}`),buttons:[{title:e("APPS.DARKCHAT.OK")}]});return}})};return t(_.div,{...M("left","signup",.2),className:"animation-container",children:s("div",{className:"form",children:[t("div",{className:"form-header",children:t("div",{className:"title",children:e("APPS.DARKCHAT.SIGN_UP")})}),s("div",{className:"form-content",children:[s("div",{className:"item",children:[t("div",{className:"title",children:e("APPS.DARKCHAT.USERNAME")}),t("div",{className:"input",children:t(L,{type:"text",placeholder:"anonymous",maxLength:50,onChange:i=>{l({...a,username:i.target.value.toLowerCase()})}})})]}),s("div",{className:"item",children:[t("div",{className:"title",children:e("APPS.DARKCHAT.PASSWORD")}),t("div",{className:"input",children:t(L,{type:"password",placeholder:"••••••••••",minLength:3,onChange:i=>{l({...a,password:i.target.value})}})})]}),t("div",{className:"button",onClick:()=>u(),children:e("APPS.DARKCHAT.SIGN_UP")})]}),s("div",{className:"footer",children:[e("APPS.DARKCHAT.ALREADY_HAVE")," ",t("span",{onClick:()=>h.set("signin"),children:e("APPS.DARKCHAT.LOGIN")})]})]})})}const ge={channels:t(Pe,{}),chat:t(Se,{}),signin:t(pe,{}),signup:t(De,{})},h=U("signup"),K=U(null),S=U(null);function Ne(){const a=R(h),[l,u]=C.useState(""),[i,g]=C.useState(!0);return C.useEffect(()=>{if(r.APPS.DARKCHAT.username.value){S.set(r.APPS.DARKCHAT.username.value),g(!1);return}p("DarkChat",{action:"getUsername"},b.username).then(A=>{if(g(!1),!A||!(A!=null&&A.username))return D("warning","Darkchat response is null");S.set(A.username),r.APPS.DARKCHAT.username.set(A.username),A.password?h.set("channels"):E.PopUp.set({title:e("APPS.DARKCHAT.SET_PASSWORD_POPUP.TITLE"),description:e("APPS.DARKCHAT.SET_PASSWORD_POPUP.DESCRIPTION"),input:{type:"password",placeholder:e("APPS.DARKCHAT.SET_PASSWORD_POPUP.PLACEHOLDER"),minLength:3,maxLength:50,onChange:T=>u(T)},buttons:[{title:e("APPS.DARKCHAT.SET_PASSWORD_POPUP.TITLE"),cb:()=>{u(T=>(p("DarkChat",{action:"setPassword",password:T},{success:!0}).then(m=>{if(!m||m!=null&&m.reason)return D("error",m.reason);h.set("channels")}),""))}}]})})},[]),q("darkchat:logout",A=>{if(!A)return D("warning","No username provided to logout");if(!S.value)return D("warning","No username stored in cache to logout");if(A!==(S==null?void 0:S.value))return D("warning","Username provided does not match current logged in username, not logging out");S.set(null),h.set("signin"),r.APPS.DARKCHAT.username.set(null),r.APPS.DARKCHAT.channels.set(null)}),t("div",{className:"darkchat-container",children:!i&&ge[a]})}export{K as ActiveChannel,S as Username,h as View,Ne as default};
