import{r as l,u as p,j as i,m as U,S as G,a as t,I as pe,L as a,F as R,C as H,b as oe,P as g,g as W,c as se,d as F,e as K,f as V,A as J,h as he,i as Y,k as de,l as Se,n as Te,o as re,p as k,q as I,s as w,t as ce,v as Ee,w as be,x as ge,y as Le,z as fe,B as ye,D as le,E as me,G as Ie,H as ue,M as Pe,J as Ae,K as ke,N as He,O as _e,Q as we,R as Re,T as Ue,U as Me,V as De,W as Ve,X as xe}from"./index-646d6ab8.js";function Fe(){const{View:c,Contact:h}=l.useContext(z),n=p(g.Settings),v=p(g.PhoneNumber),[P,f]=l.useState(null),[u,A]=c,[e,r]=h,N=p(w.APPS.PHONE.contacts),[E,m]=l.useState(!1),[C,T]=l.useState(!1);l.useEffect(()=>f(e.number),[]);const O=()=>{k("Phone",{action:"removeContact",number:e.number},!0).then(d=>{if(!d)return I("warning","Failed to remove contact");w.APPS.PHONE.contacts.set(N.filter(s=>s.number!==e.number)),r(null),A("Contacts")})},_=()=>{k("Phone",{action:"toggleBlock",number:e.number,blocked:!e.blocked},!0).then(d=>{if(d===void 0)return I("warning","Failed to toggle block");r({...e,blocked:!e.blocked}),w.APPS.PHONE.contacts.set(N.map(s=>s.number===e.number?{...s,blocked:!s.blocked}:s))})},y=()=>{k("Phone",{action:"toggleFavourite",number:e.number,favourite:!e.favourite},!0).then(d=>{if(!d)return I("warning","Failed to toggle favourite");r({...e,favourite:!e.favourite}),w.APPS.PHONE.contacts.set(N.map(s=>s.number===e.number?{...s,favourite:!s.favourite}:s))})},B=()=>{if(!e.number||e.number.length===0)return A("Contacts");e.number===v?(g.Settings.patch({name:e.firstname,avatar:e.avatar??n.avatar,address:e.address,email:e.email}),k("setPhoneName",e.firstname),k("setSettings",g.Settings.value),m(d=>!d),w.APPS.PHONE.contacts.set(N.map(d=>d.number===e.number?{...d,...e}:d))):(e.lastname=e.lastname??"",k("Phone",{action:"updateContact",data:{...e,oldNumber:P}},!0).then(d=>{if(!d)return I("warning","Failed to update contact");w.APPS.PHONE.contacts.set(N.map(s=>s.number===P?{...s,...e}:s)),m(s=>!s),f(e.number)}))},X=()=>{e&&H.PopUp.set({title:a("APPS.MESSAGES.SEND_LOCATION_POPUP.TITLE"),description:a("APPS.MESSAGES.SEND_LOCATION_POPUP.TEXT"),buttons:[{title:a("APPS.MESSAGES.SEND_LOCATION_POPUP.CANCEL")},{title:a("APPS.MESSAGES.SEND_LOCATION_POPUP.SEND"),cb:()=>{k("Maps",{action:"getCurrentLocation"},{x:"0",y:"0"}).then(d=>{d&&k("Messages",{action:"sendMessage",number:e.number,content:`<!SENT-LOCATION-X=${ce(d.x,2)}Y=${ce(d.y,2)}!>`,attachments:[]}).then(s=>{if(!s)return I("warning","something went wrong while sending location");J.patch({active:{name:"Messages",data:{number:e.number,name:e.firstname&&K(e.firstname,e.lastname),avatar:e.avatar},view:"messages"}})})})}}]})},$=l.useRef(!0);return l.useEffect(()=>{$.current&&$.current&&(f(e.number),$.current=!1,T(e.number===v))},[e]),i(U.div,{...G("right","contact",.2),className:"animation-container",children:[t("div",{className:"contacts-header",children:i("div",{className:"items",children:[E?t("span",{}):i("div",{className:"back",onClick:()=>{A(e.from),r(null)},children:[t(pe,{}),a(`APPS.PHONE.${e.from.toUpperCase()}.TITLE`)]}),e.firstname&&!e.company&&t("span",{onClick:()=>{E?B():m(d=>!d)},children:E?a("APPS.PHONE.DONE"):a("APPS.PHONE.EDIT")})]})}),t("div",{className:"content",children:E?t(R,{children:i("div",{className:"contact nohover",children:[i("div",{className:"user",onClick:()=>{H.ContextMenu.set({buttons:[{title:a("APPS.PHONE.CONTACTS.CHANGE_AVATAR"),cb:()=>{var d,s,L;H.Gallery.set({allowExternal:(L=(s=(d=oe)==null?void 0:d.value)==null?void 0:s.AllowExternal)==null?void 0:L.Other,onSelect:b=>r({...e,avatar:b.src})})}},{title:a("APPS.PHONE.CONTACTS.REMOVE_AVATAR"),color:"red",cb:()=>{r({...e,avatar:null}),C&&g.Settings.set({...g.Settings.value,avatar:null})}}]})},children:[e.avatar||C&&n.avatar?t("div",{className:"avatar bigger",style:{backgroundImage:`url(${e.avatar??n.avatar})`}}):e.firstname?t("div",{className:"avatar bigger",children:W(e.firstname,e.lastname)}):t(se,{}),t("span",{children:a("APPS.PHONE.EDIT")})]}),i("div",{className:"contact-info",children:[t("div",{className:"item input",children:t(F,{type:"text",placeholder:a("APPS.PHONE.CONTACTS.FIRST_NAME"),value:e.firstname,onChange:d=>r({...e,firstname:d.target.value}),maxLength:20})}),!C&&t("div",{className:"item input",children:t(F,{type:"text",placeholder:a("APPS.PHONE.CONTACTS.LAST_NAME"),value:e.lastname??"",onChange:d=>r({...e,lastname:d.target.value}),maxLength:20})})]}),t("div",{className:"contact-info",children:t("div",{className:"item input",children:t(F,{className:"phone_number",type:"number",placeholder:a("APPS.PHONE.CONTACTS.PHONE_NUMBER"),defaultValue:e==null?void 0:e.number,maxLength:20,disabled:C,onChange:d=>{if(C)return;let s=d.target.value.slice(-1).charCodeAt(0);s>=48&&s<=57&&d.target.value.length<=10&&r({...e,number:d.target.value})}})})}),i("div",{className:"contact-info",children:[t("div",{className:"item input",children:t(F,{className:"phone_number",type:"email",placeholder:a("APPS.PHONE.CONTACTS.EMAIL"),defaultValue:C?n==null?void 0:n.email:e==null?void 0:e.email,maxLength:20,onChange:d=>{d.target.value.match(/^([\w.%+-]+)@([\w-]+\.)+([\w]{2,})$/i)&&(C?g.Settings.set({...g.Settings.value,email:d.target.value}):r({...e,email:d.target.value}))}})}),t("div",{className:"item input",children:t(F,{type:"text",placeholder:a("APPS.PHONE.CONTACTS.ADDRESS"),defaultValue:C?n==null?void 0:n.address:e==null?void 0:e.address,maxLength:20,onChange:d=>{C?g.Settings.set({...g.Settings.value,address:d.target.value}):r({...e,address:d.target.value})}})})]}),!C&&t("div",{className:"contact-info",children:t("div",{className:"item red",onClick:()=>{H.PopUp.set({title:a("APPS.PHONE.CONTACTS.REMOVE_CONTACT_TITLE"),description:a("APPS.PHONE.CONTACTS.REMOVE_CONTACT_TEXT"),buttons:[{title:a("APPS.PHONE.CONTACTS.REMOVE_CONTACT_BUTTON_CANCEL")},{title:a("APPS.PHONE.CONTACTS.REMOVE_CONTACT_BUTTON_DELETE"),color:"red",cb:O}]})},children:a("APPS.PHONE.CONTACTS.DELETE_CONTACT")})})]})}):t(R,{children:i("div",{className:"contact nohover details",children:[i("div",{className:"user",children:[e.avatar||C&&n.avatar?t("div",{className:"avatar bigger",style:{backgroundImage:`url(${C?n.avatar:e.avatar})`}}):e.firstname?t("div",{className:"avatar bigger",children:W(e.firstname,e.lastname)}):t(se,{}),t("div",{className:"name",children:e.firstname?K(e.firstname,e.lastname):V(e.number)})]}),i("div",{className:"actions",children:[i("div",{className:"item","data-disabled":!!(C||e.company),onClick:()=>{J.patch({active:{name:"Messages",data:{number:e.number,name:e.firstname&&K(e.firstname,e.lastname),avatar:e.avatar,view:"messages"}}})},children:[t(he,{}),a("APPS.PHONE.CONTACTS.MESSAGE")]}),i("div",{className:"item call","data-disabled":C,onClick:()=>{Y({number:e.number,company:e.company,companylabel:e.company&&e.firstname})},children:[t(de,{}),a("APPS.PHONE.CONTACTS.CALL")]}),i("div",{className:"item","data-disabled":!!(C||e.company),onClick:()=>{Y({number:e.number,company:e.company,companylabel:e.company&&e.firstname,videoCall:!0})},children:[t(Se,{}),a("APPS.PHONE.CONTACTS.VIDEO")]}),i("div",{className:"item","data-disabled":!!e.company,onClick:()=>{e.company||H.Share.set({type:"contact",data:{number:e.number,firstname:e.firstname,lastname:e.lastname,avatar:e.avatar||C&&n.avatar,email:e.email,address:e.address}})},children:[t(Te,{}),a("APPS.PHONE.CONTACTS.SHARE")]})]}),!e.company&&i(R,{children:[t("div",{className:"contact-info",children:t("div",{className:"item",onClick:()=>{re(e.number),H.PopUp.set({title:a("COMPONENTS.SHARE.COPY_POPUP.TITLE"),description:a("COMPONENTS.SHARE.COPY_POPUP.DESCRIPTION"),buttons:[{title:a("COMPONENTS.SHARE.COPY_POPUP.OK")}]})},children:t("div",{className:"value",children:V(e.number)})})}),(e.email||e.address)&&i("div",{className:"contact-info",children:[e.email&&i("div",{className:"item",onClick:()=>re(e.email),children:[t("div",{className:"title",children:a("APPS.PHONE.CONTACTS.EMAIL").toLowerCase()}),t("div",{className:"value",children:e.email})]}),e.address&&i("div",{className:"item",onClick:()=>re(e.address),children:[t("div",{className:"title",children:a("APPS.PHONE.CONTACTS.ADDRESS").toLowerCase()}),t("div",{className:"value",children:e.address})]})]}),t("div",{className:"contact-info",children:e.firstname?t(R,{children:!C&&i(R,{children:[t("div",{className:"item",onClick:()=>X(),children:a("APPS.PHONE.CONTACTS.SHARE_LOCATION")}),e.favourite?t("div",{className:"item red",onClick:()=>y(),children:a("APPS.PHONE.CONTACTS.REMOVE_FAVORITE")}):t("div",{className:"item",onClick:()=>y(),children:a("APPS.PHONE.CONTACTS.ADD_FAVORITE")}),e.blocked?t("div",{className:"item red",onClick:()=>{H.PopUp.set({title:a("APPS.PHONE.CONTACTS.UNBLOCK_NUMBER_TITLE"),description:a("APPS.PHONE.CONTACTS.UNBLOCK_NUMBER_TEXT").format({number:V(e.number)}),buttons:[{title:a("APPS.PHONE.CONTACTS.UNBLOCK_NUMBER_BUTTON_CANCEL")},{title:a("APPS.PHONE.CONTACTS.UNBLOCK_NUMBER_BUTTON_UNBLOCK"),cb:()=>_()}]})},children:a("APPS.PHONE.CONTACTS.UNBLOCK_CALLER")}):t("div",{className:"item red",onClick:()=>{H.PopUp.set({title:a("APPS.PHONE.CONTACTS.BLOCK_NUMBER_TITLE"),description:a("APPS.PHONE.CONTACTS.BLOCK_NUMBER_TEXT").format({number:V(e.number)}),buttons:[{title:a("APPS.PHONE.CONTACTS.BLOCK_NUMBER_BUTTON_CANCEL")},{title:a("APPS.PHONE.CONTACTS.BLOCK_NUMBER_BUTTON_BLOCK"),color:"red",cb:()=>{_()}}]})},children:a("APPS.PHONE.CONTACTS.BLOCK_CALLER")})]})}):t("div",{className:"item",onClick:()=>A("NewContact"),children:a("APPS.PHONE.CONTACTS.ADD_CONTACT")})})]})]})})})]})}function Be(){const{View:c,viewContact:h}=l.useContext(z),n=p(g.Settings),[v,P]=c,f=p(g.PhoneNumber),u=p(w.APPS.PHONE.contacts),[A,e]=l.useState("");return i(U.div,{...G("left","contacts",.2),className:"animation-container",children:[i("div",{className:"contacts-header",children:[i("div",{className:"items",children:[t("div",{className:"title",children:a("APPS.PHONE.CONTACTS.TITLE")}),t(Ee,{onClick:()=>P("NewContact")})]}),t(be,{placeholder:a("SEARCH"),onChange:r=>e(r.target.value)})]}),t("div",{className:"content",children:i("div",{className:"contact-list",children:[t("div",{className:"letters",children:[...Array(26)].map((r,N)=>{let E=String.fromCharCode(N+65);return t("a",{children:E},N)})}),t("div",{className:"contact card",onClick:()=>h({firstname:n==null?void 0:n.name,number:f},"Contacts"),children:i("div",{className:"profile",children:[n.avatar?t("div",{className:"avatar",style:{backgroundImage:`url(${n.avatar})`}}):t("div",{className:"avatar",children:W(n==null?void 0:n.name)}),i("div",{className:"profile-info",children:[t("div",{className:"name",children:n==null?void 0:n.name}),t("div",{className:"info",children:a("APPS.PHONE.CONTACTS.MY_CARD")})]}),t(ge,{})]})}),u&&i(R,{children:[Object.entries(u.filter(r=>K(r.firstname,r.lastname).toLowerCase().includes(A.toLowerCase())).sort((r,N)=>r.firstname.localeCompare(N.firstname)).reduce((r,N)=>{let E=N.firstname.charAt(0).toUpperCase();return r[E]||(r[E]=[]),r[E].push(N),r},{})).map(([r,N],E)=>i("div",{children:[t("div",{id:r,className:`divider ${E===0?"no-border":""}`,children:r}),t(U.div,{initial:{opacity:0,scale:.9},whileInView:{opacity:1,scale:1},viewport:{once:!0},className:"contacts",children:N.map((m,C)=>i("div",{className:"contact item border",onClick:()=>h(m,"Contacts"),children:[m.avatar?t("div",{className:"avatar",style:{backgroundImage:`url(${m.avatar})`}}):t("div",{className:"avatar",children:W(m.firstname,m.lastname)}),i("div",{className:"details",children:[t("div",{className:"name",children:K(m.firstname,m.lastname)}),t("div",{className:"phone-number",children:V(m.number)})]})]},C))})]},E)),i("div",{className:"total-contacts",children:[u.length," ",a("APPS.PHONE.CONTACTS.TITLE")]})]})]})})]})}function $e(){const{viewContact:c}=l.useContext(z),h=p(w.APPS.PHONE.contacts),[n,v]=l.useState(!1);return i(U.div,{...G("left","favourites",.2),className:"animation-container",children:[t("div",{className:"contacts-header",children:i("div",{className:"items",children:[t("div",{className:"title",children:a("APPS.PHONE.FAVOURITES.TITLE")}),t("span",{onClick:()=>v(!n),children:n?a("APPS.PHONE.DONE"):a("APPS.PHONE.EDIT")})]})}),t("div",{className:"content",children:t("div",{className:"favourite",children:h.filter(P=>P.favourite||P.company).sort((P,f)=>P.company?-1:1).map((P,f)=>{let u=K(P.firstname,P.lastname);return i(U.div,{initial:{opacity:0,scale:.9},whileInView:{opacity:1,scale:1},viewport:{once:!0},className:"item",onClick:()=>{H.PopUp.set({title:a("APPS.PHONE.CALL.CALL_TITLE").format({name:u}),description:a("APPS.PHONE.CALL.CALL_TEXT").format({name:u}),buttons:[{title:a("APPS.PHONE.CALL.CALL_BUTTON_CANCEL")},{title:a("APPS.PHONE.CALL.CALL_BUTTON_CALL"),cb:()=>{Y({number:P.number,company:P.company,companylabel:P.firstname})}}]})},children:[i("div",{className:"user",children:[n&&!P.company&&t(Le,{onClick:A=>{A.stopPropagation(),H.PopUp.set({title:a("APPS.PHONE.FAVOURITES.REMOVE_TITLE"),description:a("APPS.PHONE.FAVOURITES.REMOVE_TEXT"),buttons:[{title:a("APPS.PHONE.FAVOURITES.REMOVE_BUTTON_CANCEL")},{title:a("APPS.PHONE.FAVOURITES.REMOVE_BUTTON_REMOVE"),color:"red",cb:()=>{k("Phone",{action:"toggleFavourite",number:P.number,favourite:!1},!0).then(e=>{if(!e)return I("warning","Failed to remove favourite");w.APPS.PHONE.contacts.set(h.map(r=>r.number===P.number?{...r,favourite:!r.favourite}:r))})}}]})}}),P.avatar?t("div",{className:"avatar",style:{backgroundImage:`url(${P.avatar})`}}):t("div",{className:"avatar",children:W(P.firstname,P.lastname)}),i("div",{className:"info",children:[u,t("span",{children:V(P.number)})]})]}),t(fe,{onClick:A=>{A.stopPropagation(),c(P,"Favourites")}})]},f)})})})]})}const M=[697,770,852,941],D=[1209,1336,1477,1633],ve={1:[M[0],D[0]],2:[M[0],D[1]],3:[M[0],D[2]],4:[M[1],D[0]],5:[M[1],D[1]],6:[M[1],D[2]],7:[M[2],D[0]],8:[M[2],D[1]],9:[M[2],D[2]],"*":[M[3],D[0]],0:[M[3],D[1]],"#":[M[3],D[2]]},Ke=[{key:"1",letters:""},{key:"2",letters:"ABC"},{key:"3",letters:"DEF"},{key:"4",letters:"GHI"},{key:"5",letters:"JKL"},{key:"6",letters:"MNO"},{key:"7",letters:"PQRS"},{key:"8",letters:"TUV"},{key:"9",letters:"WXYZ"},{key:"*",letters:""},{key:"0",letters:"+"},{key:"#",letters:""}],ae={0:2.5,12:2,17:1.75};function Ge(){const c=p(g.Settings),h=p(g.CallData),n=p(J),{View:v,Contact:P,viewContact:f}=l.useContext(z),[u,A]=v,[e,r]=P,[N,E]=l.useState(null),[m,C]=l.useState(""),T=l.useRef(null),O=l.useRef([]),_=l.useRef(null),y=l.useRef(null),B=l.useRef(!0),[X,$]=l.useState(2.5);l.useEffect(()=>{var o;if(!T.current&&((o=n==null?void 0:n.active)==null?void 0:o.name)==="Phone")return T.current=new AudioContext,()=>{T.current&&(s(),T.current.close(),T.current=null)}},[n==null?void 0:n.active]),l.useEffect(()=>{var o;B.current=!!(((o=n==null?void 0:n.active)==null?void 0:o.name)==="Phone"&&(!h||h!=null&&h.banner))},[n==null?void 0:n.active,h]),l.useEffect(()=>{document.addEventListener("keydown",b),document.addEventListener("keyup",x),m==="0"&&$(2.5);let o=0;for(let S=0;S<Object.keys(ae).length;S++)m.length>=parseInt(Object.keys(ae)[S])&&(o=ae[Object.keys(ae)[S]]);return $(o),()=>{document.removeEventListener("keydown",b),document.removeEventListener("keyup",x)}},[m]);const d=o=>{var Ne;if(!T.current)return;const S=T.current,[Q,j]=ve[o],ie="sine",Z=S.createOscillator();Z.frequency.value=Q,Z.type=ie;const ee=S.createOscillator();ee.frequency.value=j,ee.type=ie;const te=S.createGain();te.gain.value=.2*(((Ne=c==null?void 0:c.sound)==null?void 0:Ne.volume)!==void 0?c.sound.volume:.5),Z.connect(te),ee.connect(te),te.connect(S.destination),Z.start(),ee.start();const Oe=setTimeout(()=>{s()},1500);O.current.push([Z,ee,te,Oe])},s=()=>{O.current.forEach(([o,S,Q,j])=>{clearTimeout(j),T.current&&(o.stop(),S.stop(),o.disconnect(),S.disconnect(),Q.disconnect())}),_.current=null,O.current=[]},L=o=>{B.current&&(o=="delete"?C(S=>S.slice(0,-1)):o.match(/^[0-9]+$/)&&C(S=>S+o),ve[o]&&(_.current&&s(),_.current=o,d(o)))},b=o=>{_.current||o.repeat||(o.key.match(/^[0-9]+$/)?(_.current=o.key,L(o.key)):o.key==="Backspace"?L("delete"):o.key==="Enter"&&m.length>=3&&Y({number:m}))},x=o=>{o.key===_.current&&s()};return l.useEffect(()=>{if(m.length!==ye())return E(null);E(le(m))},[m]),i(U.div,{...G("left","keypad",.2),className:"animation-container",children:[t("div",{className:"contacts-header",children:i("div",{className:"items",children:[t("div",{className:"title",children:a("APPS.PHONE.KEYPAD.TITLE")}),t(Ee,{onClick:()=>{if(C(""),N)f(N,"Keypad");else{let o=le(m);o?(r({...o,number:m}),A("NewContact")):(r({number:m}),A("NewContact"))}}})]})}),t("div",{className:"content noscroll",children:i("div",{className:"keypad-container",children:[t("div",{className:"inputbox",children:t("div",{className:"input",style:{fontSize:`${X}rem`},children:V(m)})}),t("div",{className:"keypad-wrapper",children:i("div",{className:"keypad",children:[Ke.map(o=>i("div",{onMouseDown:()=>L(o.key),onMouseUp:()=>s(),children:[o.key,o.letters&&t("span",{children:o.letters})]},o.key)),t("span",{}),t("div",{className:"call",onClick:()=>{m.length>=3&&Y({number:m})},children:t(de,{})}),t("div",{className:"delete",onMouseDown:()=>{if(!me("Phone"))return;L("delete"),y.current&&clearInterval(y.current);const o=setInterval(()=>{L("delete")},100);y.current=o},onMouseUp:()=>{y.current&&(clearInterval(y.current),y.current=null)},children:t(Ie,{})})]})})]})})]})}function Xe(){const{View:c,Contact:h}=l.useContext(z),n=p(g.PhoneNumber),[v]=h,[P,f]=c,u=p(w.APPS.PHONE.contacts),A=p(g.Settings),[e,r]=l.useState(null),[N,E]=l.useState(!1);l.useEffect(()=>{g.Styles.TextColor.set(A.display.theme=="dark"?"#ffffff":"#000000")},[]),l.useEffect(()=>{v&&v.number&&r({...e,number:v.number})},[v]),l.useEffect(()=>{e&&E(e.firstname&&e.number!==void 0)},[e]);const m=()=>{if(e){if(!e.number||(e==null?void 0:e.number)===n)return f("Contacts");e.lastname=(e==null?void 0:e.lastname)??"",k("Phone",{action:"saveContact",data:e},!0).then(C=>{if(!C)return I("warning","Failed to save contact");w.APPS.PHONE.contacts.set([...u,e]),f("Contacts")})}};return i(U.div,{...G("up","newcontact",.2),className:"animation-container",children:[t("div",{className:"contacts-header",children:i("div",{className:"items",children:[t("div",{className:"back",onClick:()=>f("Contacts"),children:a("APPS.PHONE.CANCEL")}),t("span",{className:N?"":"disabled",onClick:()=>{N&&m()},children:a("APPS.PHONE.DONE")})]})}),t("div",{className:"content",children:t(R,{children:i("div",{className:"contact nohover",children:[t("div",{className:"user",onClick:()=>{var C,T,O;H.Gallery.set({allowExternal:(O=(T=(C=oe)==null?void 0:C.value)==null?void 0:T.AllowExternal)==null?void 0:O.Other,onSelect:_=>r({...e,avatar:_.src})})},children:e!=null&&e.avatar?i(R,{children:[t("div",{className:"profile-image bigger transparent",style:{backgroundImage:`url(${e.avatar})`}}),t("span",{children:a("APPS.PHONE.EDIT")})]}):i(R,{children:[t(se,{className:"big"}),t("span",{className:"add",children:a("APPS.PHONE.CONTACTS.ADD_PHOTO")})]})}),i("div",{className:"contact-info",children:[t("div",{className:"item input",children:t(F,{type:"text",placeholder:a("APPS.PHONE.CONTACTS.FIRST_NAME"),onChange:C=>r({...e,firstname:C.target.value}),maxLength:20})}),t("div",{className:"item input",children:t(F,{type:"text",placeholder:a("APPS.PHONE.CONTACTS.LAST_NAME"),onChange:C=>r({...e,lastname:C.target.value}),maxLength:20})})]}),t("div",{className:"contact-info",children:t("div",{className:"item input",children:t(F,{className:"phone_number",type:"number",placeholder:a("APPS.PHONE.CONTACTS.PHONE_NUMBER"),defaultValue:v==null?void 0:v.number,maxLength:15,onChange:C=>{let T=C.target.value.slice(-1).charCodeAt(0);T>=48&&T<=57&&r({...e,number:C.target.value})}})})})]})})})]})}const ne=ue([]).mock(Pe.RecentCalls);function je(){const{viewContact:c}=l.useContext(z),[h,n]=l.useState("all"),v=p(ne),P=["all","missed"];l.useEffect(()=>{k("Phone",{action:"getRecent",page:0,missed:h==="missed"},Pe.RecentCalls.filter(u=>h==="missed"?!u.answered:!0)).then(u=>{if(!u)return I("error","Failed to get recent calls");ne.set(u)})},[h]);const{handleScroll:f}=Ae({fetchData:u=>k("Phone",{action:"getRecent",missed:h==="missed",page:u}),onDataFetched:u=>ne.set([...ne.value,...u]),perPage:25});return i(U.div,{...G("left","recent",.2),className:"animation-container",children:[t("div",{className:"contacts-header",children:i("div",{className:"items col",children:[t("div",{className:"selector-container",children:t("div",{className:"selector",children:P.map((u,A)=>t("div",{className:"option","data-active":h===u,onClick:()=>n(u),children:a(`APPS.PHONE.RECENTS.${u.toUpperCase()}`)},A))})}),t("div",{className:"title",children:a("APPS.PHONE.RECENTS.TITLE")})]})}),t("div",{className:"content",onScroll:f,children:t(U.div,{...G(h==="all"?"left":"right",h,.2),className:"recent-calls",children:v.map((u,A)=>{var r,N,E;let e=le(u.number);return i(U.div,{initial:{opacity:0,scale:.9},whileInView:{opacity:1,scale:1},viewport:{once:!0},className:"item","data-missed":!u.called&&!u.answered?"true":"false",onClick:()=>{if(u.hideCallerId)return;let m;e!=null&&e.name?m=e.name:m=V(u.number),H.PopUp.set({title:a("APPS.PHONE.CALL.CALL_TITLE").format({name:m}),description:a("APPS.PHONE.CALL.CALL_TEXT").format({name:m}),buttons:[{title:a("APPS.PHONE.CALL.CALL_BUTTON_CANCEL")},{title:a("APPS.PHONE.CALL.CALL_BUTTON_CALL"),cb:()=>{Y({number:u.number})}}]})},children:[i("div",{className:"user",children:[u.hideCallerId?t("div",{className:"avatar",style:{backgroundImage:`url(./assets/img/avatar-placeholder-${(E=(N=(r=g)==null?void 0:r.Settings)==null?void 0:N.value)==null?void 0:E.display.theme}.svg)`}}):e!=null&&e.avatar?t("div",{className:"avatar",style:{backgroundImage:`url(${e==null?void 0:e.avatar})`}}):t("div",{className:"avatar",children:W(e==null?void 0:e.name)}),t("div",{className:"info",children:u.hideCallerId?i(R,{children:[a("APPS.PHONE.CALL.NO_CALLER_ID"),t("span",{children:a("APPS.PHONE.CALL.UNKNOWN")})]}):e!=null&&e.name?i(R,{children:[e.name,t("span",{children:V(u.number)})]}):i(R,{children:[V(u.number),t("span",{children:a("APPS.PHONE.CALL.UNKNOWN")})]})})]}),i("div",{className:"info",children:[t("div",{className:"date",children:ke(u.timestamp)}),t(fe,{onClick:m=>{if(m.stopPropagation(),u.hideCallerId)return I("info","Call info couldn't be loaded since user called with 'No Caller ID'");e!=null&&e.name?c({...e,number:u.number},"Recents"):c({...u},"Recents")}})]})]},A)})})})]})}const Ce=ue(null),q=ue([]);function Ye(){const c=p(q);l.useEffect(()=>{me("Phone")&&k("Phone",{action:"getVoiceMails",page:0},Pe.VoiceMails).then(n=>{if(!n)return I("error","Failed to get voicemails");I("info","Received voicemails",n),q.set(n)})},[]);const{handleScroll:h}=Ae({fetchData:n=>k("Phone",{action:"getVoiceMails",page:n}),onDataFetched:n=>q.set([...q.value,...n]),perPage:25});return i(U.div,{...G("left","voicemail",.2),className:"animation-container",children:[t("div",{className:"contacts-header",children:t("div",{className:"items",children:t("div",{className:"title",children:a("APPS.PHONE.VOICEMAIL.TITLE")})})}),t("div",{className:"content",onScroll:h,children:t("div",{className:"voicemails",children:c.map(n=>t(ze,{data:n},n.id))})})]})}const ze=({data:c})=>{const h=p(oe),n=p(g.Settings),v=l.useRef(null),[P,f]=l.useState(!1),[u,A]=l.useState(!1),[e,r]=l.useState(!1),[N,E]=l.useState(null),[m,C]=l.useState(0),T=p(Ce),[O,_]=l.useState(null),y=p(Ue),B=p(J);l.useEffect(()=>{var s;y!=null&&y.visible&&((s=v.current)==null||s.pause(),r(!1))},[y==null?void 0:y.visible,B==null?void 0:B.active]),l.useEffect(()=>{var L,b;v.current=new Audio(c.url),v.current.src=c.url,v.current.volume=((L=n==null?void 0:n.sound)==null?void 0:L.volume)!==void 0?n.sound.volume:.5,v.current.addEventListener("ended",()=>{r(!1)}),v.current.addEventListener("timeupdate",()=>{C(v.current.currentTime)});let s=(b=w.APPS.PHONE.contacts)==null?void 0:b.value;if(s&&c.number){let x=s.find(o=>o.number==c.number);x&&_(x)}return()=>{var x,o;(x=v.current)==null||x.pause(),(o=v.current)==null||o.remove(),v.current=null}},[]),l.useEffect(()=>{var s;T&&T!==c.id&&((s=v.current)==null||s.pause(),r(!1),f(!1))},[T]),l.useEffect(()=>{n.sound.volume&&(v.current.volume=n.sound.volume)},[n.sound.volume]),l.useEffect(()=>{var s;r(!1),C(0),(s=v.current)==null||s.pause(),v.current.currentTime=0,P&&Ce.set(c.id)},[P]);const X=s=>{s=s/1e3;const L=Math.floor(s/60),b=ce(s-L*60,0);return`${L}:${b<10?"0"+b:b}`},$=(s,L)=>{const b=new Date(s),x=b.getFullYear(),o=b.getMonth()+1,S=b.getDate(),Q=b.getHours(),j=b.getMinutes();return L?`${S} ${b.toLocaleDateString(h.DateLocale,{month:"long"})} ${x} ${a("APPS.PHONE.VOICEMAIL.AT")} ${Q}:${j<10?"0"+j:j}`:`${x}-${o<10?"0"+o:o}-${S<10?"0"+S:S}`},d={light:{active:"#333333",track:"#cccccc"},dark:{active:"#FFFFFF",track:"#999999"}};return t(U.div,{className:"voicemail-item",initial:{opacity:0,scale:.9},whileInView:{opacity:1,scale:1},viewport:{once:!0},onClick:()=>f(!P),"data-expanded":P,children:i("div",{className:"voicemail-info",children:[i("div",{className:"voicemail-row",children:[i("div",{className:"details",children:[t("div",{className:"voicemail-title",children:c.hideCallerId?a("APPS.PHONE.CALL.NO_CALLER_ID"):O?K(O==null?void 0:O.firstname,O==null?void 0:O.lastname):V(c.number)}),t("div",{className:"subtitle",children:$(c.timestamp,!0)})]}),!P&&t("div",{className:"info",children:t("div",{className:"duration",children:X(c.duration)})})]}),t(He,{children:P&&i(U.div,{className:"voicemail-actions",initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},children:[i("div",{className:"voicemail-duration-slider",onClick:s=>s.stopPropagation(),children:[t(F,{type:"range",min:0,max:100,value:N||m/c.duration*100,style:{background:`linear-gradient(to right, ${d[n.display.theme].active} 0%, ${d[n.display.theme].active} ${N||m/(c.duration/1e3)*100}%, ${d[n.display.theme].track} ${N||m/(c.duration/1e3)*100}%, ${d[n.display.theme].track} 100%)`},onMouseDown:s=>{me("Phone")&&(s.stopPropagation(),A(!0))},onMouseUp:s=>{if(s.stopPropagation(),A(!1),N){if(!v.current)return I("warning","Audio ref is null");v.current.currentTime=c.duration/1e3/100*N,E(null)}},onChange:s=>{s.stopPropagation(),E(s.target.value)}}),i("div",{className:"duration",children:[t("div",{children:X(m)??"0:00"}),t("div",{children:X(c.duration)})]})]}),i("div",{className:"voicemail-item-footer",children:[t("div",{className:"play",onClick:s=>{if(s.stopPropagation(),!v.current)return I("warning","Audio ref is null");e?v.current.pause():v.current.play().catch(()=>I("error","Failed to play voicemail",c.id)),r(!e)},children:e?t(_e,{}):t(we,{})}),i("div",{className:"buttons",children:[c.number&&i(R,{children:[t(de,{className:"green",onClick:s=>{s.stopPropagation(),H.PopUp.set({title:a("APPS.PHONE.VOICEMAIL.CALL_POPUP.TITLE"),description:a("APPS.PHONE.VOICEMAIL.CALL_POPUP.DESCRIPTION").format({number:V(c.number)}),buttons:[{title:a("APPS.PHONE.VOICEMAIL.CALL_POPUP.CANCEL")},{title:a("APPS.PHONE.VOICEMAIL.CALL_POPUP.PROCEED"),cb:()=>{Y({number:c.number})}}]})}}),t(he,{className:"blue",onClick:s=>{s.stopPropagation(),J.patch({active:{name:"Messages",data:{number:c.number,name:(O==null?void 0:O.firstname)&&K(O.firstname,O.lastname),avatar:O==null?void 0:O.avatar},view:"messages"}})}})]}),t(Re,{className:"red",onClick:s=>{s.stopPropagation(),H.PopUp.set({title:a("APPS.PHONE.VOICEMAIL.DELETE_POPUP.TITLE"),description:a("APPS.PHONE.VOICEMAIL.DELETE_POPUP.DESCRIPTION"),buttons:[{title:a("APPS.PHONE.VOICEMAIL.DELETE_POPUP.CANCEL")},{title:a("APPS.PHONE.VOICEMAIL.DELETE_POPUP.PROCEED"),cb:()=>{k("Phone",{action:"deleteVoiceMail",id:c.id},!0).then(L=>{if(!L)return I("error","Failed to delete voicemail");I("info","Deleted voicemail",c.id),q.set(q.value.filter(b=>b.id!==c.id))})}}]})}})]})]})]})})]})})};const z=l.createContext(null);function We(){const c=p(J).active,[h,n]=l.useState("Contacts"),[v,P]=l.useState(null),f=p(w.APPS.PHONE.contacts),u=(r,N)=>{P({...r,from:N}),n("Contact")};l.useEffect(()=>{var r,N;if(f&&c!=null&&c.data)if(((r=c.data)==null?void 0:r.view)==="contact"){let E=f==null?void 0:f.find(m=>m.number==c.data.number);if(!E)return;P({...E||{number:c.data.number},from:"Contacts"}),n("Contact")}else((N=c.data)==null?void 0:N.view)==="newContact"&&(P({number:c.data.number,from:"Contacts"}),n("NewContact"))},[]);const A={Favourites:t($e,{}),Contacts:t(Be,{}),Recents:t(je,{}),Keypad:t(Ge,{}),NewContact:t(Xe,{}),Contact:t(Fe,{}),Voicemail:t(Ye,{})},e={Favourites:t(Me,{}),Recents:t(De,{}),Contacts:t(se,{}),Keypad:t(Ve,{}),Voicemail:t(xe,{})};return i("div",{className:"phone-app-container",children:[t(z.Provider,{value:{Contact:[v,P],View:[h,n],viewContact:u},children:t("div",{className:"wrapper",children:A[h]})}),t("div",{className:"footer",children:Object.keys(e).map((r,N)=>{let E=h==r?"active":"";return i("div",{className:`item ${E}`,onClick:()=>n(r),children:[e[r],t("span",{children:a(`APPS.PHONE.${r.toUpperCase()}.TITLE`)})]},N)})})]})}export{z as PhoneContext,We as default};
